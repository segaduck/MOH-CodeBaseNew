@using EECOnline.Areas.A3.Models;
@using EECOnline.Models;
@model C101MFormModel
@{
    Layout = "~/Views/Shared/_Back_MainLayout.cshtml";
    SessionModel sm = SessionModel.Get();
    var funcName = sm.LastActionFunc != null ? sm.LastActionFunc.prgname : "申請案件費用查詢";
}

<div class="col-sm-12 content">
    <h1 class="main-title" style="margin-top: unset;"><i class="fa fa-edit"></i>@funcName</h1>
    <div class="form-blue">
        @using (Html.BeginForm("Index", "C101M", FormMethod.Post, htmlAttributes: new { id = "main_form", @class = "form-horizontal" }))
        {
            @Html.ControlForTurbo(Model)
            <div class="btnBar">
                <button type="button" style="margin-right: 0.5rem;" class="btn btn-apply" onclick="OnSearch()">送出查詢</button>
                <button type="button" style="margin-right: 0.5rem;" class="btn btn-cancel" onclick="OnClear()">清除重填</button>
                <button type="button" style="margin-right: 0.5rem;" class="btn btn-primary" onclick="OnExport()">匯出報表</button>
                <button type="button" style="margin-right: 0.5rem;" class="btn btn-blue" onclick="OnExportDat()">匯出請款檔</button>
                <button type="button" style="margin-right: 0.5rem;" class="btn btn-blue" onclick="OnImportDat()">匯入請款檔</button>
            </div>
        }
    </div>
    <div class="clearfix"></div>
    <h2 class="second-title">查詢結果</h2>
    <div class="table-pager">@Html.Partial("_PagingLink", Model)</div>
    <div class="table-responsive">
        @if (Model.Grid != null)
        {
            <table width="100%" border="0" cellspacing="0" cellpadding="0" class="table-typeA table">
                <thead>
                    <tr>
                        <th width="10%">訂單編號</th>
                        <th>申請人</th>
                        <th>申請醫院</th>
                        <th>申請日期</th>
                        <th>申請期間</th>
                        <th>申請金額小計</th>
                        <th>繳費狀態</th>
                    </tr>
                </thead>
                <tbody id="rows">
                    @Html.Partial("_GridRows")
                </tbody>
            </table>
        }
    </div>
</div>

<script type="text/javascript">

    $(document).ready(function () {
    });

    function OnSearch() {
        blockUI();
        var form = $("form[id=main_form]");
        form.attr('action', '@Url.Action("Index")').submit();
    }

    function OnClear() {
        $("#apply_no_sub").val("");
        $("#HospitalText").val("");
        $("#PayStatus").val("");
        $("#ApplyDateS_AD").val("");
        $("#ApplyDateS_AD_TW").val("");
        $("#ApplyDateE_AD").val("");
        $("#ApplyDateE_AD_TW").val("");
    }

    function OnExport() {
        //blockUI();
        var form = $("form[id=main_form]");
        form.attr('action', '@Url.Action("Export", "C101M")').submit();
    }

    function OnExportDat() {
        var url = '@Url.Action("ExportDat", "C101M")';
        var title = '匯出請款檔';
        popupWindow({ 'width': -1, 'height': 340 }, url, title, null, function (retData, doc) {
            if (retData != null) { if (retData.redirectUrl != "") { RedirectAfterPopup(retData.redirectUrl) } }
        });
    }

    function OnImportDat() {
        var url = '@Url.Action("ImportDat", "C101M")';
        var title = '匯入請款檔';
        popupWindow({ 'width': -1, 'height': 340 }, url, title, null, function (retData, doc) {
            if (retData != null) { if (retData.redirectUrl != "") { RedirectAfterPopup(retData.redirectUrl) } }
        });
    }

</script>
