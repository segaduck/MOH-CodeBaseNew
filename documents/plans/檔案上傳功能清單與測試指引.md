# æª”æ¡ˆä¸Šå‚³åŠŸèƒ½æ¸…å–®èˆ‡æ¸¬è©¦æŒ‡å¼•

> **å»ºç«‹æ—¥æœŸ**: 2025-12-06  
> **ç‹€æ…‹**: å·²é©—è­‰å­˜åœ¨  
> **ç›®çš„**: æä¾›å®Œæ•´çš„æª”æ¡ˆä¸Šå‚³åŠŸèƒ½æ¸…å–®ä¾›å®‰å…¨æ¸¬è©¦ä½¿ç”¨

---

## ä¸€ã€ç¾æœ‰æª”æ¡ˆä¸Šå‚³åŠŸèƒ½ç¸½è¦½

ç¶“éç¨‹å¼ç¢¼åˆ†æï¼Œç³»çµ±å…±æœ‰ **2 å€‹ä¸»è¦çš„ä½¿ç”¨è€…ä»‹é¢ä¸Šå‚³åŠŸèƒ½**ï¼Œå‡ä½æ–¼å¾Œå°ç®¡ç†å€åŸŸã€‚

### åŠŸèƒ½çµ±è¨ˆ

| é¡å‹ | æ•¸é‡ | èªªæ˜ |
|-----|:----:|------|
| å¾Œå°ä¸Šå‚³é é¢ | 2 | ç—…æ­·ä¸Šå‚³ + è«‹æ¬¾æª”åŒ¯å…¥ |
| AJAX ä¸Šå‚³å…ƒä»¶ | 1 | DynamicEFileGrid (æœªä½¿ç”¨) |
| API ä¸Šå‚³ç«¯é» | 3 | é†«é™¢ API (Base64 ä¸Šå‚³) |
| **ç¸½è¨ˆ** | **6** | **éœ€è¦å®‰å…¨åŠ å›ºçš„ç«¯é»** |

---

## äºŒã€ä½¿ç”¨è€…ä»‹é¢ä¸Šå‚³åŠŸèƒ½ (å¯æ¸¬è©¦)

### åŠŸèƒ½ 1: ç—…æ­·è£œä¸Šå‚³

#### åŸºæœ¬è³‡è¨Š

| é …ç›® | å…§å®¹ |
|-----|------|
| **åŠŸèƒ½åç¨±** | ç—…æ­·è£œä¸Šå‚³ (Medical Record Supplementary Upload) |
| **æ‰€å±¬å€åŸŸ** | Area A2 |
| **æ§åˆ¶å™¨** | `Areas\A2\Controllers\C102MController.cs` |
| **ä¸»é é¢** | `Areas\A2\Views\C102M\Index.cshtml` |
| **ä¸Šå‚³é é¢** | `Areas\A2\Views\C102M\Upload.cshtml` |
| **ä½¿ç”¨è€…é¡å‹** | å¾Œå°ç®¡ç†å“¡ (é†«é™¢äººå“¡) |

#### è¨ªå•è·¯å¾‘

**ä¸»åˆ—è¡¨é é¢**:
```
http://localhost:8080/A2/C102M/Index
```

**ä¸Šå‚³è¡¨å–®é é¢** (é€éä¸»é é¢æŒ‰éˆ•é–‹å•Ÿ):
```
http://localhost:8080/A2/C102M/Upload?apply_no_sub={è¨‚å–®ç·¨è™Ÿ}&his_type={ç—…æ­·é¡å‹}
```

#### åŠŸèƒ½èªªæ˜

æ­¤åŠŸèƒ½å…è¨±é†«é™¢äººå“¡é‡å°å·²ç”³è«‹çš„é›»å­ç—…æ­·è¨‚å–®è£œä¸Šå‚³ç—…æ­·æª”æ¡ˆã€‚

**ä½¿ç”¨æµç¨‹**:
1. ç™»å…¥å¾Œå°ç³»çµ± (æ¸¬è©¦å¸³è™Ÿ: `testadmin` / `Test@1234`)
2. é€²å…¥ Area A2 â†’ C102M ç—…æ­·è£œä¸Šå‚³ç®¡ç†
3. æœå°‹éœ€è¦è£œå‚³ç—…æ­·çš„è¨‚å–®
4. é»æ“Šã€Œä¸Šå‚³æª”æ¡ˆã€æŒ‰éˆ•
5. å½ˆå‡ºè¦–çª—é¡¯ç¤ºä¸Šå‚³è¡¨å–®
6. é¸æ“‡ç—…æ­·æª”æ¡ˆä¸¦ä¸Šå‚³
7. ç³»çµ±å°‡æª”æ¡ˆè½‰ç‚º Base64 å„²å­˜è‡³è³‡æ–™åº«

#### æª”æ¡ˆé™åˆ¶

| é™åˆ¶é …ç›® | è¨­å®šå€¼ |
|---------|--------|
| **å…è¨±é¡å‹** | `.PDF, .JPG, .BMP, .PNG, .GIF, .TIF` |
| **æª”æ¡ˆå¤§å°** | æœ€å¤§ 20MB |
| **é©—è­‰ä½ç½®** | å‰ç«¯ JavaScript (Line 56-71) + å¾Œç«¯ C# (Line 61-68) |
| **å„²å­˜æ–¹å¼** | Base64 ç·¨ç¢¼å„²å­˜è‡³è³‡æ–™åº« |
| **å„²å­˜æ¬„ä½** | `TblEEC_ApplyDetailPrice.provide_bin` |

#### ç›¸é—œç¨‹å¼ç¢¼

**å‰ç«¯é©—è­‰** (`Upload.cshtml` Line 56-71):
```javascript
$("#UploadFILE").on("change", function () { CheckFileTypeByComp("UploadFILE"); });
function CheckFileTypeByComp(ID_Name) {
    let fileType = "." + document.getElementById(ID_Name).value.split('.').pop().toLowerCase();
    let acceptType = document.getElementById(ID_Name).accept.toLowerCase();
    
    if (acceptType.indexOf(fileType) === -1) {
        blockAlert("è«‹é¸æ“‡æ­£ç¢ºçš„æª”æ¡ˆæ ¼å¼ï¼ (" + acceptType + ")");
        document.getElementById(ID_Name).value = null;
    }
    if (document.getElementById(ID_Name).files[0].size > (20 * 1024 * 1024)) {
        blockAlert("æª”æ¡ˆå¤§å°ä»¥ 20MB ç‚ºé™ï¼");
        document.getElementById(ID_Name).value = null;
    }
}
```

**å¾Œç«¯é©—è­‰** (`C102MController.cs` Line 61-68):
```csharp
private string isFileCheckOK(HttpPostedFileBase YourFile)
{
    string Result = "";
    const string acceptType = ".PDF,.JPG,.BMP,.PNG,.GIF,.TIF";
    if (YourFile == null || YourFile.ContentLength.TOInt32() <= 0) 
        return "è«‹é¸æ“‡ä¸Šå‚³æª”æ¡ˆï¼<br/ >";
    if (!acceptType.Contains(Path.GetExtension(YourFile.FileName).ToUpper())) 
        Result = Result + "è«‹é¸æ“‡æ­£ç¢ºçš„æª”æ¡ˆæ ¼å¼ï¼ (" + acceptType + ")<br/ >";
    if (YourFile.ContentLength.TOInt32() > (20 * 1024 * 1024)) 
        Result = Result + "æª”æ¡ˆå¤§å°ä»¥ 20MB ç‚ºé™ï¼<br/ >";
    return Result;
}
```

#### å®‰å…¨é¢¨éšªè©•ä¼°

| é¢¨éšªé …ç›® | é¢¨éšªç­‰ç´š | èªªæ˜ |
|---------|:-------:|------|
| ç¼ºä¹ MIME é©—è­‰ | ğŸ”´ é«˜ | åƒ…æª¢æŸ¥å‰¯æª”åï¼Œæœªé©—è­‰ Content-Type |
| ç¼ºä¹ Magic Bytes é©—è­‰ | ğŸ”´ é«˜ | æœªæª¢æŸ¥æª”æ¡ˆé ­ï¼Œå¯èƒ½è¢«å½é€ æª”æ¡ˆé¡å‹ç¹é |
| Base64 å„²å­˜è‡³è³‡æ–™åº« | ğŸŸ¡ ä¸­ | å¤§é‡ä¸Šå‚³æœƒé€ æˆè³‡æ–™åº«è†¨è„¹ |
| å®¢æˆ¶ç«¯é©—è­‰å¯ç¹é | ğŸŸ¡ ä¸­ | JavaScript é©—è­‰å¯è¢«åœç”¨ |

---

### åŠŸèƒ½ 2: è«‹æ¬¾æª”åŒ¯å…¥

#### åŸºæœ¬è³‡è¨Š

| é …ç›® | å…§å®¹ |
|-----|------|
| **åŠŸèƒ½åç¨±** | è«‹æ¬¾æª”ä¸Šå‚³ (Payment Request File Import) |
| **æ‰€å±¬å€åŸŸ** | Area A3 |
| **æ§åˆ¶å™¨** | `Areas\A3\Controllers\C101MController.cs` |
| **ä¸Šå‚³é é¢** | `Areas\A3\Views\C101M\ImportDat.cshtml` |
| **ä½¿ç”¨è€…é¡å‹** | å¾Œå°ç®¡ç†å“¡ (è²¡å‹™äººå“¡) |

#### è¨ªå•è·¯å¾‘

**ç›´æ¥è¨ªå•**:
```
http://localhost:8080/A3/C101M/ImportDat
```

#### åŠŸèƒ½èªªæ˜

æ­¤åŠŸèƒ½å…è¨±è²¡å‹™äººå“¡åŒ¯å…¥ä¾†è‡ªè¯åˆä¿¡ç”¨å¡ä¸­å¿ƒçš„è«‹æ¬¾å›æ‡‰æª”æ¡ˆ (`.rsp` æ ¼å¼)ï¼Œç”¨æ–¼æ ¸å°é›»å­ç—…æ­·ç”³è«‹æ¡ˆä»¶çš„ä»˜æ¬¾ç‹€æ…‹ã€‚

**ä½¿ç”¨æµç¨‹**:
1. ç™»å…¥å¾Œå°ç³»çµ±
2. é€²å…¥ Area A3 â†’ C101M 
3. ç›´æ¥è¨ªå• ImportDat é é¢æˆ–é€éé¸å–®é€²å…¥
4. é¸æ“‡ .rsp æª”æ¡ˆ
5. é»æ“Šã€ŒåŒ¯å…¥è«‹æ¬¾æª”ã€æŒ‰éˆ•
6. ç³»çµ±è§£æå›ºå®šæ¬„ä½æ ¼å¼æª”æ¡ˆä¸¦æ›´æ–°è³‡æ–™åº«

#### æª”æ¡ˆé™åˆ¶

| é™åˆ¶é …ç›® | è¨­å®šå€¼ |
|---------|--------|
| **å…è¨±é¡å‹** | `.rsp` (Response file) |
| **æª”æ¡ˆå¤§å°** | æœ€å¤§ 20MB |
| **é©—è­‰ä½ç½®** | å‰ç«¯ JavaScript (Line 43-59) + å¾Œç«¯ C# (Line 256-263) |
| **å„²å­˜æ–¹å¼** | å„²å­˜è‡³ `~/Uploads/RSP_Files/` å¾Œè§£æï¼Œè™•ç†å®Œç•¢ |
| **æª”æ¡ˆæ ¼å¼** | å›ºå®šæ¬„ä½é•·åº¦æ–‡å­—æª” (270 bytes/è¡Œ) |

#### æª”æ¡ˆæ ¼å¼è¦ç¯„

æ­¤æª”æ¡ˆç‚ºè¯åˆä¿¡ç”¨å¡ä¸­å¿ƒçš„æ¨™æº–è«‹æ¬¾å›æ‡‰æ ¼å¼ï¼š

| æ¬„ä½ç¯„åœ | é•·åº¦ | æ¬„ä½åç¨± | èªªæ˜ |
|---------|:----:|---------|------|
| 001-010 | 10 | A_001_010_10 | ç‰¹åº—ä»£è™Ÿ |
| 011-018 | 8 | B_011_018_8 | ç«¯æœ«æ©Ÿä»£è™Ÿ |
| 019-058 | 40 | C_019_058_40 | è¨‚å–®ç·¨è™Ÿ |
| 166-168 | 3 | L_166_168_3 | **å›æ‡‰ç¢¼** |
| 169-184 | 16 | M_169_184_16 | **å›æ‡‰è¨Šæ¯** (æˆåŠŸ="è«‹æ¬¾æˆåŠŸ") |

**æˆåŠŸåˆ¤å®šé‚è¼¯** (`C101MController.cs` Line 344):
```csharp
var rsp_code = row.L_166_168_3.Trim();
var rsp_name = row.M_169_184_16.Trim();
var rsp_status = (rsp_code == "00" && rsp_name == "è«‹æ¬¾æˆåŠŸ");
```

#### ç›¸é—œç¨‹å¼ç¢¼

**å‰ç«¯é©—è­‰** (`ImportDat.cshtml` Line 43-59):
```javascript
$("#UploadFILE").on("change", function () { CheckFileTypeByComp("UploadFILE"); });
function CheckFileTypeByComp(ID_Name) {
    let fileType = "." + document.getElementById(ID_Name).value.split('.').pop().toLowerCase();
    let acceptType = document.getElementById(ID_Name).accept.toLowerCase();
    
    if (acceptType.indexOf(fileType) === -1) {
        blockAlert("è«‹é¸æ“‡æ­£ç¢ºçš„æª”æ¡ˆæ ¼å¼ï¼ (" + acceptType + ")");
        document.getElementById(ID_Name).value = null;
    }
    if (document.getElementById(ID_Name).files[0].size > (20 * 1024 * 1024)) {
        blockAlert("æª”æ¡ˆå¤§å°ä»¥ 20MB ç‚ºé™ï¼");
        document.getElementById(ID_Name).value = null;
    }
}
```

**å¾Œç«¯è™•ç†** (`C101MController.cs` Line 276-296):
```csharp
// ä¸Šå‚³æª”æ¡ˆ
var RSP_Path = Server.MapPath(@"~\Uploads\RSP_Files\");
System.IO.Directory.CreateDirectory(RSP_Path);
var TheFilePath = RSP_Path + DateTime.Now.ToString("yyyyMMddHHmmss") + "_" + model.UploadFILE.FileName;
model.UploadFILE.SaveAs(TheFilePath);

// è®€å–æª”æ¡ˆ
var tmpList = new List<string>();
using (StreamReader reader = new StreamReader(TheFilePath))
{
    string line;
    while ((line = reader.ReadLine()) != null)
    {
        tmpList.Add(line);
    }
    reader.Close();
}
```

#### å®‰å…¨é¢¨éšªè©•ä¼°

| é¢¨éšªé …ç›® | é¢¨éšªç­‰ç´š | èªªæ˜ |
|---------|:-------:|------|
| ç¼ºä¹ MIME é©—è­‰ | ğŸ”´ é«˜ | åƒ…æª¢æŸ¥å‰¯æª”å `.rsp` |
| ç¼ºä¹å…§å®¹æ ¼å¼é©—è­‰ | ğŸŸ  ä¸­ | æœªé©—è­‰æª”æ¡ˆå…§å®¹æ˜¯å¦ç¬¦åˆå›ºå®šæ¬„ä½æ ¼å¼ |
| æª”åå¯é æ¸¬ | ğŸŸ¡ ä¸­ | ä½¿ç”¨æ™‚é–“æˆ³å‘½å: `yyyyMMddHHmmss_filename` |
| æª”æ¡ˆå„²å­˜åœ¨ Web Root | ğŸŸ  ä¸­ | `~/Uploads/RSP_Files/` å¯èƒ½è¢«ç›´æ¥è¨ªå• |

---

## ä¸‰ã€AJAX ä¸Šå‚³å…ƒä»¶ (æœªè¢«ä½¿ç”¨)

### DynamicEFileGrid å…ƒä»¶

#### åŸºæœ¬è³‡è¨Š

| é …ç›® | å…§å®¹ |
|-----|------|
| **å…ƒä»¶åç¨±** | DynamicEFileGrid |
| **æ§åˆ¶å™¨** | `Controllers\AjaxController.cs` |
| **Model** | `Models\DynamicEFileGrid.cs` |
| **View** | `Views\Shared\DynamicEFileGrid.cshtml` |
| **Editor Template** | `Views\Shared\EditorTemplates\DynamicEFileGrid.cshtml` |

#### ç«¯é»è³‡è¨Š

**ä¸Šå‚³ç«¯é»**:
```
POST http://localhost:8080/Ajax/UploadFile
```

**åˆªé™¤ç«¯é»**:
```
POST http://localhost:8080/Ajax/DeleteFile
```

#### æª”æ¡ˆé™åˆ¶

| é™åˆ¶é …ç›® | è¨­å®šå€¼ |
|---------|--------|
| **å…è¨±é¡å‹** | `.BMP, .CSV, .DAT, .DOC, .DOCX, .GIF, .JPG, .JPEG, .ODG, .ODP, .ODS, .ODT, .PDF, .PNG, .PPT, .PPTX, .TIFF, .TXT, .XLS, .XLSX` (å…± 20 ç¨®) |
| **æª”æ¡ˆå¤§å°** | æœ€å¤§ 10MB |
| **å„²å­˜ä½ç½®** | `~/Uploads/Temp/{peky1}/` |
| **è³‡æ–™è¡¨** | `TblEFILE` |

#### ä½¿ç”¨ç‹€æ…‹

âš ï¸ **æ­¤å…ƒä»¶ç›®å‰æœªè¢«ä»»ä½•é é¢ä½¿ç”¨**

ç¶“éå…¨ç³»çµ±æœå°‹ï¼Œæ²’æœ‰æ‰¾åˆ°ä»»ä½• View é é¢å¼•ç”¨æ­¤å…ƒä»¶ã€‚æ­¤ç‚ºå¯é‡ç”¨å…ƒä»¶ï¼Œä½†å°šæœªæ•´åˆè‡³ä»»ä½•æ¥­å‹™åŠŸèƒ½ã€‚

#### å®‰å…¨é¢¨éšªè©•ä¼°

| é¢¨éšªé …ç›® | é¢¨éšªç­‰ç´š | èªªæ˜ |
|---------|:-------:|------|
| ç¼ºä¹ CSRF ä¿è­· | ğŸ”´ é«˜ | `UploadFile` Action ç„¡ `[ValidateAntiForgeryToken]` |
| ç¼ºä¹ MIME é©—è­‰ | ğŸ”´ é«˜ | åƒ…æª¢æŸ¥å‰¯æª”å |
| ç¼ºä¹ Magic Bytes é©—è­‰ | ğŸ”´ é«˜ | æœªé©—è­‰æª”æ¡ˆçœŸå¯¦é¡å‹ |

---

## å››ã€API ä¸Šå‚³ç«¯é» (é†«é™¢æ•´åˆ)

### é†«é™¢ API Base64 ä¸Šå‚³

ç³»çµ±æä¾› 3 å€‹ API ç«¯é»ä¾›é†«é™¢ä¸Šå‚³ç—…æ­·æª”æ¡ˆ (Base64 ç·¨ç¢¼)ï¼š

| ç«¯é» | é†«é™¢ | ä½ç½® |
|-----|------|------|
| `Api_A2_2` | äºæ±é†«é™¢ (Far Eastern Hospital) | `AjaxController.cs:370` |
| `Api_A2_2_csh` | ä¸­å±±é†«é™¢ (Chung Shan Hospital) | `AjaxController.cs:518` |
| `Api_A2_2_cmuh` | ä¸­åœ‹é†«è—¥å¤§å­¸é™„è¨­é†«é™¢ (CMUH) | `AjaxController.cs:666` |

#### è¨ªå•è·¯å¾‘

```
POST http://localhost:8080/Ajax/Api_A2_2
POST http://localhost:8080/Ajax/Api_A2_2_csh
POST http://localhost:8080/Ajax/Api_A2_2_cmuh
```

#### ä¸Šå‚³æ ¼å¼

**Request Body (JSON)**:
```json
{
  "token": "é©—è­‰ Token (30 åˆ†é˜æœ‰æ•ˆæœŸ)",
  "caseNo": "ç”³è«‹æ¡ˆè™Ÿ",
  "data": [
    {
      "ec_no": "ç—…æ­·é¡å‹ä»£ç¢¼",
      "ec_success": "æˆåŠŸ/å¤±æ•—",
      "ec_reason": "åŸå› èªªæ˜",
      "ec_fileBase64": "Base64 ç·¨ç¢¼çš„æª”æ¡ˆå…§å®¹"
    }
  ]
}
```

#### å®‰å…¨é¢¨éšªè©•ä¼° (æœ€é«˜é¢¨éšª)

| é¢¨éšªé …ç›® | é¢¨éšªç­‰ç´š | èªªæ˜ |
|---------|:-------:|------|
| **ç„¡æª”æ¡ˆé¡å‹é©—è­‰** | ğŸ”´ **æ¥µé«˜** | æ¥å—ä»»æ„ Base64 å…§å®¹ï¼Œç„¡é¡å‹é™åˆ¶ |
| ç¼ºä¹æª”æ¡ˆå¤§å°é™åˆ¶ | ğŸ”´ é«˜ | æœªæª¢æŸ¥ Base64 è§£ç¢¼å¾Œçš„æª”æ¡ˆå¤§å° |
| ç¼ºä¹ Magic Bytes é©—è­‰ | ğŸ”´ é«˜ | æœªé©—è­‰è§£ç¢¼å¾Œçš„æª”æ¡ˆçœŸå¯¦é¡å‹ |
| Token é©—è­‰æ©Ÿåˆ¶è¼ƒå¼± | ğŸŸ  ä¸­ | åƒ… 30 åˆ†é˜æ™‚æ•ˆï¼Œæœªæª¢æŸ¥ä¾†æº IP |

âš ï¸ **æ­¤ç‚ºæœ€éœ€è¦å„ªå…ˆåŠ å›ºçš„ç«¯é»**

---

## äº”ã€æ¸¬è©¦ç’°å¢ƒè¨ªå•æŒ‡å¼•

### æ¸¬è©¦å‰ç½®æº–å‚™

1. **å•Ÿå‹•æ¸¬è©¦ç’°å¢ƒ**
   - ç¢ºèª IIS Express æˆ– IIS å·²å•Ÿå‹•
   - é è¨­åŸ è™Ÿ: `8080`
   - åŸºç¤ URL: `http://localhost:8080`

2. **æ¸¬è©¦å¸³è™Ÿ**
   - å¸³è™Ÿ: `testadmin`
   - å¯†ç¢¼: `Test@1234`
   - æ¬Šé™: å¾Œå°ç®¡ç†å“¡

3. **è³‡æ–™åº«ç¢ºèª**
   - SQL Server å®¹å™¨: `moh-sqlserver`
   - è³‡æ–™åº«: `EEC_PD_DB`
   - SA å¯†ç¢¼: `YourStrong!Passw0rd`

### æ¸¬è©¦æ¡ˆä¾‹æ¸…å–®

#### æ¸¬è©¦æ¡ˆä¾‹ 1: ç—…æ­·è£œä¸Šå‚³ - æ­£å¸¸æµç¨‹

| æ­¥é©Ÿ | æ“ä½œ | é æœŸçµæœ |
|:----:|------|---------|
| 1 | è¨ªå• `http://localhost:8080/A2/C102M/Index` | é¡¯ç¤ºç™»å…¥é é¢ |
| 2 | è¼¸å…¥ `testadmin` / `Test@1234` ç™»å…¥ | ç™»å…¥æˆåŠŸï¼Œé€²å…¥ä¸»é  |
| 3 | æœå°‹è¨‚å–® | é¡¯ç¤ºè¨‚å–®åˆ—è¡¨ |
| 4 | é»æ“Šã€Œä¸Šå‚³æª”æ¡ˆã€æŒ‰éˆ• | å½ˆå‡ºä¸Šå‚³è¦–çª— |
| 5 | é¸æ“‡æ¸¬è©¦ PDF æª”æ¡ˆ (< 20MB) | æª”æ¡ˆå·²é¸æ“‡ |
| 6 | é»æ“Šã€Œå„²å­˜ã€æŒ‰éˆ• | ä¸Šå‚³æˆåŠŸï¼Œè¦–çª—é—œé–‰ |
| 7 | æª¢æŸ¥è³‡æ–™åº« `TblEEC_ApplyDetailPrice.provide_bin` | åŒ…å« Base64 ç·¨ç¢¼å…§å®¹ |

#### æ¸¬è©¦æ¡ˆä¾‹ 2: ç—…æ­·è£œä¸Šå‚³ - å‰¯æª”åæ”»æ“Š

| æ­¥é©Ÿ | æ“ä½œ | é æœŸçµæœ |
|:----:|------|---------|
| 1 | å»ºç«‹æ¸¬è©¦æª”æ¡ˆ `test.txt` | - |
| 2 | é‡æ–°å‘½åç‚º `test.aspx` | - |
| 3 | å˜—è©¦ä¸Šå‚³ `test.aspx` | âŒ **è¢«æ””æˆª** (ä¸åœ¨å…è¨±æ¸…å–®) |
| 4 | é‡æ–°å‘½åç‚º `test.pdf` | - |
| 5 | å†æ¬¡å˜—è©¦ä¸Šå‚³ | âœ… **å¯èƒ½æˆåŠŸ** (ç¼ºä¹ Magic Bytes é©—è­‰) |

âš ï¸ **å®‰å…¨å•é¡Œ**: ç›®å‰å¯ç¹éå‰¯æª”åæª¢æŸ¥ï¼Œä¸Šå‚³å½é€ é¡å‹æª”æ¡ˆ

#### æ¸¬è©¦æ¡ˆä¾‹ 3: è«‹æ¬¾æª”åŒ¯å…¥ - æ­£å¸¸æµç¨‹

| æ­¥é©Ÿ | æ“ä½œ | é æœŸçµæœ |
|:----:|------|---------|
| 1 | è¨ªå• `http://localhost:8080/A3/C101M/ImportDat` | é¡¯ç¤ºä¸Šå‚³é é¢ |
| 2 | å»ºç«‹æ¸¬è©¦ .rsp æª”æ¡ˆ (å›ºå®šæ¬„ä½æ ¼å¼) | - |
| 3 | é¸æ“‡ .rsp æª”æ¡ˆ | æª”æ¡ˆå·²é¸æ“‡ |
| 4 | é»æ“Šã€ŒåŒ¯å…¥è«‹æ¬¾æª”ã€æŒ‰éˆ• | æª”æ¡ˆä¸Šå‚³ä¸¦è§£æ |
| 5 | æª¢æŸ¥ `~/Uploads/RSP_Files/` è³‡æ–™å¤¾ | æª”æ¡ˆå·²å„²å­˜ |
| 6 | æª¢æŸ¥è³‡æ–™åº«æ›´æ–°ç‹€æ…‹ | è«‹æ¬¾ç‹€æ…‹å·²æ›´æ–° |

#### æ¸¬è©¦æ¡ˆä¾‹ 4: API Base64 ä¸Šå‚³ - Webshell æ”»æ“Šæ¨¡æ“¬

âš ï¸ **å±éšªæ¸¬è©¦ï¼Œåƒ…ä¾›å®‰å…¨è©•ä¼°ä½¿ç”¨**

| æ­¥é©Ÿ | æ“ä½œ | é æœŸçµæœ (ç•¶å‰) | é æœŸçµæœ (ä¿®å¾©å¾Œ) |
|:----:|------|----------------|-----------------|
| 1 | å»ºç«‹æƒ¡æ„ ASPX æª”æ¡ˆ | - | - |
| 2 | å°‡æª”æ¡ˆè½‰ç‚º Base64 | - | - |
| 3 | é€é API ç™¼é€è«‹æ±‚ (ec_fileBase64) | âœ… å¯èƒ½æˆåŠŸå„²å­˜ | âŒ æ‡‰è¢«æ””æˆª |
| 4 | æª¢æŸ¥å„²å­˜ä½ç½®æ˜¯å¦å¯åŸ·è¡Œ | ğŸ”´ å®‰å…¨é¢¨éšª | âœ… å·²éš”é›¢ |

---

## å…­ã€å®‰å…¨æ”¹å–„å„ªå…ˆé †åº

æ ¹æ“šé¢¨éšªç­‰ç´šèˆ‡å½±éŸ¿ç¯„åœï¼Œå»ºè­°ä¾ä»¥ä¸‹é †åºé€²è¡Œæ”¹å–„ï¼š

### å„ªå…ˆç´š 1 (ç·Šæ€¥) - é†«é™¢ API ç«¯é»

**ç«¯é»**: `Api_A2_2`, `Api_A2_2_csh`, `Api_A2_2_cmuh`

**åŸå› **: 
- ç„¡ä»»ä½•æª”æ¡ˆé¡å‹é©—è­‰
- æ¥å—ä»»æ„ Base64 å…§å®¹
- ç›´æ¥å„²å­˜è‡³æª”æ¡ˆç³»çµ±
- å¤–éƒ¨å¯è¨ªå•

**å»ºè­°ä¿®å¾©æ™‚ç¨‹**: 1 é€±å…§

### å„ªå…ˆç´š 2 (é«˜) - AJAX UploadFile ç«¯é»

**ç«¯é»**: `AjaxController.UploadFile()`

**åŸå› **:
- ç¼ºä¹ CSRF ä¿è­·
- ç„¡ MIME èˆ‡ Magic Bytes é©—è­‰
- é›–æœªä½¿ç”¨ä½†ç«¯é»é–‹æ”¾

**å»ºè­°ä¿®å¾©æ™‚ç¨‹**: 2 é€±å…§

### å„ªå…ˆç´š 3 (ä¸­) - ç—…æ­·è£œä¸Šå‚³

**ç«¯é»**: `A2/C102MController.SaveUpload()`

**åŸå› **:
- å·²æœ‰åŸºç¤é©—è­‰
- éœ€å¼·åŒ– Magic Bytes æª¢æŸ¥
- Base64 å„²å­˜æ–¹å¼éœ€è©•ä¼°

**å»ºè­°ä¿®å¾©æ™‚ç¨‹**: 3 é€±å…§

### å„ªå…ˆç´š 4 (ä½) - è«‹æ¬¾æª”åŒ¯å…¥

**ç«¯é»**: `A3/C101MController.ImportDat_Go()`

**åŸå› **:
- æª”æ¡ˆæ ¼å¼å›ºå®š
- å…§éƒ¨ä½¿ç”¨
- é¢¨éšªç›¸å°è¼ƒä½

**å»ºè­°ä¿®å¾©æ™‚ç¨‹**: 4 é€±å…§

---

## ä¸ƒã€åƒè€ƒæ–‡ä»¶

- [æª”æ¡ˆä¸Šå‚³å®‰å…¨æ€§æ”¹å–„è¨ˆç•«](./æª”æ¡ˆä¸Šå‚³å®‰å…¨æ€§æ”¹å–„è¨ˆç•«.md)
- [OWASP File Upload Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/File_Upload_Cheat_Sheet.html)
- è³‡å®‰äº‹ä»¶èª¿æŸ¥å ±å‘Š: `H08S11401103_1.è¡›ç”Ÿç¦åˆ©éƒ¨è³‡å®‰äº‹ä»¶èª¿æŸ¥å ±å‘Š-EECPD_Webshell_1141030.pdf`

---

_æ–‡ä»¶å»ºç«‹æ—¥æœŸ: 2025-12-06_  
_æœ€å¾Œæ›´æ–°: 2025-12-06_  
_é©—è­‰ç‹€æ…‹: âœ… å·²ç¢ºèªæ‰€æœ‰åŠŸèƒ½å­˜åœ¨æ–¼ç¨‹å¼ç¢¼ä¸­_
