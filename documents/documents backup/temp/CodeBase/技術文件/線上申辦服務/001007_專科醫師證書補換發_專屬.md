# 001007 - 專科醫師證書補(換)發 - 服務專屬文件

## 文件說明

本文件說明 **001007 專科醫師證書補(換)發** 服務的專屬特性和差異。

**閱讀順序：**
1. 先閱讀 `_證書補換發服務_共用架構文件.md` 了解共用架構
2. 再閱讀本文件了解 001007 服務的專屬特性

---

## 服務基本資訊

| 項目         | 內容                                                     |
| ------------ | -------------------------------------------------------- |
| 服務代碼     | 001007                                                   |
| 服務名稱     | 專科醫師證書補(換)發                                     |
| 業務單位     | 醫事司                                                   |
| 是否需繳費   | 是                                                       |
| 申請對象     | 已取得專科醫師證書者                                     |
| Controller   | `ES/Controllers/Apply_001007Controller.cs` (369 行)      |
| ViewModel    | `ES/Models/ViewModels/Apply_001007ViewModel.cs` (218 行) |
| Entity Model | `ES/Models/Entities/Apply_001007Model.cs` (117 行)       |
| View         | `ES/Views/Apply_001007/Apply.cshtml` (約 520 行)         |
| DAO 方法     | `ApplyDAO.QueryApply_001007()`, `SaveAppDoc001007()`     |
| 主要資料表   | `APPLY`, `APPLY_001007`, `APPLY_FILE`, `APPLY_PAY`       |

---

## 服務專屬欄位

### APPLY_001007 資料表專屬欄位

除了共用欄位外，APPLY_001007 資料表還包含以下專屬欄位：

| 欄位名稱 | 資料型別 | 長度 | NULL | 說明                                 | 範例值 |
| -------- | -------- | ---- | ---- | ------------------------------------ | ------ |
| LIC_TYPE | varchar  | 10   | YES  | 專科類別代碼（專科醫師的專科別）     | 01     |

**欄位說明：**

1. **LIC_TYPE**：專科類別代碼
   - **這是 001007 的關鍵專屬欄位**
   - 用於儲存專科醫師的專科類別
   - 與 001005 的 `DIVISION` 欄位功能類似，但代碼值和含義不同
   - 001005 的 `DIVISION` 儲存醫事人員類別（醫師、護理師等）
   - 001007 的 `LIC_TYPE` 儲存專科醫師類別（內科、外科等）

**專科類別代碼 (LIC_TYPE) 對照表：**

| 代碼 | 專科名稱       | 說明                   |
| ---- | -------------- | ---------------------- |
| 01   | 內科           | 內科專科醫師           |
| 02   | 外科           | 外科專科醫師           |
| 03   | 小兒科         | 小兒科專科醫師         |
| 04   | 婦產科         | 婦產科專科醫師         |
| 05   | 骨科           | 骨科專科醫師           |
| 06   | 神經外科       | 神經外科專科醫師       |
| 07   | 泌尿科         | 泌尿科專科醫師         |
| 08   | 耳鼻喉科       | 耳鼻喉科專科醫師       |
| 09   | 眼科           | 眼科專科醫師           |
| 10   | 皮膚科         | 皮膚科專科醫師         |
| 11   | 神經科         | 神經科專科醫師         |
| 12   | 精神科         | 精神科專科醫師         |
| 13   | 復健科         | 復健科專科醫師         |
| 14   | 麻醉科         | 麻醉科專科醫師         |
| 15   | 放射診斷科     | 放射診斷科專科醫師     |
| 16   | 放射腫瘤科     | 放射腫瘤科專科醫師     |
| 17   | 解剖病理科     | 解剖病理科專科醫師     |
| 18   | 臨床病理科     | 臨床病理科專科醫師     |
| 19   | 核子醫學科     | 核子醫學科專科醫師     |
| 20   | 急診醫學科     | 急診醫學科專科醫師     |
| 21   | 家庭醫學科     | 家庭醫學科專科醫師     |
| 22   | 職業醫學科     | 職業醫學科專科醫師     |
| 23   | 整形外科       | 整形外科專科醫師       |

---

## ViewModel 專屬屬性

### Apply_001007ViewModel 專屬屬性

```csharp
/// <summary>
/// 專科醫師證書補(換)發 ViewModel
/// </summary>
public class Apply_001007ViewModel : Apply_001007Model
{
    // === 共用屬性（參考共用架構文件）===
    // ...
    
    // === 服務專屬屬性 ===
    
    /// <summary>專科類別代碼</summary>
    [Display(Name = "專科類別")]
    [Required(ErrorMessage = "請選擇專科類別")]
    public string LIC_TYPE { get; set; }
    
    /// <summary>專科類別名稱（用於顯示）</summary>
    public string LIC_TYPE_NAME { get; set; }
    
    /// <summary>專科類別下拉選單資料來源</summary>
    public List<SelectListItem> LicTypeList { get; set; }
    
    /// <summary>證書字號預設值（通常為「專醫」）</summary>
    public string DEFAULT_LIC_CD { get; set; } = "專醫";
}
```

---

## Entity Model 專屬屬性

### Apply_001007Model 專屬屬性

```csharp
/// <summary>
/// 專科醫師證書補(換)發 Entity Model
/// 對應資料表：APPLY_001007
/// </summary>
public class Apply_001007Model
{
    // === 共用屬性（參考共用架構文件）===
    public string APP_ID { get; set; }
    public string ACTION_TYPE { get; set; }
    public DateTime? ISSUE_DATE { get; set; }
    public string LIC_CD { get; set; }
    public string LIC_NUM { get; set; }
    public string ACTION_RES { get; set; }
    public string OTHER_RES { get; set; }
    public string EMAIL { get; set; }
    
    // === 服務專屬屬性 ===
    
    /// <summary>專科類別代碼</summary>
    public string LIC_TYPE { get; set; }
    
    // === 標準欄位 ===
    public string DEL_MK { get; set; }
    public DateTime? DEL_TIME { get; set; }
    public string DEL_FUN_CD { get; set; }
    public string DEL_ACC { get; set; }
    public DateTime? UPD_TIME { get; set; }
    public string UPD_FUN_CD { get; set; }
    public string UPD_ACC { get; set; }
    public DateTime ADD_TIME { get; set; }
    public string ADD_FUN_CD { get; set; }
    public string ADD_ACC { get; set; }
}
```

---

## View 專屬欄位

### 證書資訊區塊（服務專屬）

```cshtml
<!-- 專科類別：下拉選單 -->
<div class="form-group">
    <label class="step-label col-sm-2" for="LIC_TYPE">
        <span class="text-danger">*</span>專科類別
    </label>
    <div class="col-sm-10">
        @Html.DropDownListFor(m => m.LIC_TYPE, 
            Model.LicTypeList ?? new List<SelectListItem>(), 
            "請選擇專科類別", 
            new { @class = "form-control", required = "required" })
        @Html.ValidationMessageFor(m => m.LIC_TYPE, "", new { @class = "text-danger" })
        <span class="help-block">請選擇您的專科醫師類別</span>
    </div>
</div>

<!-- 補換發類型：單選按鈕 -->
<div class="form-group">
    <label class="step-label col-sm-2">
        <span class="text-danger">*</span>補換發類型
    </label>
    <div class="col-sm-10">
        <label class="radio-inline">
            @Html.RadioButtonFor(m => m.ACTION_TYPE, "1", new { required = "required" })
            補發（證書遺失、毀損、污損）
        </label>
        <label class="radio-inline">
            @Html.RadioButtonFor(m => m.ACTION_TYPE, "2", new { required = "required" })
            換發（變更姓名等）
        </label>
    </div>
</div>

<!-- 證書字號 -->
<div class="form-group">
    <label class="step-label col-sm-2" for="LIC_CD">
        <span class="text-danger">*</span>證書字號
    </label>
    <div class="col-sm-10">
        <div class="row">
            <div class="col-sm-3">
                @Html.TextBoxFor(m => m.LIC_CD, new { 
                    @class = "form-control", 
                    placeholder = "字（通常為：專醫）",
                    required = "required",
                    maxlength = "10",
                    value = "專醫"
                })
            </div>
            <div class="col-sm-1 text-center" style="padding-top: 7px;">字第</div>
            <div class="col-sm-4">
                @Html.TextBoxFor(m => m.LIC_NUM, new { 
                    @class = "form-control", 
                    placeholder = "號（如：12345）",
                    required = "required",
                    maxlength = "20"
                })
            </div>
            <div class="col-sm-1 text-center" style="padding-top: 7px;">號</div>
        </div>
        <span class="help-block">專科醫師證書字號通常為「專醫字第xxxxx號」</span>
    </div>
</div>

<!-- 核發日期 -->
<div class="form-group">
    <label class="step-label col-sm-2" for="ISSUE_DATE">
        <span class="text-danger">*</span>核發日期
    </label>
    <div class="col-sm-10">
        @Html.TextBoxFor(m => m.ISSUE_DATE, "{0:yyy/MM/dd}", new { 
            @class = "form-control datepicker", 
            placeholder = "民國年格式（如：109/01/01）",
            required = "required",
            maxlength = "10"
        })
        <span class="help-block">請輸入原專科醫師證書的核發日期（民國年格式）</span>
    </div>
</div>

<!-- 補換發原因 -->
<div class="form-group">
    <label class="step-label col-sm-2" for="ACTION_RES">
        <span class="text-danger">*</span>補換發原因
    </label>
    <div class="col-sm-10">
        @Html.DropDownListFor(m => m.ACTION_RES, 
            new List<SelectListItem> {
                new SelectListItem { Value = "01", Text = "遺失" },
                new SelectListItem { Value = "02", Text = "毀損" },
                new SelectListItem { Value = "03", Text = "污損" },
                new SelectListItem { Value = "04", Text = "變更姓名" },
                new SelectListItem { Value = "05", Text = "其他" }
            }, 
            "請選擇補換發原因", 
            new { @class = "form-control", required = "required", id = "ACTION_RES" })
    </div>
</div>

<!-- 其他原因說明：當選擇「其他」時顯示 -->
<div class="form-group" id="OTHER_RES_DIV" style="display:none;">
    <label class="step-label col-sm-2" for="OTHER_RES">
        <span class="text-danger">*</span>其他原因說明
    </label>
    <div class="col-sm-10">
        @Html.TextAreaFor(m => m.OTHER_RES, new { 
            @class = "form-control", 
            rows = "3",
            placeholder = "請詳細說明補換發原因（最多200字）",
            maxlength = "200"
        })
    </div>
</div>
```

### JavaScript 專屬驗證邏輯

```javascript
<script type="text/javascript">
$(document).ready(function() {
    // 補換發原因變更時，顯示/隱藏「其他原因說明」欄位
    $("#ACTION_RES").change(function() {
        if ($(this).val() == "05") {  // 001007 使用 "05" 代表其他
            $("#OTHER_RES_DIV").show();
            $("#OTHER_RES").attr("required", "required");
        } else {
            $("#OTHER_RES_DIV").hide();
            $("#OTHER_RES").removeAttr("required");
            $("#OTHER_RES").val("");
        }
    });
    
    // 專科類別變更時的處理
    $("#LIC_TYPE").change(function() {
        var licTypeText = $("#LIC_TYPE option:selected").text();
        console.log("選擇的專科類別：" + licTypeText);
        // 可以根據專科類別做額外處理
    });
    
    // 初始化證書字號的「字」部分為「專醫」
    if (!$("#LIC_CD").val()) {
        $("#LIC_CD").val("專醫");
    }
    
    // 表單送出前驗證
    $("#main_form").submit(function(e) {
        // 驗證專科類別
        if (!$("#LIC_TYPE").val()) {
            alert("請選擇專科類別");
            $("#LIC_TYPE").focus();
            return false;
        }
        
        // 驗證補換發類型
        if (!$("input[name='ACTION_TYPE']:checked").val()) {
            alert("請選擇補換發類型");
            return false;
        }
        
        // 驗證證書字號
        if (!$("#LIC_CD").val() || !$("#LIC_NUM").val()) {
            alert("請輸入完整的證書字號");
            return false;
        }
        
        // 驗證核發日期
        if (!$("#ISSUE_DATE").val()) {
            alert("請輸入核發日期");
            $("#ISSUE_DATE").focus();
            return false;
        }
        
        // 驗證補換發原因
        if (!$("#ACTION_RES").val()) {
            alert("請選擇補換發原因");
            $("#ACTION_RES").focus();
            return false;
        }
        
        // 如果選擇「其他」，必須填寫說明
        if ($("#ACTION_RES").val() == "05" && !$("#OTHER_RES").val()) {
            alert("請填寫其他原因說明");
            $("#OTHER_RES").focus();
            return false;
        }
        
        return true;
    });
});
</script>
```

---

## DAO 方法專屬實作

### QueryApply_001007() - 查詢申請案

```csharp
/// <summary>
/// 查詢 001007 申請案資料
/// </summary>
public Apply_001007ViewModel QueryApply_001007(string appId)
{
    string sql = @"
        SELECT 
            a.APP_ID, a.SRV_ID, a.ACC_NO, a.IDN, a.NAME, a.BIRTHDAY,
            a.MOBILE, a.TEL_SEC, a.TEL_NO, a.TEL_EXT, a.EMAIL,
            a.CITY_CODE, a.CITY_TEXT, a.CITY_DETAIL, a.ADDRESS,
            a.FLOW_CD, a.APPLY_DATE, a.IP,
            d.ACTION_TYPE, d.ISSUE_DATE, d.LIC_TYPE,
            d.LIC_CD, d.LIC_NUM, d.ACTION_RES, d.OTHER_RES
        FROM APPLY a
        INNER JOIN APPLY_001007 d ON a.APP_ID = d.APP_ID
        WHERE a.APP_ID = @APP_ID
          AND a.DEL_MK = 'N'
    ";
    
    using (var conn = new SqlConnection(connectionString))
    {
        var result = conn.Query<Apply_001007ViewModel>(sql, new { APP_ID = appId }).FirstOrDefault();
        
        // 查詢附件清單
        if (result != null)
        {
            result.Files = QueryApplyFiles(appId);
        }
        
        return result;
    }
}
```

### InsertApply001007() - 新增申請案明細

```csharp
/// <summary>
/// 新增 APPLY_001007 明細資料
/// </summary>
public void InsertApply001007(Apply_001007ViewModel model, SqlTransaction trans)
{
    string sql = @"
        INSERT INTO APPLY_001007 (
            APP_ID, ACTION_TYPE, ISSUE_DATE, LIC_TYPE,
            LIC_CD, LIC_NUM, ACTION_RES, OTHER_RES, EMAIL,
            ADD_TIME, ADD_FUN_CD, ADD_ACC
        ) VALUES (
            @APP_ID, @ACTION_TYPE, @ISSUE_DATE, @LIC_TYPE,
            @LIC_CD, @LIC_NUM, @ACTION_RES, @OTHER_RES, @EMAIL,
            GETDATE(), 'WEB-APPLY', @ADD_ACC
        )
    ";
    
    trans.Connection.Execute(sql, new
    {
        APP_ID = model.APP_ID,
        ACTION_TYPE = model.ACTION_TYPE,
        ISSUE_DATE = model.ISSUE_DATE,
        LIC_TYPE = model.LIC_TYPE,  // 關鍵專屬欄位：專科類別
        LIC_CD = model.LIC_CD,
        LIC_NUM = model.LIC_NUM,
        ACTION_RES = model.ACTION_RES,
        OTHER_RES = model.OTHER_RES,
        EMAIL = model.MAIL,
        ADD_ACC = model.ADD_ACC
    }, trans);
}
```

---

## 與其他服務的差異

### 與 001005（醫事人員證書補換發）的差異

| 項目           | 001005                         | 001007                         |
| -------------- | ------------------------------ | ------------------------------ |
| 服務名稱       | 醫事人員證書補(換)發           | 專科醫師證書補(換)發           |
| 證書類別欄位   | `DIVISION`                     | `LIC_TYPE`                     |
| 證書類別內容   | 醫事人員類別（醫師、護理師等） | 專科醫師類別（內科、外科等）   |
| 核發單位欄位   | `ISSUE_DEPT`（有）             | 無                             |
| 證書類型欄位   | `LIC_TYPE`（有）               | 無（LIC_TYPE 用於專科類別）    |
| 證書字號預設值 | 依證書類別而定                 | 固定為「專醫」                 |
| 申請對象       | 所有醫事人員                   | 僅限專科醫師                   |
| 核發日期       | 選填                           | 必填                           |
| 補換發原因代碼 | 01=遺失, 02=毀損, 03=變更姓名, 99=其他 | 01=遺失, 02=毀損, 03=污損, 04=變更姓名, 05=其他 |

**關鍵差異說明：**

1. **欄位名稱相同但用途不同**：
   - 001005 的 `LIC_TYPE` 用於「證書類型」
   - 001007 的 `LIC_TYPE` 用於「專科類別」

2. **資料表結構更簡潔**：
   - 001007 沒有 `ISSUE_DEPT` 欄位
   - 001007 沒有額外的證書類型欄位

3. **業務邏輯差異**：
   - 001007 的核發日期為必填
   - 001007 的證書字號固定為「專醫」

---

**版本：** 1.0
**日期：** 2025-10-20
**作者：** 柏通股份有限公司
