# 001038 生殖細胞及胚胎輸入輸出 - 完整技術文件

## 服務基本資訊

| 項目             | 內容                                                                                             |
| ---------------- | ------------------------------------------------------------------------------------------------ |
| **服務代碼**     | 001038                                                                                           |
| **服務名稱**     | 生殖細胞及胚胎輸入輸出                                                                           |
| **業務單位**     | 衛生福利部國民健康署                                                                             |
| **是否需繳費**   | 否                                                                                               |
| **Controller**   | `ES/Controllers/Apply_001038Controller.cs` (692 行)                                              |
| **ViewModel**    | `ES/Models/ViewModels/APPLY_001038ViewModel.cs` (1,936 行)                                       |
| **Entity Model** | `ES/Models/Entities/Apply_001038Model.cs` (579 行)                                               |
| **主要資料表**   | APPLY, APPLY_001038, APPLY_001038_DEST, APPLY_001038_SELL, APPLY_001038_GOODS, APPLY_001038_FILE |
| **檔案數量**     | 6 個固定檔案上傳欄位（可選）                                                                     |

---

## 服務特色

### 與其他服務的差異

| 項目             | 001035 器官組織進出口 | 001037 無懲戒紀錄證明 | **001038 生殖細胞及胚胎輸入輸出** |
| ---------------- | --------------------- | --------------------- | --------------------------------- |
| **服務性質**     | 器官組織進出口        | 無懲戒紀錄證明        | **生殖細胞及胚胎輸入輸出**        |
| **進出口選擇**   | 有（進口/出口）       | 無                    | **有（輸入/輸出）**               |
| **繳費方式**     | 無                    | 5 種                  | **無**                            |
| **動態貨品清單** | 有                    | 無                    | **有**                            |
| **固定檔案上傳** | 23 個                 | 3 個                  | **6 個（可選）**                  |
| **複雜度**       | ⭐⭐⭐⭐⭐ 極高       | ⭐⭐⭐⭐ 高           | **⭐⭐⭐⭐⭐ 極高**               |

### 核心功能

1. **輸入/輸出選擇**

   - 輸入（IM_EXPORT = "0"）：從國外輸入生殖細胞或胚胎到台灣
   - 輸出（IM_EXPORT = "1"）：從台灣輸出生殖細胞或胚胎到國外

2. **輸入資訊管理**（當選擇輸入時）

   - 原儲存機構資訊（名稱、國別、聯絡人、電話、Email、地址）
   - 我國承接機構資訊（名稱、聯絡人、許可文號、電話、Email）
   - 輸入目的
   - 輸入生殖細胞或胚胎數量（3 種類型：A/B/C）

3. **輸出資訊管理**（當選擇輸出時）

   - 申請機構資訊（名稱、聯絡人、許可文號、電話、Email）
   - 輸出目的地國家
   - 承接機構資訊（名稱、電話、Email、地址）
   - 輸出目的
   - 輸出生殖細胞或胚胎數量（3 種類型：A/B/C）

4. **委託人資料管理**

   - 委託人身分證字號或護照號碼
   - 委託人姓名
   - 委託人聯絡地址
   - 委託人二（配偶，胚胎輸出入時填寫）
   - 委託人聯絡電話、Email、傳真
   - 起始日期、終止日期
   - 轉口岸、啟運口岸

5. **動態貨品清單管理**

   - 可新增、刪除貨品項目
   - 每個貨品項目包含：貨品名稱、數量、單位等資訊

6. **檢附文件管理**（6 個固定檔案，可選）

   - 檢附文件類型一：委託人身分證明文件影本
   - 檢附文件類型二：輸入或輸出申請書
   - 檢附文件類型三：委託書
   - 檢附文件類型四：切結書
   - 檢附文件類型五：輸出或輸入國主管機關開立之許可證明
   - 檢附文件類型六：輸入國承接機構開立之承接同意書

7. **其他資料**
   - 申請用途
   - 核發方式

---

## 系統架構

### 架構圖

```
使用者 → Controller → DAO → Database
         ↓
      ViewModel
         ↓
      Razor View
         ↓
   動態貨品清單 (GoodsDynamicGrid)
```

**說明：**

- 使用者透過瀏覽器填寫表單
- Controller 接收請求並處理業務邏輯
- ViewModel 負責資料驗證和格式轉換
- DAO 負責資料庫操作
- Razor View 負責頁面呈現
- 動態貨品清單使用 GoodsDynamicGrid 元件

### 資料流程圖

```
1. 申請流程：
   使用者選擇輸入/輸出 → 填寫機構資訊 → 填寫委託人資料 →
   新增貨品清單 → 上傳檢附文件 → 選擇申請用途和核發方式 →
   預覽 → 送出 → 完成

2. 儲存流程：
   Controller.Apply() → DAO.SaveApply001038() →
   INSERT APPLY → INSERT APPLY_001038 →
   INSERT APPLY_001038_DEST / APPLY_001038_SELL →
   INSERT APPLY_001038_GOODS → INSERT APPLY_001038_FILE →
   寄送通知郵件 → 顯示完成頁面

3. 查詢流程：
   Controller.Query() → DAO.QueryApply001038() →
   SELECT APPLY → SELECT APPLY_001038 →
   SELECT APPLY_001038_DEST / APPLY_001038_SELL →
   SELECT APPLY_001038_GOODS → SELECT APPLY_001038_FILE →
   顯示查詢結果
```

---

## 資料庫結構

### 1. APPLY 資料表（主表）

**說明：** 所有申辦案件的主表

**主要欄位：**

- `APP_ID` (PK)：案件編號
- `SRV_ID`：服務代碼（001038）
- `ACC_NO`：申請人帳號
- `NAME`：申請人姓名
- `IDN`：申請人身分證字號
- `FLOW_CD`：流程狀態（1:申請中, 2:補件中, 3:補件完成）
- `UNIT_CD`：業務單位
- `APP_TIME`：申請時間
- `APP_EXT_DATE`：展延日期

### 2. APPLY_001038 資料表（服務明細表）

**說明：** 001038 服務的詳細資料

**主要欄位：**

| 欄位名稱                                      | 資料型別 | 長度 | NULL | 說明                       | 範例值             |
| --------------------------------------------- | -------- | ---- | ---- | -------------------------- | ------------------ |
| `APP_ID`                                      | varchar  | 50   | NO   | 案件編號（PK）             | 001038202501130001 |
| `TAX_ORG_ID`                                  | varchar  | 50   | YES  | 委託人身分證字號或護照號碼 | A123456789         |
| `TAX_ORG_NAME`                                | varchar  | 100  | YES  | 委託人姓名                 | 王小明             |
| `TAX_ORG_ENAME`                               | varchar  | 100  | YES  | 委託人姓名（英文）         | Wang Xiao Ming     |
| `TAX_ORG_ADDR`                                | varchar  | 200  | YES  | 委託人聯絡地址             | 台北市中正區...    |
| `TAX_ORG_EADDR`                               | varchar  | 200  | YES  | 委託人聯絡地址（英文）     | Taipei City...     |
| `TAX_ORG_MAN`                                 | varchar  | 100  | YES  | 委託人二姓名（配偶）       | 李小華             |
| `TAX_ORG_TID`                                 | varchar  | 50   | YES  | 委託人二身分證字號         | B987654321         |
| `TAX_ORG_TEL`                                 | varchar  | 50   | YES  | 委託人聯絡電話             | 02-12345678        |
| `TAX_ORG_EMAIL`                               | varchar  | 100  | YES  | 委託人 Email               | test@example.com   |
| `TAX_ORG_FAX`                                 | varchar  | 50   | YES  | 委託人傳真                 | 02-87654321        |
| `IM_EXPORT`                                   | varchar  | 1    | YES  | 進出口別（0:輸入, 1:輸出） | 0                  |
| `DATE_S`                                      | datetime | -    | YES  | 起始日期                   | 2025-01-01         |
| `DATE_E`                                      | datetime | -    | YES  | 終止日期                   | 2025-12-31         |
| `DEST_STATE_ID`                               | varchar  | 10   | YES  | 輸入國家代碼               | US                 |
| `DEST_STATE`                                  | varchar  | 100  | YES  | 輸入國家名稱               | 美國               |
| `SELL_STATE_ID`                               | varchar  | 10   | YES  | 輸出國家代碼               | JP                 |
| `SELL_STATE`                                  | varchar  | 100  | YES  | 輸出國家名稱               | 日本               |
| `TRN_COUNTRY_ID`                              | varchar  | 10   | YES  | 轉口岸國家代碼             | HK                 |
| `TRN_PORT_ID`                                 | varchar  | 10   | YES  | 轉口岸代碼                 | HKG                |
| `TRN_PORT`                                    | varchar  | 100  | YES  | 轉口岸名稱                 | 香港               |
| `BEG_COUNTRY_ID`                              | varchar  | 10   | YES  | 啟運口岸國家代碼           | TW                 |
| `BEG_PORT_ID`                                 | varchar  | 10   | YES  | 啟運口岸代碼               | TPE                |
| `BEG_PORT`                                    | varchar  | 100  | YES  | 啟運口岸名稱               | 台北               |
| `APP_USE_ID`                                  | varchar  | 10   | YES  | 申請用途代碼               | 01                 |
| `APP_USE`                                     | varchar  | 100  | YES  | 申請用途名稱               | 醫療用途           |
| `USE_MARK`                                    | varchar  | 200  | YES  | 輸出入目的                 | 用於人工生殖       |
| `CONF_TYPE_ID`                                | varchar  | 10   | YES  | 核發方式代碼               | 01                 |
| `CONF_TYPE`                                   | varchar  | 100  | YES  | 核發方式名稱               | 紙本               |
| `DOC_TYP_01` ~ `DOC_TYP_06`                   | varchar  | 10   | YES  | 檢附文件類型 01~06         | B11                |
| `DOC_COD_01` ~ `DOC_COD_06`                   | varchar  | 50   | YES  | 檢附文件字號 01~06         | 文號 123           |
| `DOC_TXT_01` ~ `DOC_TXT_06`                   | varchar  | 500  | YES  | 檢附文件說明 01~06         | 說明文字           |
| `COPIES`                                      | int      | -    | YES  | 申請份數                   | 1                  |
| `MDOD_APPNO`                                  | varchar  | 50   | YES  | 原申請編號                 | -                  |
| **標準欄位**                                  |          |      |      |                            |                    |
| `ADD_TIME`, `ADD_FUN_CD`, `ADD_ACC`           |          |      |      | 新增資訊                   |                    |
| `UPD_TIME`, `UPD_FUN_CD`, `UPD_ACC`           |          |      |      | 更新資訊                   |                    |
| `DEL_MK`, `DEL_TIME`, `DEL_FUN_CD`, `DEL_ACC` |          |      |      | 刪除資訊                   |                    |

### 3. APPLY_001038_DEST 資料表（輸入資訊表）

**說明：** 儲存輸入相關資訊（當 IM_EXPORT = "0" 時使用）

**主要欄位：**

- `APP_ID` (PK)：案件編號
- `ORG_UNITNAME`：原儲存機構名稱
- `DEST_STATE_ID`：原儲存機構國別代碼
- `ORG_NAME`：原儲存機構聯絡人
- `ORG_TEL`：電話
- `ORG_EMAIL`：Email
- `TAI_ADDR`：原儲存機構地址
- `TAI_UNITNAME`：我國承接機構名稱
- `TAI_NAME`：我國承接機構聯絡人
- `LIC_NUM`：人工生殖機構許可文號
- `TAI_TEL`：電話
- `TAI_EMAIL`：Email
- `USE_MARK`：輸入目的
- `A_NAME`, `A_NUM1`, `A_DATE`：生殖細胞類型 A 資訊
- `B_NAME`, `B_NUM1`, `B_NUM2`, `B_DATE`：生殖細胞類型 B 資訊
- `C_NAME1`, `C_NAME2`, `C_NUM1`, `C_DATE`, `C_DAY`：胚胎類型 C 資訊

### 4. APPLY_001038_SELL 資料表（輸出資訊表）

**說明：** 儲存輸出相關資訊（當 IM_EXPORT = "1" 時使用）

**主要欄位：**

- `APP_ID` (PK)：案件編號
- `ORG_UNITNAME`：申請機構名稱
- `ORG_NAME`：人工生殖機構聯絡人
- `ORG_LIC_NUM`：人工生殖機構許可文號
- `ORG_TEL`：電話
- `ORG_EMAIL`：Email
- `SELL_STATE_ID`：輸出目的地國代碼
- `OTH_UNITNAME`：輸出國承接機構名稱
- `OTH_TEL`：承接機構電話
- `OTH_EMAIL`：承接機構 Email
- `OTH_ADDR`：承接機構地址
- `USE_MARK`：輸出目的
- `A_NAME`, `A_NUM1`, `A_DATE`：生殖細胞類型 A 資訊
- `B_NAME`, `B_NUM1`, `B_NUM2`, `B_DATE`：生殖細胞類型 B 資訊
- `C_NAME1`, `C_NAME2`, `C_NUM1`, `C_DATE`, `C_DAY`：胚胎類型 C 資訊

### 5. APPLY_001038_GOODS 資料表（貨品清單表）

**說明：** 儲存動態貨品清單資訊

**主要欄位：**

- `APP_ID` (PK)：案件編號
- `GOODS_NO` (PK)：貨品編號
- `GOODS_NAME`：貨品名稱
- `GOODS_QTY`：貨品數量
- `GOODS_UNIT`：貨品單位
- `GOODS_REMARK`：貨品備註

### 6. APPLY_001038_FILE 資料表（檔案資訊表）

**說明：** 儲存檢附文件檔案資訊

**主要欄位：**

- `APP_ID` (PK)：案件編號
- `FILE_NO` (PK)：檔案編號（1~6）
- `FILE_TYPE`：檔案類型（DOC_TYP_01 ~ DOC_TYP_06）
- `FILENAME`：實際檔案名稱（儲存在伺服器）
- `SRC_FILENAME`：原始檔案名稱
- `FILE_SIZE`：檔案大小
- `UPLOAD_TIME`：上傳時間

---

## ViewModel 結構

### Apply_001038FormModel

**繼承：** Apply_001038Model

**主要屬性：**

```csharp
public class Apply_001038FormModel : Apply_001038Model
{
    // 基本資訊
    public string APP_ID { get; set; }  // 案件編號
    public string SRV_ID { get; set; }  // 服務代碼（001038）
    public string SRC_SRV_ID { get; set; }  // 來源服務代碼
    public string ACC_NO { get; set; }  // 申請人帳號
    public string UNIT_CD { get; set; }  // 業務單位代碼
    public DateTime? APP_TIME { get; set; }  // 申辦時間
    public string APP_TIME_AD { get; set; }  // 申辦時間（民國年）

    // 進出口別
    public string IM_EXPORT { get; set; }  // 0:輸入, 1:輸出
    public string IDN { get; set; }  // 統一編號

    // 輸入資訊（當 IM_EXPORT = "0" 時）
    public string Dest_ORG_UNITNAME { get; set; }  // 原儲存機構名稱
    public string Dest_DEST_STATE_ID { get; set; }  // 原儲存機構國別
    public string Dest_ORG_NAME { get; set; }  // 原儲存機構聯絡人
    public string Dest_ORG_TEL { get; set; }  // 電話
    public string Dest_ORG_EMAIL { get; set; }  // Email
    public string Dest_TAI_ADDR { get; set; }  // 原儲存機構地址
    public string Dest_TAI_UNITNAME { get; set; }  // 我國承接機構名稱
    public string Dest_TAI_NAME { get; set; }  // 我國承接機構聯絡人
    public string Dest_LIC_NUM { get; set; }  // 人工生殖機構許可文號
    public string Dest_TAI_TEL { get; set; }  // 電話
    public string Dest_TAI_EMAIL { get; set; }  // Email
    public string Dest_USE_MARK { get; set; }  // 輸入目的

    // 輸入生殖細胞或胚胎數量（類型 A）
    public string Dest_A_NAME { get; set; }  // 名稱
    public string Dest_A_NUM1 { get; set; }  // 數量
    public DateTime? Dest_A_DATE { get; set; }  // 日期
    public string Dest_A_DATE_AD { get; set; }  // 日期（民國年）

    // 輸入生殖細胞或胚胎數量（類型 B）
    public string Dest_B_NAME { get; set; }  // 名稱
    public string Dest_B_NUM1 { get; set; }  // 數量 1
    public string Dest_B_NUM2 { get; set; }  // 數量 2
    public DateTime? Dest_B_DATE { get; set; }  // 日期
    public string Dest_B_DATE_AD { get; set; }  // 日期（民國年）

    // 輸入生殖細胞或胚胎數量（類型 C）
    public string Dest_C_NAME1 { get; set; }  // 名稱 1
    public string Dest_C_NAME2 { get; set; }  // 名稱 2
    public string Dest_C_NUM1 { get; set; }  // 數量
    public DateTime? Dest_C_DATE { get; set; }  // 日期
    public string Dest_C_DATE_AD { get; set; }  // 日期（民國年）
    public string Dest_C_DAY { get; set; }  // 天數

    // 輸出資訊（當 IM_EXPORT = "1" 時）
    public string Sell_ORG_UNITNAME { get; set; }  // 申請機構名稱
    public string Sell_ORG_NAME { get; set; }  // 人工生殖機構聯絡人
    public string Sell_ORG_LIC_NUM { get; set; }  // 人工生殖機構許可文號
    public string Sell_ORG_TEL { get; set; }  // 電話
    public string Sell_ORG_EMAIL { get; set; }  // Email
    public string Sell_SELL_STATE_ID { get; set; }  // 輸出目的地國
    public string Sell_OTH_UNITNAME { get; set; }  // 輸出國承接機構名稱
    public string Sell_OTH_TEL { get; set; }  // 承接機構電話
    public string Sell_OTH_EMAIL { get; set; }  // 承接機構Email
    public string Sell_OTH_ADDR { get; set; }  // 承接機構地址
    public string Sell_USE_MARK { get; set; }  // 輸出目的

    // 輸出生殖細胞或胚胎數量（類型 A）
    public string Sell_A_NAME { get; set; }  // 名稱
    public string Sell_A_NUM1 { get; set; }  // 數量
    public DateTime? Sell_A_DATE { get; set; }  // 日期
    public string Sell_A_DATE_AD { get; set; }  // 日期（民國年）

    // 輸出生殖細胞或胚胎數量（類型 B）
    public string Sell_B_NAME { get; set; }  // 名稱
    public string Sell_B_NUM1 { get; set; }  // 數量 1
    public string Sell_B_NUM2 { get; set; }  // 數量 2
    public DateTime? Sell_B_DATE { get; set; }  // 日期
    public string Sell_B_DATE_AD { get; set; }  // 日期（民國年）

    // 輸出生殖細胞或胚胎數量（類型 C）
    public string Sell_C_NAME1 { get; set; }  // 名稱 1
    public string Sell_C_NAME2 { get; set; }  // 名稱 2
    public string Sell_C_NUM1 { get; set; }  // 數量
    public DateTime? Sell_C_DATE { get; set; }  // 日期
    public string Sell_C_DATE_AD { get; set; }  // 日期（民國年）
    public string Sell_C_DAY { get; set; }  // 天數

    // 委託人資料
    public string TAX_ORG_ID { get; set; }  // 身分證字號或護照號碼
    public string TAX_ORG_NAME { get; set; }  // 委託人姓名
    public string TAX_ORG_ADDR { get; set; }  // 委託人聯絡地址
    public string TAX_ORG_MAN { get; set; }  // 委託人二姓名（配偶）
    public string TAX_ORG_TID { get; set; }  // 委託人二身分證字號
    public string TAX_ORG_TEL { get; set; }  // 委託人聯絡電話
    public string TAX_ORG_EMAIL { get; set; }  // 委託人Email
    public string TAX_ORG_FAX { get; set; }  // 委託人傳真
    public string DATE_S_AD { get; set; }  // 起始日期（民國年）
    public string DATE_E_AD { get; set; }  // 終止日期（民國年）
    public string TRN_COUNTRY_ID { get; set; }  // 轉口岸國家代碼
    public string TRN_PORT_ID { get; set; }  // 轉口岸代碼
    public string BEG_COUNTRY_ID { get; set; }  // 啟運口岸國家代碼
    public string BEG_PORT_ID { get; set; }  // 啟運口岸代碼

    // 貨品資料
    public GoodsDynamicGrid<Apply_001038_GoodsViewModel> GOODS { get; set; }  // 動態貨品清單

    // 其他資料
    public string APP_USE_ID { get; set; }  // 申請用途
    public string CONF_TYPE_ID { get; set; }  // 核發方式

    // 檢附文件（6 個固定檔案，可選）
    public Boolean DOC_TYP_01_SHOW { get; set; }  // 檢附文件類型一勾選
    public string DOC_COD_01 { get; set; }  // 檢附文件字號一
    public string DOC_TXT_01 { get; set; }  // 檢附文件說明一
    public HttpPostedFileBase DOC_FILE_01 { get; set; }  // 檢附文件檔案一
    public string DOC_FILE_01_FILENAME { get; set; }  // 檢附文件檔案名稱一

    public Boolean DOC_TYP_02_SHOW { get; set; }  // 檢附文件類型二勾選
    public string DOC_COD_02 { get; set; }  // 檢附文件字號二
    public string DOC_TXT_02 { get; set; }  // 檢附文件說明二
    public HttpPostedFileBase DOC_FILE_02 { get; set; }  // 檢附文件檔案二
    public string DOC_FILE_02_FILENAME { get; set; }  // 檢附文件檔案名稱二

    public Boolean DOC_TYP_03_SHOW { get; set; }  // 檢附文件類型三勾選
    public string DOC_COD_03 { get; set; }  // 檢附文件字號三
    public string DOC_TXT_03 { get; set; }  // 檢附文件說明三
    public HttpPostedFileBase DOC_FILE_03 { get; set; }  // 檢附文件檔案三
    public string DOC_FILE_03_FILENAME { get; set; }  // 檢附文件檔案名稱三

    public Boolean DOC_TYP_04_SHOW { get; set; }  // 檢附文件類型四勾選
    public string DOC_COD_04 { get; set; }  // 檢附文件字號四
    public string DOC_TXT_04 { get; set; }  // 檢附文件說明四
    public HttpPostedFileBase DOC_FILE_04 { get; set; }  // 檢附文件檔案四
    public string DOC_FILE_04_FILENAME { get; set; }  // 檢附文件檔案名稱四

    public Boolean DOC_TYP_05_SHOW { get; set; }  // 檢附文件類型五勾選
    public string DOC_COD_05 { get; set; }  // 檢附文件字號五
    public string DOC_TXT_05 { get; set; }  // 檢附文件說明五
    public HttpPostedFileBase DOC_FILE_05 { get; set; }  // 檢附文件檔案五
    public string DOC_FILE_05_FILENAME { get; set; }  // 檢附文件檔案名稱五

    public Boolean DOC_TYP_06_SHOW { get; set; }  // 檢附文件類型六勾選
    public string DOC_COD_06 { get; set; }  // 檢附文件字號六
    public string DOC_TXT_06 { get; set; }  // 檢附文件說明六
    public HttpPostedFileBase DOC_FILE_06 { get; set; }  // 檢附文件檔案六
    public string DOC_FILE_06_FILENAME { get; set; }  // 檢附文件檔案名稱六

    // 控制欄位
    public bool IsNew { get; set; }  // 是否為新增
    public string IsMode { get; set; }  // 模式
}
```

---

## 技術重點

### 1. 輸入/輸出選擇機制

**特點：**

- 使用單選按鈕選擇輸入或輸出
- 根據選擇動態顯示/隱藏對應的表單區塊
- 輸入和輸出的欄位驗證規則不同

**實作方式：**

```javascript
// 當選擇輸入/輸出時，動態顯示/隱藏對應區塊
$("#IM_EXPORT").change(function () {
  var value = $(this).val();
  if (value == "0") {
    // 輸入
    $("#IMPORT").show();
    $("#EXPORT").hide();
    // 清除輸出欄位的驗證錯誤
    clearValidationErrors("Sell_");
  } else if (value == "1") {
    // 輸出
    $("#IMPORT").hide();
    $("#EXPORT").show();
    // 清除輸入欄位的驗證錯誤
    clearValidationErrors("Dest_");
  }
});
```

**Controller 端處理：**

```csharp
[HttpPost]
public ActionResult Apply(Apply_001038FormModel model)
{
    // 根據進出口別清除不需要的驗證錯誤
    if (model.IM_EXPORT == "0")  // 輸入
    {
        foreach (var item in ModelState)
        {
            if (item.Key.ToLeft(5) == "Sell_")
            {
                item.Value.Errors.Clear();
            }
        }
    }
    if (model.IM_EXPORT == "1")  // 輸出
    {
        foreach (var item in ModelState)
        {
            if (item.Key.ToLeft(5) == "Dest_")
            {
                item.Value.Errors.Clear();
            }
        }
    }

    // 繼續處理...
}
```

### 2. 生殖細胞或胚胎數量管理

**3 種類型：**

**類型 A：**

- 名稱（A_NAME）
- 數量（A_NUM1）
- 日期（A_DATE）

**類型 B：**

- 名稱（B_NAME）
- 數量 1（B_NUM1）
- 數量 2（B_NUM2）
- 日期（B_DATE）

**類型 C：**

- 名稱 1（C_NAME1）
- 名稱 2（C_NAME2）
- 數量（C_NUM1）
- 日期（C_DATE）
- 天數（C_DAY）

**實作方式：**

- 使用勾選框控制是否填寫
- 勾選後才顯示對應的輸入欄位
- 至少需要勾選一種類型

### 3. 動態貨品清單管理

**特點：**

- 使用 GoodsDynamicGrid 元件
- 可新增、刪除貨品項目
- 每個貨品項目包含：貨品名稱、數量、單位等資訊

**實作方式：**

```csharp
public class Apply_001038FormModel : Apply_001038Model
{
    public Apply_001038FormModel()
    {
        GOODS = new GoodsDynamicGrid<Apply_001038_GoodsViewModel>();
        GOODS.APP_ID = this.APP_ID;
        GOODS.model = new Apply_001038_GoodsViewModel();
        GOODS.GetGoodsList();
        GOODS.SourceModelName = "GOODS";
        GOODS.IsReadOnly = false;
        GOODS.IsNewOpen = true;
        GOODS.IsDeleteOpen = true;
        this.IsNew = true;
    }

    public GoodsDynamicGrid<Apply_001038_GoodsViewModel> GOODS { get; set; }
}
```

### 4. 檢附文件管理（6 個固定檔案，可選）

**6 種檢附文件類型：**

1. **檢附文件類型一（DOC_TYP_01）**：委託人身分證明文件影本
2. **檢附文件類型二（DOC_TYP_02）**：輸入或輸出申請書
3. **檢附文件類型三（DOC_TYP_03）**：委託書
4. **檢附文件類型四（DOC_TYP_04）**：切結書
5. **檢附文件類型五（DOC_TYP_05）**：輸出或輸入國主管機關開立之許可證明
6. **檢附文件類型六（DOC_TYP_06）**：輸入國承接機構開立之承接同意書

**實作方式：**

- 使用勾選框控制是否上傳
- 勾選後才顯示檔案上傳欄位、文件字號、文件說明
- 每個檔案都有對應的字號和說明欄位

**JavaScript 控制：**

```javascript
function doDocCheck(checkbox) {
  var formId = checkbox.attr("form_id");
  var isChecked = checkbox.is(":checked");

  if (isChecked) {
    $("#" + formId)
      .closest("tr")
      .show();
  } else {
    $("#" + formId)
      .closest("tr")
      .hide();
    $("#" + formId).val(""); // 清空欄位值
  }
}
```

### 5. 轉口岸和啟運口岸選擇

**特點：**

- 轉口岸：TRN_COUNTRY_ID（國家） + TRN_PORT_ID（港口）
- 啟運口岸：BEG_COUNTRY_ID（國家） + BEG_PORT_ID（港口）
- 使用兩層下拉選單（國家 → 港口）

**實作方式：**

- 先選擇國家，再選擇該國家的港口
- 港口選單根據國家選擇動態載入

---

## 相關檔案清單

### 前端檔案

- `ES/Controllers/Apply_001038Controller.cs` (692 行) - 控制器
- `ES/Models/ViewModels/APPLY_001038ViewModel.cs` (1,936 行) - 視圖模型
- `ES/Models/ViewModels/APPLY_001038_FILEViewModel.cs` - 檔案視圖模型
- `ES/Models/ViewModels/Apply_001038_GoodsViewMdoel.cs` - 貨品視圖模型
- `ES/Views/Apply_001038/Prompt001038.cshtml` - 說明事項頁面
- `ES/Views/Apply_001038/Index.cshtml` - 申請表單
- `ES/Views/Apply_001038/PreView.cshtml` - 預覽頁面
- `ES/Views/Apply_001038/Done.cshtml` - 完成頁面
- `ES/Views/Apply_001038/GoodsDynamicGrid001038.cshtml` - 動態貨品清單

### 後端檔案

- `ES/DataLayers/ApplyDAO.cs` - 資料存取層（包含 SaveApply001038, QueryApply001038 方法）
- `ES/DataLayers/ShareDAO.cs` - 共用資料存取層
- `ES/Models/Entities/Apply_001038Model.cs` (579 行) - 實體模型
- `ES/Models/Entities/Apply_001038_DEST.cs` - 輸入資訊實體
- `ES/Models/Entities/Apply_001038_SELL.cs` - 輸出資訊實體
- `ES/Models/Entities/Apply_001038_GoodsMdoel.cs` - 貨品實體
- `ES/Models/Entities/Apply_001038_FileModel.cs` - 檔案實體
- `ES/Models/Entities/APPLYModel.cs` - APPLY 實體

### 資料庫資料表

- `SERVICE` - 服務定義表
- `APPLY` - 申請主表
- `APPLY_001038` - 服務明細表
- `APPLY_001038_DEST` - 輸入資訊表
- `APPLY_001038_SELL` - 輸出資訊表
- `APPLY_001038_GOODS` - 貨品清單表
- `APPLY_001038_FILE` - 檔案資訊表
- `CODE_CD` - 代碼表

---

## 注意事項

### 1. 輸入/輸出選擇

- 必須選擇輸入或輸出
- 輸入和輸出的欄位不同，需根據選擇填寫對應欄位
- 切換輸入/輸出時，原有填寫的資料會被清除

### 2. 生殖細胞或胚胎數量

- 至少需要勾選一種類型（A/B/C）
- 勾選後才需要填寫對應的欄位
- 日期格式為民國年（YYY/MM/DD）

### 3. 委託人資料

- 委託人身分證字號或護照號碼為必填
- 委託人二（配偶）為選填，胚胎輸出入時建議填寫
- 起始日期和終止日期為必填

### 4. 動態貨品清單

- 至少需要新增一個貨品項目
- 貨品名稱、數量、單位為必填
- 可隨時新增或刪除貨品項目

### 5. 檢附文件

- 檢附文件為可選
- 勾選後才需要上傳檔案
- 只接受 PDF 格式
- 檔案大小不超過 5MB（所有檔案總和）
- 每個檔案都可以填寫文件字號和說明

### 6. 申請用途和核發方式

- 申請用途為必填
- 核發方式為必填（紙本或電子）

---

**版本：** 1.0
**日期：** 2025-10-20
**作者：** 柏通股份有限公司
