# 代碼庫版本差異分析報告

## 文件資訊

- **分析日期**: 2025-11-20
- **舊版代碼庫**: `CodeBase/109_e-service/`
- **新版代碼庫**: `CodeBaseNew/e-service/`
- **分析目的**: 識別新版代碼庫中缺失或新增的重要文件和功能

---

## 執行摘要

經過詳細比對，新版代碼庫相較於舊版有以下主要差異：

### 🔴 **重大缺失項目**

1. **Resource Area 完全缺失** - 資源管理區域整個模組不存在
2. **DatePickerExtension.cs 缺失** - 日期選擇器擴展功能
3. **部分配置文件缺失** - Web.Debug.config, Web.Release.config, Web-2021-rc1.config
4. **fonts 目錄缺失** - 字體文件目錄
5. **aspnet_client 目錄缺失** - ASP.NET 客戶端文件
6. **部分圖片文件缺失** - 多個橫幅和圖示文件

### 🟢 **新增項目**

1. **Bootstrap 4/5 相關文件** - 升級的 Bootstrap 框架文件
2. **jQuery UI 1.13.2** - 更新的 jQuery UI 版本
3. **obj 目錄** - 編譯輸出目錄（開發環境產物）
4. **ES.csproj.user** - Visual Studio 用戶配置文件
5. **Microsoft.mshtml.dll** - 新增的依賴庫
6. **新的 Bootstrap 模組化文件** - bootstrap-grid, bootstrap-reboot 等

---

## 詳細差異分析

### 1. 目錄結構差異

#### 1.1 缺失的主要目錄

| 目錄路徑          | 用途說明                 | 影響程度    |
| ----------------- | ------------------------ | ----------- |
| `Areas/Resource/` | 資源管理區域（完整模組） | ⚠️ **嚴重** |
| `fonts/`          | 字體文件目錄             | ⚠️ **中等** |
| `aspnet_client/`  | ASP.NET 客戶端系統文件   | ⚠️ **中等** |
| `Content/images/` | 內容圖片目錄             | ⚠️ **中等** |

#### 1.2 新增的目錄

| 目錄路徑       | 用途說明       | 備註                         |
| -------------- | -------------- | ---------------------------- |
| `obj/`         | 編譯輸出目錄   | 開發環境產物，通常不納入版控 |
| `Scripts/esm/` | ES Module 腳本 | 現代化 JavaScript 模組       |

---

### 2. 配置文件差異

#### 2.1 缺失的配置文件

```
舊版存在 ✓ | 新版缺失 ✗
├── Web.Debug.config          (調試環境配置)
├── Web.Release.config        (發布環境配置)
├── Web-2021-rc1.config       (2021版本配置)
└── ES.Publish.xml            (發布配置)
```

**影響**:

- 無法進行環境特定的配置轉換
- 部署到不同環境時可能出現配置問題
- 缺少發布配置可能導致部署流程中斷

#### 2.2 保留的配置文件

```
兩版本都存在 ✓
├── Web.config                (主要配置文件)
├── packages.config           (NuGet 套件配置)
└── ES.csproj                 (專案文件)
```

---

### 3. Areas（區域）模組差異

#### 3.1 Resource Area 完全缺失 ⚠️

**舊版 Resource Area 的正確路徑**:

```
📁 舊版代碼庫中的 Resource Area 位置:

1. CodeBase/109_e-service/ES/Areas/Resource/
   ├── Controllers/
   │   ├── BaseController.cs          (基礎控制器，含驗證機制)
   │   ├── DBController.cs            (資料庫管理工具)
   │   ├── DT1Controller.cs           (DT1 資源控制器)
   │   └── FileController.cs          (檔案管理工具)
   ├── Models/                        (資源模型)
   ├── Views/
   │   ├── DB/
   │   │   └── Index.cshtml           (SQL 執行介面)
   │   ├── File/                      (檔案管理介面)
   │   └── Shared/
   └── ResourceAreaRegistration.cs    (區域路由註冊)

2. CodeBase/trunk_DISK_trunk/trunk/Areas/Resource/
   ├── Controllers/
   │   ├── BaseController.cs
   │   ├── CkEEC.cs                   (額外的控制器)
   │   ├── DBController.cs
   │   ├── DT1Controller.cs
   │   └── FileController.cs
   └── Views/
       ├── CkEEC/                     (額外的視圖)
       ├── DB/
       ├── File/
       └── Shared/
```

**新版代碼庫中的對應位置**:

```
❌ 新版代碼庫 (CodeBaseNew/e-service/ES/Areas/) 中完全缺失

現有的 Areas:
├── Admin/                            (管理員區域)
├── BACKMIN/                          (後台管理區域)
└── Schedule/                         (排程任務區域)

⚠️ Resource Area 不存在於新版中
```

**Resource Area 功能詳細說明**:

1. **DBController.cs** - 資料庫管理工具

   - 功能: 提供線上 SQL 查詢和執行介面
   - 用途: 開發/維護人員可直接執行 SQL 語句
   - 安全機制: 需要特殊驗證碼 (`turbo@13141806`)
   - 支援連線: 預設連線、醫事簽審連線
   - 操作模式: 查詢模式、異動模式

2. **FileController.cs** - 檔案管理工具

   - 功能: 伺服器端檔案管理
   - 支援操作:
     - 上傳檔案
     - 建立資料夾
     - 刪除檔案/資料夾
     - 下載壓縮檔
   - 用途: 管理系統檔案資源

3. **DT1Controller.cs** - DT1 資源控制器

   - 功能: 特定資源管理（需進一步確認用途）

4. **BaseController.cs** - 基礎控制器
   - 安全機制:
     - 僅允許本機 (localhost) 訪問
     - 或通過特定驗證
     - Session 驗證機制
   - 防護: 非授權訪問返回 404

**影響評估**:

- ⚠️ **嚴重**: 這是一個完整的開發/維護工具模組缺失
- **主要影響**:
  - 無法使用線上 SQL 查詢工具
  - 無法使用伺服器端檔案管理工具
  - 開發和維護效率降低
- **安全考量**: Resource Area 包含敏感功能，僅供內部使用
- **建議**: 確認是否為安全考量而刻意移除，或需要從舊版補回

#### 3.2 保留的 Areas

| Area 名稱 | 功能說明     | 狀態   |
| --------- | ------------ | ------ |
| Admin     | 管理員功能區 | ✓ 存在 |
| BACKMIN   | 後台管理區   | ✓ 存在 |
| Schedule  | 排程任務區   | ✓ 存在 |

---

### 4. Helpers（輔助類）差異

#### 4.1 缺失的 Helper 文件

| 文件名稱                 | 功能說明       | 影響        |
| ------------------------ | -------------- | ----------- |
| `DatePickerExtension.cs` | 日期選擇器擴展 | ⚠️ **中等** |

**詳細說明**:

- 舊版有 `DatePickerExtension.cs`（標準日期選擇器）
- 新版只保留 `DatePickerACExtension.cs`（民國年日期選擇器）和 `DatePickerTWExtension.cs`（台灣日期選擇器）
- 可能影響使用西元年份的日期選擇功能

#### 4.2 保留的 Helper 文件（24 個）

所有其他 Helper 文件均完整保留，包括：

- ABCNUMExtension.cs
- AddrExtension.cs
- CheckboxListExtension.cs
- ControlExtension.cs
- 等等...（共 24 個文件）

---

### 5. 前端資源差異

#### 5.1 JavaScript 庫版本變更

| 庫名稱    | 舊版版本 | 新版版本 | 變更類型 |
| --------- | -------- | -------- | -------- |
| jQuery    | 1.10.1   | 3.7.1    | ✓ 升級   |
| jQuery UI | 1.10.3   | 1.13.2   | ✓ 升級   |
| Bootstrap | 3.x      | 4.x/5.x  | ✓ 升級   |

**影響分析**:

- ✅ **正面**: 安全性和性能提升
- ⚠️ **風險**: 可能存在 API 不兼容問題
- 📝 **建議**: 需要進行完整的兼容性測試

#### 5.2 缺失的 JavaScript 文件

```
舊版存在 ✓ | 新版缺失 ✗
├── Scripts/_references.js                    (腳本引用文件)
├── Scripts/jquery-1.10.1.js                  (舊版 jQuery)
├── Scripts/jquery-1.10.1.min.js
├── Scripts/jquery-ui-1.10.3.js               (舊版 jQuery UI)
├── Scripts/jquery-ui-1.10.3.min.js
└── Scripts/jquery.maskedinput/               (輸入遮罩插件目錄)
```

#### 5.3 新增的 JavaScript 文件

```
新版新增 ✓
├── Scripts/README.md                         (說明文件)
├── Scripts/bootstrap.bundle.js               (Bootstrap 捆綁版)
├── Scripts/bootstrap.bundle.min.js
├── Scripts/esm/                              (ES Module 目錄)
├── Scripts/index.d.ts                        (TypeScript 定義)
├── Scripts/index.js.flow                     (Flow 類型定義)
└── Scripts/jquery-ui-1.13.2.js               (新版 jQuery UI)
```

#### 5.4 CSS 樣式文件差異

**缺失的 CSS 文件**:

```
舊版存在 ✓ | 新版缺失 ✗
└── Content/images/                           (圖片目錄)
    ├── icon-arrow-right.png
    ├── sm-adv2.png
    └── step-line.png
```

**新增的 CSS 文件**:

```
新版新增 ✓
├── Content/bootstrap-grid.css                (Bootstrap 網格系統)
├── Content/bootstrap-grid.min.css
├── Content/bootstrap-reboot.css              (Bootstrap 重置樣式)
└── Content/bootstrap-reboot.min.css
```

---

### 6. 圖片資源差異

#### 6.1 缺失的圖片文件

| 文件名稱                     | 用途         | 位置    |
| ---------------------------- | ------------ | ------- |
| `3d-Icon-ecommercia-011.png` | 3D 圖示      | Images/ |
| `3d-Icon-ecommercia-02.png`  | 3D 圖示      | Images/ |
| `banner-20210108-a.jpg`      | 橫幅圖片     | Images/ |
| `favicon2.ico`               | 備用網站圖標 | 根目錄  |

**影響**:

- 可能導致部分頁面圖片顯示異常
- 橫幅廣告可能無法正常顯示

#### 6.2 保留的重要圖片

所有主要的系統圖片均保留，包括：

- logo.png, logo-login.png
- banner-1.jpg ~ banner-5.jpg
- 各種系統圖示和背景圖

---

### 7. 二進制文件和依賴庫差異

#### 7.1 新增的 DLL 文件

| DLL 名稱               | 用途          | 備註     |
| ---------------------- | ------------- | -------- |
| `Microsoft.mshtml.dll` | HTML 文檔操作 | 新增依賴 |

#### 7.2 保留的核心 DLL（部分列表）

所有核心依賴庫均完整保留：

- EntityFramework.dll
- Dapper.dll
- Hangfire.Core.dll
- NPOI.dll
- BouncyCastle.Crypto.dll
- 等等...（共 100+個 DLL 文件）

---

### 8. 樣本文件差異

#### 8.1 新增的樣本文件

```
新版新增 ✓
└── Sample/(法規會)訴願書.doc                  (訴願書範本)
```

#### 8.2 保留的樣本文件

所有申請表單樣本均完整保留（50+ 個文件），包括：

- 醫事人員證書補換領申請書
- 各類中藥相關申請表
- 國民年金爭議審議申請書
- 等等...

---

### 9. WebService 差異

#### 9.1 缺失的 WebService 文件

```
舊版存在 ✓ | 新版缺失 ✗
└── WebService/SampleBAS.asmx.cs              (範例基礎服務代碼後置)
```

**說明**:

- 舊版: `SampleBAS.asmx` 沒有對應的 `.cs` 文件
- 新版: `SampleBAS.asmx` 有對應的 `.cs` 文件
- 這實際上是**修正**，不是缺失

#### 9.2 保留的 WebService

| 服務名稱             | 功能             | 狀態                 |
| -------------------- | ---------------- | -------------------- |
| FlyPayBasicData.asmx | 飛付基礎資料服務 | ✓ 完整               |
| SampleBAS.asmx       | 範例基礎服務     | ✓ 完整（新版更完整） |
| SamplePRODUCT.asmx   | 範例產品服務     | ✓ 完整               |

---

## 10. 關鍵發現總結

### 10.1 最嚴重的缺失

#### ⚠️ **Resource Area 模組完全缺失**

**舊版位置（已確認）**:

```
📂 CodeBase/109_e-service/ES/Areas/Resource/
   ├── Controllers/
   │   ├── BaseController.cs          (4個控制器)
   │   ├── DBController.cs            ← 線上 SQL 工具
   │   ├── DT1Controller.cs
   │   └── FileController.cs          ← 檔案管理工具
   ├── Models/
   ├── Views/
   │   ├── DB/Index.cshtml            ← SQL 執行介面
   │   ├── File/
   │   └── Shared/
   └── ResourceAreaRegistration.cs

📂 CodeBase/trunk_DISK_trunk/trunk/Areas/Resource/
   └── (包含額外的 CkEEC.cs 控制器)
```

**新版位置（應該在哪裡）**:

```
❌ CodeBaseNew/e-service/ES/Areas/Resource/  ← 此路徑不存在

✅ 如需補回，應複製到:
   CodeBaseNew/e-service/ES/Areas/Resource/
```

**追查與修復指引**:

1. 🔍 **確認是否刻意移除**:

   ```
   檢查項目:
   - 查看專案需求文件，確認 Resource Area 是否因安全考量而移除
   - 詢問專案負責人是否有替代方案
   - 確認生產環境是否仍在使用此功能
   ```

2. 📋 **功能清單（已確認）**:

   - ✅ DBController: 線上 SQL 查詢/執行工具（開發維護用）
   - ✅ FileController: 伺服器端檔案管理工具
   - ✅ DT1Controller: DT1 資源管理
   - ✅ BaseController: 安全驗證機制（僅限 localhost 或特定驗證）

3. 🔄 **補回步驟**（如需要）:

   ```
   步驟 1: 從舊版複製整個 Resource 目錄
   來源: CodeBase/109_e-service/ES/Areas/Resource/
   目標: CodeBaseNew/e-service/ES/Areas/Resource/

   步驟 2: 更新專案文件
   - 在 ES.csproj 中加入 Resource Area 的所有文件
   - 確認 ResourceAreaRegistration.cs 會被正確載入

   步驟 3: 檢查命名空間
   - 確認命名空間是否需要從 EUSERVICE 改為 ES
   - 更新所有 using 語句

   步驟 4: 測試
   - 編譯專案
   - 訪問 /Resource/DB 測試 SQL 工具
   - 訪問 /Resource/File 測試檔案管理
   ```

4. ✅ **測試驗證清單**:

   - [ ] 專案編譯成功
   - [ ] 路由註冊正確 (檢查 /Resource/DB 可訪問)
   - [ ] 安全驗證機制正常運作
   - [ ] SQL 查詢功能正常
   - [ ] 檔案管理功能正常

5. ⚠️ **安全注意事項**:
   ```
   Resource Area 包含敏感功能，部署時需注意:
   - 確保僅在開發/測試環境啟用
   - 生產環境建議移除或加強驗證機制
   - 修改預設驗證碼 (turbo@13141806)
   - 限制 IP 訪問範圍
   - 記錄所有操作日誌
   ```

### 10.2 中等優先級缺失

1. **DatePickerExtension.cs** - 標準日期選擇器

   - 影響: 可能影響西元年份日期選擇
   - 建議: 確認是否有替代實現

2. **配置文件缺失** - Web.Debug.config, Web.Release.config

   - 影響: 環境特定配置無法自動轉換
   - 建議: 補回配置轉換文件

3. **fonts 目錄缺失**
   - 影響: 字體文件可能無法正確載入
   - 建議: 確認字體是否已遷移到 Content/fonts/

### 10.3 低優先級差異

1. **舊版 jQuery/jQuery UI 文件缺失**

   - 這是預期的升級行為
   - 新版使用更新的庫版本

2. **obj 目錄新增**

   - 這是編譯產物，通常不應納入版控
   - 建議: 加入 .gitignore

3. **部分圖片文件缺失**
   - 可能是過時的資源
   - 需要確認是否仍在使用

---

## 11. 版本升級亮點

### 11.1 前端框架現代化

✅ **jQuery 升級**: 1.10.1 → 3.7.1

- 安全性大幅提升
- 性能優化
- 更好的瀏覽器兼容性

✅ **jQuery UI 升級**: 1.10.3 → 1.13.2

- 修復已知漏洞
- 改進的無障礙支持
- 更好的觸控設備支持

✅ **Bootstrap 升級**: 3.x → 4.x/5.x

- 響應式設計改進
- Flexbox 網格系統
- 更現代的 UI 組件

### 11.2 代碼質量改進

✅ **WebService 代碼後置文件補全**

- SampleBAS.asmx.cs 已添加
- 代碼結構更完整

✅ **TypeScript 和 Flow 支持**

- 新增類型定義文件
- 更好的開發體驗

---

## 12. 建議行動計畫

### 🔴 **緊急（1-3 天內）**

1. **調查 Resource Area 缺失**

   - [ ] 確認功能是否已遷移
   - [ ] 列出受影響的功能清單
   - [ ] 制定補救方案

2. **補回關鍵配置文件**
   - [ ] 恢復 Web.Debug.config
   - [ ] 恢復 Web.Release.config
   - [ ] 測試配置轉換

### 🟡 **重要（1-2 週內）**

3. **前端兼容性測試**

   - [ ] 測試 jQuery 3.7.1 兼容性
   - [ ] 測試 Bootstrap 4/5 兼容性
   - [ ] 修復發現的問題

4. **補回缺失的 Helper**

   - [ ] 恢復 DatePickerExtension.cs
   - [ ] 測試日期選擇功能

5. **資源文件檢查**
   - [ ] 確認缺失圖片的使用情況
   - [ ] 補回仍在使用的資源
   - [ ] 清理不再使用的引用

### 🟢 **一般（1 個月內）**

6. **代碼庫清理**

   - [ ] 將 obj 目錄加入 .gitignore
   - [ ] 移除不必要的編譯產物
   - [ ] 統一代碼格式

7. **文檔更新**
   - [ ] 更新部署文檔
   - [ ] 記錄版本差異
   - [ ] 更新開發指南

---

## 13. 風險評估

| 風險項目               | 嚴重程度 | 可能性 | 影響範圍     | 緩解措施       |
| ---------------------- | -------- | ------ | ------------ | -------------- |
| Resource Area 功能缺失 | 🔴 高    | 高     | 資源管理功能 | 立即調查並補回 |
| 前端庫不兼容           | 🟡 中    | 中     | 所有前端功能 | 完整測試       |
| 配置文件缺失           | 🟡 中    | 高     | 部署流程     | 補回配置文件   |
| DatePicker 功能異常    | 🟡 中    | 中     | 日期輸入功能 | 補回或替代實現 |
| 圖片資源缺失           | 🟢 低    | 低     | 部分頁面顯示 | 按需補回       |

---

## 14. 結論

### 主要發現

1. **Resource Area 完全缺失**是最嚴重的問題，需要立即處理
2. 前端框架已進行**現代化升級**，這是積極的改進
3. 部分配置文件和輔助類缺失，需要補回
4. 大部分核心功能和文件都完整保留

### 總體評估

- ✅ **核心功能**: 基本完整（除 Resource Area 外）
- ⚠️ **配置管理**: 需要補強
- ✅ **前端資源**: 已升級，需測試兼容性
- ⚠️ **輔助功能**: 部分缺失，需要補回

### 下一步

建議按照「建議行動計畫」章節的優先級順序，逐步處理發現的問題。

---

## 附錄 A: 完整文件清單對比

### A.1 缺失文件完整列表

```
配置文件:
- Web.Debug.config
- Web.Release.config
- Web-2021-rc1.config

Helper 文件:
- Helpers/DatePickerExtension.cs

目錄:
- Areas/Resource/ (整個目錄)
- fonts/ (整個目錄)
- aspnet_client/ (整個目錄)
- Content/images/ (整個目錄)

JavaScript:
- Scripts/_references.js
- Scripts/jquery-1.10.1.js
- Scripts/jquery-1.10.1.min.js
- Scripts/jquery-ui-1.10.3.js
- Scripts/jquery-ui-1.10.3.min.js
- Scripts/jquery.maskedinput/ (目錄)
- Scripts/jquery.ui.datepicker.validation.package-1.0.1/ (目錄)

圖片:
- Images/3d-Icon-ecommercia-011.png
- Images/3d-Icon-ecommercia-02.png
- Images/banner-20210108-a.jpg
- favicon2.ico
```

### A.2 新增文件完整列表

```
配置文件:
- ES.csproj.user

目錄:
- obj/ (整個目錄 - 編譯產物)
- Scripts/esm/ (ES Module 目錄)

JavaScript:
- Scripts/README.md
- Scripts/bootstrap.bundle.js
- Scripts/bootstrap.bundle.min.js
- Scripts/bootstrap.bundle.js.map
- Scripts/bootstrap.bundle.min.js.map
- Scripts/index.d.ts
- Scripts/index.js.flow
- Scripts/jquery-ui-1.13.2.js
- Scripts/jquery-ui-1.13.2.min.js

CSS:
- Content/bootstrap-grid.css
- Content/bootstrap-grid.min.css
- Content/bootstrap-grid.css.map
- Content/bootstrap-grid.min.css.map
- Content/bootstrap-reboot.css
- Content/bootstrap-reboot.min.css
- Content/bootstrap-reboot.css.map
- Content/bootstrap-reboot.min.css.map

DLL:
- bin/Microsoft.mshtml.dll

樣本:
- Sample/(法規會)訴願書.doc

WebService:
- WebService/SampleBAS.asmx.cs (補全)
```

---

## 附錄 B: 技術債務清單

1. **立即處理**:

   - Resource Area 模組缺失調查
   - 關鍵配置文件補回

2. **短期處理**:

   - 前端庫兼容性測試
   - DatePickerExtension 補回或替代

3. **中期處理**:

   - 代碼庫清理（移除 obj 等編譯產物）
   - 文檔更新

4. **長期優化**:
   - 前端框架完全遷移到 Bootstrap 5
   - 代碼現代化改造

---

**報告結束**

_本報告由 AI 自動生成，建議由技術團隊進行人工審核和驗證。_
