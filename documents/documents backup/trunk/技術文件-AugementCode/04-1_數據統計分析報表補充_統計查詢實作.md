# 電子病歷申請系統 (EECOnline) - 數據統計分析報表補充：統計查詢實作

> 本文件為「04*全端功能詳細範例*數據統計分析報表.md」的補充文件，詳細說明各種統計報表的查詢實作，包含熱門申請統計、繳費統計等進階功能。

## 1. 熱門申請統計報表

### 1.1 熱門申請統計控制器

**檔案位置：** `ES/Areas/BACKMIN/Controllers/ReportController.cs`

```csharp
/// <summary>
/// 熱門申辦統計查詢頁面（GET）
/// 顯示最受歡迎的申請項目統計
/// </summary>
[HttpGet]
public ActionResult StatisticsHot()
{
    // 建立查詢條件模型
    StatisticsHotModel model = new StatisticsHotModel();

    // 預設查詢當天資料
    model.Sdate = DateTime.Now.ToString("yyyy/MM/dd");
    model.Fdate = DateTime.Now.ToString("yyyy/MM/dd");

    // 記錄訪問記錄
    this.SetVisitRecord("Report", "StatisticsHot", "熱門申辦統計");

    return View(model);
}

/// <summary>
/// 熱門申辦統計查詢（POST）
/// 執行統計查詢並顯示結果
/// </summary>
[HttpPost]
public ActionResult StatisticsHot(StatisticsHotModel model)
{
    // 呼叫 Action 層執行統計查詢
    ReportAction action = new ReportAction();
    ViewBag.List = action.GetHotReport(model);

    return View(model);
}
```

**程式碼說明：**

1. **GET 方法**：初始化頁面，設定預設查詢條件
2. **POST 方法**：接收使用者提交的查詢條件，執行統計
3. **訪問記錄**：記錄使用者的操作行為
4. **ViewBag 傳遞**：使用 ViewBag 傳遞統計結果到視圖

### 1.2 熱門申請統計業務邏輯

**檔案位置：** `ES/Areas/BACKMIN/Action/ReportAction.cs`

```csharp
/// <summary>
/// 取得熱門申辦統計資料（TOP 20）
/// 統計最受歡迎的申請項目，並計算佔比
/// </summary>
/// <param name="model">查詢條件模型</param>
/// <returns>統計結果清單</returns>
public List<StatisticsHotResultModel> GetHotReport(StatisticsHotModel model)
{
    // 初始化結果清單
    List<StatisticsHotResultModel> li = new List<StatisticsHotResultModel>();

    try
    {
        using (SqlConnection conn = DataUtils.GetConnection())
        {
            conn.Open();

            // 建立 SQL 查詢語句
            // 使用 TOP 20 限制結果數量
            // 使用子查詢計算百分比
            string sql = @"
                SELECT TOP 20
                    S.SRV_ID,                           -- 服務代碼
                    S.NAME AS SRV_NAME,                 -- 服務名稱
                    U.NAME AS UNIT_NAME,                -- 單位名稱
                    COUNT(A.APP_ID) AS APP_COUNT,       -- 申請案件數
                    -- 計算百分比
                    -- 使用 CAST 將整數轉換為浮點數，避免整數除法問題
                    CAST(COUNT(A.APP_ID) * 100.0 /
                        (SELECT COUNT(*) FROM APPLY
                         WHERE APPLY_DATE >= @Sdate
                           AND APPLY_DATE < @Fdate
                           AND DEL_MK = 'N')
                    AS DECIMAL(5,2)) AS PERCENTAGE      -- 佔總申請數的百分比
                FROM SERVICE S
                    INNER JOIN APPLY A ON S.SRV_ID = A.SRV_ID
                    LEFT JOIN UNIT U ON S.UNIT_CD = U.UNIT_CD
                WHERE A.APPLY_DATE >= @Sdate
                    AND A.APPLY_DATE < @Fdate
                    AND A.DEL_MK = 'N'
                GROUP BY S.SRV_ID, S.NAME, U.NAME
                ORDER BY APP_COUNT DESC";               -- 依申請數量降冪排序

            using (SqlCommand dbc = conn.CreateCommand())
            {
                dbc.CommandText = sql;

                // 設定查詢參數
                DataUtils.AddParameters(dbc, "Sdate", model.Sdate);
                DataUtils.AddParameters(dbc, "Fdate", Convert.ToDateTime(model.Fdate).AddDays(1));

                // 執行查詢並讀取結果
                using (SqlDataReader sda = dbc.ExecuteReader())
                {
                    while (sda.Read())
                    {
                        StatisticsHotResultModel item = new StatisticsHotResultModel();
                        item.SRV_ID = DataUtils.GetDBString(sda, "SRV_ID");
                        item.SRV_NAME = DataUtils.GetDBString(sda, "SRV_NAME");
                        item.UNIT_NAME = DataUtils.GetDBString(sda, "UNIT_NAME");
                        item.APP_COUNT = DataUtils.GetDBInt(sda, "APP_COUNT");
                        item.PERCENTAGE = DataUtils.GetDBDecimal(sda, "PERCENTAGE");
                        li.Add(item);
                    }
                    sda.Close();
                }
            }

            conn.Close();
            conn.Dispose();
        }
    }
    catch (Exception ex)
    {
        LOG.Error("GetHotReport() Error: " + ex.Message);
    }

    return li;
}
```

**程式碼說明：**

1. **TOP 20 限制**：只取前 20 筆最熱門的申請項目，避免資料過多
2. **INNER JOIN**：只統計有申請案件的服務項目
3. **百分比計算**：使用子查詢計算每個服務佔總申請數的百分比
4. **CAST 轉換**：將計算結果轉換為 DECIMAL(5,2) 格式（例如：12.34%）
5. **ORDER BY DESC**：依申請數量降冪排序，最熱門的排在最前面
6. **錯誤處理**：使用 try-catch 捕捉異常，記錄錯誤日誌

### 1.3 熱門申請統計視圖

**檔案位置：** `ES/Areas/BACKMIN/Views/Report/StatisticsHot.cshtml`

```html
@model ES.Areas.BACKMIN.Models.StatisticsHotModel

<div class="container-fluid">
  <div class="card">
    <div class="card-header">
      <h4>熱門申請項目統計分析（TOP 20）</h4>
    </div>

    <!-- 統計查詢條件區域 -->
    <div class="card-body">
      @using (Html.BeginForm("StatisticsHot", "Report", FormMethod.Post, new {
      @class = "form-horizontal" })) {
      <div class="row">
        <div class="col-md-5">
          <div class="form-group">
            <label>統計開始日期</label>
            @Html.TextBoxFor(m => m.Sdate, new { @class = "form-control
            datepicker" })
          </div>
        </div>
        <div class="col-md-5">
          <div class="form-group">
            <label>統計結束日期</label>
            @Html.TextBoxFor(m => m.Fdate, new { @class = "form-control
            datepicker" })
          </div>
        </div>
        <div class="col-md-2">
          <div class="form-group">
            <label>&nbsp;</label>
            <button type="submit" class="btn btn-primary btn-block">
              <i class="fa fa-search"></i> 查詢
            </button>
          </div>
        </div>
      </div>
      }
    </div>

    <!-- 統計結果顯示區域 -->
    <div class="card-body" id="statisticsResult">
      @if (ViewBag.List != null) {
      <div class="table-responsive">
        <table class="table table-striped table-bordered">
          <thead class="thead-dark">
            <tr>
              <th>排名</th>
              <th>單位名稱</th>
              <th>服務項目</th>
              <th>申請案件數</th>
              <th>佔比 (%)</th>
              <th>視覺化</th>
            </tr>
          </thead>
          <tbody>
            @{ int rank = 1; } @foreach (var item in ViewBag.List) {
            <tr>
              <td class="text-center">
                @if (rank <= 3) {
                <span class="badge badge-warning">@rank</span>
                } else {
                <span>@rank</span>
                }
              </td>
              <td>@item.UNIT_NAME</td>
              <td>@item.SRV_NAME</td>
              <td class="text-right">@item.APP_COUNT</td>
              <td class="text-right">@item.PERCENTAGE%</td>
              <td>
                <div class="progress">
                  <div
                    class="progress-bar"
                    role="progressbar"
                    style="width: @(item.PERCENTAGE)%"
                    aria-valuenow="@item.PERCENTAGE"
                    aria-valuemin="0"
                    aria-valuemax="100"></div>
                </div>
              </td>
            </tr>
            rank++; }
          </tbody>
        </table>
      </div>
      }
    </div>
  </div>
</div>

<script>
  $(document).ready(function () {
    $(".datepicker").datepicker({
      format: "yyyy/mm/dd",
      autoclose: true,
      todayHighlight: true
    });
  });
</script>
```

**程式碼說明：**

1. **排名顯示**：使用變數 rank 顯示排名，前三名使用特殊樣式標示
2. **百分比視覺化**：使用 Bootstrap 進度條視覺化顯示佔比
3. **響應式設計**：使用 Bootstrap 的響應式表格和卡片組件
4. **日期選擇器**：整合 jQuery UI Datepicker 提供友善的日期選擇功能

## 2. 登入統計報表

### 2.1 登入統計控制器

**檔案位置：** `ES/Areas/BACKMIN/Controllers/ReportController.cs`

```csharp
/// <summary>
/// 登入統計查詢頁面（GET）
/// 顯示各種登入方式的使用統計
/// </summary>
[HttpGet]
public ActionResult StatisticsLogin()
{
    // 建立查詢條件模型
    StatisticsLoginModel model = new StatisticsLoginModel();

    // 預設查詢當天資料
    model.Sdate = DateTime.Now.ToString("yyyy/MM/dd");
    model.Fdate = DateTime.Now.ToString("yyyy/MM/dd");

    // 記錄訪問記錄
    this.SetVisitRecord("Report", "StatisticsLogin", "登入統計");

    return View(model);
}

/// <summary>
/// 登入統計查詢（POST）
/// 執行統計查詢並顯示結果
/// </summary>
[HttpPost]
public ActionResult StatisticsLogin(StatisticsLoginModel model)
{
    // 呼叫 Action 層執行統計查詢
    ReportAction action = new ReportAction();
    ViewBag.Map = action.GetLoginReport(model);

    return View(model);
}
```

### 2.2 登入統計業務邏輯

**檔案位置：** `ES/Areas/BACKMIN/Action/ReportAction.cs`

```csharp
/// <summary>
/// 取得登入統計資料
/// 統計各種登入方式的使用次數
/// </summary>
/// <param name="model">查詢條件模型</param>
/// <returns>統計結果字典</returns>
public Dictionary<string, int> GetLoginReport(StatisticsLoginModel model)
{
    // 使用 Dictionary 儲存各登入方式的統計結果
    Dictionary<string, int> map = new Dictionary<string, int>();

    try
    {
        using (SqlConnection conn = DataUtils.GetConnection())
        {
            conn.Open();
            using (SqlCommand dbc = conn.CreateCommand())
            {
                // 統計 SQL 查詢
                // 使用 SUM 函數統計各登入方式的總次數
                dbc.CommandText = @"
                    SELECT
                        SUM(member) AS member,      -- 會員登入總次數
                        SUM(moica) AS moica,        -- 自然人憑證登入總次數
                        SUM(moeaca) AS moeaca,      -- 行動自然人憑證登入總次數
                        SUM(hca0) AS hca0,          -- 健保卡（讀卡機）登入總次數
                        SUM(hca1) AS hca1,          -- 健保卡（行動）登入總次數
                        SUM(NEWEID) AS NEWEID       -- 數位身分證登入總次數
                    FROM LOGIN_STATISTICS
                    WHERE LOGIN_DATE >= @Sdate
                      AND LOGIN_DATE <= @Fdate";

                dbc.Parameters.Clear();
                DataUtils.AddParameters(dbc, "Sdate", model.Sdate);
                DataUtils.AddParameters(dbc, "Fdate", Convert.ToDateTime(model.Fdate).AddDays(1));

                using (SqlDataReader sda = dbc.ExecuteReader())
                {
                    if (sda.Read())
                    {
                        // 將各登入方式的統計結果加入字典
                        map.Add("member", DataUtils.GetDBInt(sda, 0));
                        map.Add("moica", DataUtils.GetDBInt(sda, 1));
                        map.Add("moeaca", DataUtils.GetDBInt(sda, 2));
                        map.Add("hca0", DataUtils.GetDBInt(sda, 3));
                        map.Add("hca1", DataUtils.GetDBInt(sda, 4));
                        map.Add("NEWEID", DataUtils.GetDBInt(sda, 5));
                    }
                    sda.Close();
                }
            }
            conn.Close();
            conn.Dispose();
        }
    }
    catch (Exception ex)
    {
        LOG.Error("GetLoginReport() Error: " + ex.Message);
    }

    return map;
}
```

**程式碼說明：**

1. **SUM 聚合函數**：使用 SUM 函數統計各登入方式的總次數
2. **多欄位統計**：一次查詢取得所有登入方式的統計，提升效能
3. **Dictionary 回傳**：使用字典結構方便前端取值和顯示
4. **NULL 處理**：SUM 函數自動處理 NULL 值（回傳 0）
5. **錯誤處理**：使用 try-catch 捕捉異常，記錄錯誤日誌

### 2.3 登入統計視圖

**檔案位置：** `ES/Areas/BACKMIN/Views/Report/StatisticsLogin.cshtml`

```html
@model ES.Areas.BACKMIN.Models.StatisticsLoginModel

<div class="container-fluid">
  <div class="card">
    <div class="card-header">
      <h4>登入方式統計分析</h4>
    </div>

    <!-- 統計查詢條件區域 -->
    <div class="card-body">
      @using (Html.BeginForm("StatisticsLogin", "Report", FormMethod.Post, new {
      @class = "form-horizontal" })) {
      <div class="row">
        <div class="col-md-5">
          <div class="form-group">
            <label>統計開始日期</label>
            @Html.TextBoxFor(m => m.Sdate, new { @class = "form-control
            datepicker" })
          </div>
        </div>
        <div class="col-md-5">
          <div class="form-group">
            <label>統計結束日期</label>
            @Html.TextBoxFor(m => m.Fdate, new { @class = "form-control
            datepicker" })
          </div>
        </div>
        <div class="col-md-2">
          <div class="form-group">
            <label>&nbsp;</label>
            <button type="submit" class="btn btn-primary btn-block">
              <i class="fa fa-search"></i> 查詢
            </button>
          </div>
        </div>
      </div>
      }
    </div>

    <!-- 統計結果顯示區域 -->
    <div class="card-body" id="statisticsResult">
      @if (ViewBag.Map != null) {
      <div class="row">
        <!-- 會員登入 -->
        <div class="col-md-4">
          <div class="card bg-primary text-white mb-3">
            <div class="card-body text-center">
              <h5 class="card-title">會員登入</h5>
              <h2>@ViewBag.Map["member"]</h2>
              <p>次</p>
            </div>
          </div>
        </div>

        <!-- 自然人憑證 -->
        <div class="col-md-4">
          <div class="card bg-success text-white mb-3">
            <div class="card-body text-center">
              <h5 class="card-title">自然人憑證</h5>
              <h2>@ViewBag.Map["moica"]</h2>
              <p>次</p>
            </div>
          </div>
        </div>

        <!-- 行動自然人憑證 -->
        <div class="col-md-4">
          <div class="card bg-info text-white mb-3">
            <div class="card-body text-center">
              <h5 class="card-title">行動自然人憑證</h5>
              <h2>@ViewBag.Map["moeaca"]</h2>
              <p>次</p>
            </div>
          </div>
        </div>

        <!-- 健保卡（讀卡機） -->
        <div class="col-md-4">
          <div class="card bg-warning text-white mb-3">
            <div class="card-body text-center">
              <h5 class="card-title">健保卡（讀卡機）</h5>
              <h2>@ViewBag.Map["hca0"]</h2>
              <p>次</p>
            </div>
          </div>
        </div>

        <!-- 健保卡（行動） -->
        <div class="col-md-4">
          <div class="card bg-danger text-white mb-3">
            <div class="card-body text-center">
              <h5 class="card-title">健保卡（行動）</h5>
              <h2>@ViewBag.Map["hca1"]</h2>
              <p>次</p>
            </div>
          </div>
        </div>

        <!-- 數位身分證 -->
        <div class="col-md-4">
          <div class="card bg-secondary text-white mb-3">
            <div class="card-body text-center">
              <h5 class="card-title">數位身分證</h5>
              <h2>@ViewBag.Map["NEWEID"]</h2>
              <p>次</p>
            </div>
          </div>
        </div>
      </div>

      <!-- 圖表顯示區域 -->
      <div class="card mt-3">
        <div class="card-header">
          <h5>登入方式分布圖</h5>
        </div>
        <div class="card-body">
          <canvas id="loginChart" width="400" height="200"></canvas>
        </div>
      </div>
      }
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  $(document).ready(function() {
      $('.datepicker').datepicker({
          format: 'yyyy/mm/dd',
          autoclose: true,
          todayHighlight: true
      });

      @if (ViewBag.Map != null)
      {
          <text>
          // 建立圖表
          var ctx = document.getElementById('loginChart').getContext('2d');
          var loginChart = new Chart(ctx, {
              type: 'pie',
              data: {
                  labels: ['會員登入', '自然人憑證', '行動自然人憑證', '健保卡（讀卡機）', '健保卡（行動）', '數位身分證'],
                  datasets: [{
                      data: [
                          @ViewBag.Map["member"],
                          @ViewBag.Map["moica"],
                          @ViewBag.Map["moeaca"],
                          @ViewBag.Map["hca0"],
                          @ViewBag.Map["hca1"],
                          @ViewBag.Map["NEWEID"]
                      ],
                      backgroundColor: [
                          'rgba(54, 162, 235, 0.8)',
                          'rgba(75, 192, 192, 0.8)',
                          'rgba(153, 102, 255, 0.8)',
                          'rgba(255, 206, 86, 0.8)',
                          'rgba(255, 99, 132, 0.8)',
                          'rgba(201, 203, 207, 0.8)'
                      ]
                  }]
              },
              options: {
                  responsive: true,
                  plugins: {
                      legend: {
                          position: 'right',
                      },
                      title: {
                          display: true,
                          text: '登入方式分布統計'
                      }
                  }
              }
          });
          </text>
      }
  });
</script>
```

**程式碼說明：**

1. **卡片式展示**：使用不同顏色的卡片展示各登入方式的統計數據
2. **圖表視覺化**：使用 Chart.js 建立圓餅圖，視覺化顯示登入方式分布
3. **響應式設計**：使用 Bootstrap 的網格系統確保在不同裝置上都能正常顯示
4. **色彩區分**：使用不同的背景顏色區分不同的登入方式

## 3. 熱門申請統計

### 3.1 熱門申請查詢

```csharp
/// <summary>
/// 熱門申辦統計查詢頁面（GET）
/// </summary>
[HttpGet]
public ActionResult StatisticsHot()
{
    StatisticsHotModel model = new StatisticsHotModel();
    model.Sdate = DateTime.Now.ToString("yyyy/MM/dd");
    model.Fdate = DateTime.Now.ToString("yyyy/MM/dd");

    this.SetVisitRecord("Report", "StatisticsHot", "熱門申辦統計");

    return View(model);
}

/// <summary>
/// 熱門申辦統計查詢（POST）
/// </summary>
[HttpPost]
public ActionResult StatisticsHot(StatisticsHotModel model)
{
    ReportAction action = new ReportAction();
    ViewBag.List = action.GetHotReport(model);
    return View(model);
}
```

### 3.2 熱門申請業務邏輯

```csharp
/// <summary>
/// 取得熱門申辦統計資料（TOP 20）
/// </summary>
/// <param name="model">查詢條件模型</param>
/// <returns>統計結果清單</returns>
public List<StatisticsHotResultModel> GetHotReport(StatisticsHotModel model)
{
    List<StatisticsHotResultModel> li = new List<StatisticsHotResultModel>();

    try
    {
        using (SqlConnection conn = DataUtils.GetConnection())
        {
            conn.Open();

            string sql = @"
                SELECT TOP 20
                    S.SRV_ID,
                    S.NAME AS SRV_NAME,
                    U.NAME AS UNIT_NAME,
                    COUNT(A.APP_ID) AS APP_COUNT,
                    -- 計算百分比
                    CAST(COUNT(A.APP_ID) * 100.0 /
                        (SELECT COUNT(*) FROM APPLY
                         WHERE APPLY_DATE >= @Sdate
                           AND APPLY_DATE < @Fdate
                           AND DEL_MK = 'N')
                    AS DECIMAL(5,2)) AS PERCENTAGE
                FROM SERVICE S
                    INNER JOIN APPLY A ON S.SRV_ID = A.SRV_ID
                    LEFT JOIN UNIT U ON S.UNIT_CD = U.UNIT_CD
                WHERE A.APPLY_DATE >= @Sdate
                    AND A.APPLY_DATE < @Fdate
                    AND A.DEL_MK = 'N'
                GROUP BY S.SRV_ID, S.NAME, U.NAME
                ORDER BY APP_COUNT DESC";  // 依申請數量降冪排序

            using (SqlCommand dbc = conn.CreateCommand())
            {
                dbc.CommandText = sql;
                DataUtils.AddParameters(dbc, "Sdate", model.Sdate);
                DataUtils.AddParameters(dbc, "Fdate", Convert.ToDateTime(model.Fdate).AddDays(1));

                using (SqlDataReader sda = dbc.ExecuteReader())
                {
                    while (sda.Read())
                    {
                        StatisticsHotResultModel item = new StatisticsHotResultModel();
                        item.SRV_ID = DataUtils.GetDBString(sda, "SRV_ID");
                        item.SRV_NAME = DataUtils.GetDBString(sda, "SRV_NAME");
                        item.UNIT_NAME = DataUtils.GetDBString(sda, "UNIT_NAME");
                        item.APP_COUNT = DataUtils.GetDBInt(sda, "APP_COUNT");
                        item.PERCENTAGE = DataUtils.GetDBDecimal(sda, "PERCENTAGE");
                        li.Add(item);
                    }
                    sda.Close();
                }
            }

            conn.Close();
            conn.Dispose();
        }
    }
    catch (Exception ex)
    {
        LOG.Error("GetHotReport() Error: " + ex.Message);
    }

    return li;
}
```

**程式碼說明：**

1. **TOP 20**：只取前 20 筆最熱門的申請項目
2. **INNER JOIN**：只統計有申請案件的服務項目
3. **百分比計算**：使用子查詢計算每個服務佔總申請數的百分比
4. **CAST**：將計算結果轉換為 DECIMAL(5,2) 格式（例如：12.34%）
5. **ORDER BY DESC**：依申請數量降冪排序

## 4. 數據模型定義

### 4.1 統計查詢條件模型

```csharp
/// <summary>
/// 熱門申請統計查詢條件的資料模型
/// </summary>
public class StatisticsHotModel
{
    /// <summary>
    /// 統計開始日期
    /// </summary>
    public string Sdate { get; set; }

    /// <summary>
    /// 統計結束日期
    /// </summary>
    public string Fdate { get; set; }
}
```

### 4.2 統計結果模型

```csharp
/// <summary>
/// 熱門申請統計結果的資料模型
/// </summary>
public class StatisticsHotResultModel
{
    /// <summary>
    /// 服務代碼
    /// </summary>
    public string SRV_ID { get; set; }

    /// <summary>
    /// 服務名稱
    /// </summary>
    public string SRV_NAME { get; set; }

    /// <summary>
    /// 單位名稱
    /// </summary>
    public string UNIT_NAME { get; set; }

    /// <summary>
    /// 申請案件數
    /// </summary>
    public int APP_COUNT { get; set; }

    /// <summary>
    /// 佔總申請數的百分比
    /// </summary>
    public decimal PERCENTAGE { get; set; }
}
```

## 5. SQL 查詢技術總結

### 5.1 聚合函數使用

本文件中使用的主要 SQL 聚合函數：

1. **COUNT()**：計算記錄數量
2. **SUM()**：計算總和
3. **CAST()**：資料型別轉換

### 5.2 JOIN 策略

1. **LEFT JOIN**：保留左表所有記錄，用於申請統計
2. **INNER JOIN**：只保留兩表都有的記錄，用於熱門申請統計

### 5.3 子查詢應用

使用子查詢計算百分比，一次查詢完成複雜計算，避免多次資料庫往返，提升查詢效能。

## 6. 前端視覺化技術

### 6.1 Chart.js 圖表整合

1. **圓餅圖（Pie Chart）**：適用於顯示比例分布，用於登入方式統計
2. **長條圖（Bar Chart）**：適用於比較數值大小，用於申請數量統計
3. **進度條（Progress Bar）**：適用於顯示百分比，用於熱門申請佔比

### 6.2 Bootstrap 卡片組件

使用 Bootstrap 卡片組件展示統計數據，具有視覺化效果佳、響應式設計、易於維護等優點。

## 7. 開發最佳實踐

### 7.1 錯誤處理

所有統計查詢方法都應包含 try-catch 錯誤處理，記錄錯誤日誌。

### 7.2 資源管理

使用 `using` 語句確保資料庫連線和資源正確釋放。

### 7.3 參數驗證

在執行統計查詢前驗證參數，確保日期參數不為空。

## 8. 總結

本補充文件詳細說明了 EECOnline 系統的數據統計分析報表功能，包含：

1. **熱門申請統計報表**：使用 TOP 20 和百分比計算找出最熱門的申請項目
2. **登入統計報表**：使用 SUM 函數統計各登入方式的使用次數，並使用圖表視覺化
3. **數據模型定義**：清楚定義查詢條件和統計結果的資料結構
4. **SQL 查詢技術**：聚合函數、JOIN 策略、子查詢應用
5. **前端視覺化**：Chart.js 圖表整合、Bootstrap 卡片組件
6. **開發最佳實踐**：錯誤處理、資源管理、參數驗證

這些統計報表功能展示了完整的數據分析流程，從後端 SQL 聚合查詢到前端視覺化展示，提供了豐富的統計維度和互動式的數據探索功能，為管理者提供了強大的決策支援工具。

完整的程式碼範例和詳細說明請參考主文件「04*全端功能詳細範例*數據統計分析報表.md」。
