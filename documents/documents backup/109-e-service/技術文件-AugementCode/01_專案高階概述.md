# 衛福部人民線上申辦系統 (e-service) - 專案高階概述

## 專案概述

衛福部人民線上申辦系統（e-service）是一個全端 Web 應用程式，專門用於提供民眾線上申辦衛生福利部各項業務服務。系統採用 ASP.NET MVC 4 架構，整合多個業務單位的申辦流程，提供完整的案件申請、審核、繳費及管理功能。

### 系統主要功能
- **線上申辦服務**：支援醫事司、中醫藥司、社工司等多個單位的線上申辦業務
- **會員管理系統**：提供會員註冊、登入、資料維護等功能
- **多元登入方式**：支援帳號密碼、自然人憑證、工商憑證、醫事人員憑證等多種登入方式
- **案件管理系統**：完整的案件建立、編輯、送審、補件、撤銷等流程管理
- **繳費整合系統**：整合信用卡線上繳費、ATM 轉帳等多種繳費方式
- **後台審核系統**：提供審核人員案件審查、補件通知、核准/退件等功能
- **報表產製系統**：自動產生申請書、證書、統計報表等各類文件
- **系統管理功能**：使用者、角色、權限、代碼等系統基礎設定

## 專案結構

### 檔案目錄結構

```
109_e-service/
├── ES/                                 # 主要專案目錄
│   ├── Controllers/                    # 前台控制器（民眾使用）
│   │   ├── BaseController.cs          # 需登入的基底控制器
│   │   ├── BaseNoMemberController.cs  # 免登入的基底控制器
│   │   ├── LoginController.cs         # 登入處理控制器
│   │   ├── Apply_001xxx.cs           # 醫事司申辦控制器
│   │   ├── Apply_005xxx.cs           # 中醫藥司申辦控制器
│   │   ├── Apply_010xxx.cs           # 社工司申辦控制器
│   │   ├── Apply_011xxx.cs           # 其他業務申辦控制器
│   │   └── ...                        # 其他業務控制器
│   │
│   ├── Areas/                         # MVC Areas 區域劃分
│   │   ├── BACKMIN/                   # 後台管理區（審核人員使用）
│   │   │   ├── Controllers/           # 後台控制器
│   │   │   ├── Action/                # 業務邏輯層
│   │   │   └── Views/                 # 後台視圖
│   │   ├── Admin/                     # 系統管理區
│   │   ├── Resource/                  # 資源管理區
│   │   └── Schedule/                  # 排程任務區
│   │
│   ├── Models/                        # 資料模型
│   │   ├── Entities/                  # 資料庫實體模型
│   │   │   ├── APPLYModel.cs         # 申請案件主檔
│   │   │   ├── MEMBER.cs             # 會員資料
│   │   │   ├── ADMIN.cs              # 管理者資料
│   │   │   ├── CODE_CD.cs            # 統一代碼表
│   │   │   └── ...                    # 其他實體模型
│   │   ├── ViewModels/                # 視圖模型
│   │   └── ...                        # 其他模型類別
│   │
│   ├── DataLayers/                    # 資料存取層
│   │   ├── ApplyDAO.cs               # 申請案件資料存取
│   │   ├── LoginDAO.cs               # 登入資料存取
│   │   ├── BackApplyDAO.cs           # 後台案件資料存取
│   │   └── ...                        # 其他 DAO 類別
│   │
│   ├── Services/                      # 服務層
│   │   └── CommonsServices.cs        # 共用服務
│   │
│   ├── Utils/                         # 工具類別
│   │   ├── DataUtils.cs              # 資料處理工具
│   │   ├── CodeUtils.cs              # 代碼處理工具
│   │   ├── ReportUtils.cs            # 報表處理工具
│   │   ├── PayUtils.cs               # 繳費處理工具
│   │   └── ...                        # 其他工具類別
│   │
│   ├── Views/                         # 視圖檔案
│   │   ├── Home/                      # 首頁視圖
│   │   ├── Login/                     # 登入視圖
│   │   ├── Apply/                     # 申辦視圖
│   │   ├── Shared/                    # 共用視圖
│   │   └── ...                        # 其他視圖
│   │
│   ├── Content/                       # 靜態資源
│   │   ├── css/                       # 樣式表
│   │   ├── images/                    # 圖片資源
│   │   └── ...                        # 其他資源
│   │
│   ├── Scripts/                       # JavaScript 檔案
│   │   ├── jquery/                    # jQuery 函式庫
│   │   └── ...                        # 其他 JS 檔案
│   │
│   ├── App_Start/                     # 應用程式啟動設定
│   │   ├── RouteConfig.cs            # 路由設定
│   │   ├── FilterConfig.cs           # 過濾器設定
│   │   └── BundleConfig.cs           # 資源打包設定
│   │
│   ├── Global.asax.cs                 # 應用程式全域設定
│   ├── Web.config                     # 應用程式組態設定
│   ├── Startup.cs                     # OWIN 啟動設定（Hangfire）
│   └── packages.config                # NuGet 套件設定
│
├── ECFile/                            # 信用卡繳費相關檔案
│   ├── FileUpload5.cmd               # 上傳批次檔
│   ├── FileDownload5.cmd             # 下載批次檔
│   └── ...                            # 其他 EC 相關檔案
│
└── packages/                          # NuGet 套件目錄
    ├── EntityFramework.5.0.0/        # Entity Framework
    ├── Dapper.1.60.6/                # Dapper ORM
    ├── NPOI.2.5.1/                   # Excel 處理
    ├── Hangfire.1.7.19/              # 背景任務排程
    └── ...                            # 其他套件
```

### 重要檔案說明

#### 核心配置文件
- **Web.config**：應用程式設定檔，包含資料庫連線、郵件伺服器、SFTP 設定等
- **Global.asax.cs**：應用程式生命週期事件處理，包含啟動、錯誤處理、身份驗證等
- **Startup.cs**：OWIN 啟動設定，主要用於 Hangfire 排程系統初始化
- **RouteConfig.cs**：MVC 路由規則設定
- **packages.config**：NuGet 套件相依性設定

#### 功能模組
- **Controllers**：MVC 控制器，處理 HTTP 請求與回應
- **DataLayers**：資料存取層，封裝資料庫操作邏輯
- **Models**：資料模型，包含實體模型和視圖模型
- **Views**：Razor 視圖，負責 UI 呈現
- **Utils**：工具類別，提供共用功能

### 使用的主要套件

#### 後端技術棧
- **ASP.NET MVC 4.0**：主要開發框架
- **Entity Framework 5.0**：ORM 資料存取框架
- **SQL Server**：主要資料庫（e-service、MDOD）
- **Dapper 1.60.6**：輕量級 ORM，用於複雜查詢
- **log4net**：日誌記錄框架
- **Hangfire 1.7.19**：背景任務排程系統
- **NPOI 2.5.1**：Excel 文件處理
- **DocX 1.7.0**：Word 文件處理
- **iTextSharp**：PDF 文件產生
- **Spire.Doc 7.11.0**：文件格式轉換
- **JWT 7.3.1**：JSON Web Token 處理

#### 前端技術棧
- **jQuery 1.7.1**：JavaScript 函式庫
- **jQuery UI**：UI 元件庫
- **Bootstrap**：UI 框架（部分頁面使用）
- **FontAwesome 4.7.0**：圖示庫
- **Modernizr 2.5.3**：瀏覽器功能偵測

#### 整合服務
- **信用卡線上繳費**：整合玉山銀行 HPP 繳費系統
- **SFTP 檔案傳輸**：用於與醫審系統交換資料
- **郵件服務**：SMTP 郵件發送功能
- **憑證登入**：支援自然人憑證、工商憑證、醫事人員憑證

### 開發環境需求

#### 後端開發環境
- **.NET Framework**：4.5.2 或更高版本
- **Visual Studio**：2012 或更高版本（建議使用 2019+）
- **SQL Server**：2016 或更高版本
- **IIS**：7.0 或更高版本

#### 資料庫環境
- **主要資料庫（DefaultConnection）**：e-service 資料庫
- **醫審資料庫（MDODConnection）**：MDOD 資料庫
- **SFTP 連線**：用於檔案傳輸

#### 外部服務需求
- **郵件伺服器**：SMTP 服務（mail.turbotech.com.tw）
- **SFTP 伺服器**：檔案傳輸服務（oradb.turbotech.com.tw）
- **信用卡繳費閘道**：玉山銀行 HPP 系統

### 部署注意事項

#### 應用程式部署
1. 確保目標伺服器已安裝 .NET Framework 4.5.2 或更高版本
2. 設定正確的資料庫連線字串（Web.config）
3. 設定郵件伺服器參數
4. 設定 SFTP 連線參數
5. 確保檔案上傳目錄具有適當的寫入權限
6. 設定 IIS 應用程式集區（建議使用 Integrated Mode）

#### 資料庫部署
1. 建立 e-service 資料庫
2. 執行資料庫初始化腳本
3. 設定資料庫使用者權限
4. 建立必要的索引和約束
5. 初始化系統代碼資料（CODE_CD）

#### 安全性設定
1. 啟用 HTTPS（強制 SSL）
2. 設定 Forms Authentication 逾時時間
3. 設定 Cookie 安全屬性（HttpOnly、Secure）
4. 配置防注入攻擊機制
5. 設定檔案上傳類型限制
6. 配置 IP 白名單（Hangfire Dashboard）

#### 效能優化
1. 啟用 Response Compression
2. 設定靜態檔案快取策略
3. 配置資料庫連線池
4. 優化 SQL 查詢效能
5. 設定適當的 Session 逾時時間

## 系統架構特色

### 多單位整合架構
- 支援多個業務單位（醫事司、中醫藥司、社工司等）
- 統一的申辦入口與流程
- 各單位獨立的審核流程與權限控制

### 多元登入機制
- 一般會員帳號密碼登入
- 自然人憑證登入（MOICA）
- 工商憑證登入（MOEACA）
- 醫事人員憑證登入（HCA）
- 數位身分證登入（NEWEID）

### 彈性的代碼管理系統
- 統一代碼表（CODE_CD）管理所有系統代碼
- 支援階層式代碼結構（CODE_PCD）
- 代碼排序與分類管理
- 便於維護與擴充

### 完整的案件生命週期管理
- 草稿 → 送審 → 審核 → 補件 → 核准/退件
- 支援案件撤銷與重新送審
- 完整的案件歷程記錄
- 自動化通知機制

### 整合的繳費系統
- 信用卡線上繳費（玉山銀行 HPP）
- ATM 轉帳繳費
- 繳費狀態查詢與對帳
- 自動化繳費通知

### 背景任務排程系統
- 使用 Hangfire 實作排程功能
- 定時上傳案件至醫審系統（SFTP）
- 定時發送補件通知郵件
- 定時查詢信用卡交易結果
- 支援手動觸發與監控

## 系統使用者角色

### 前台使用者（民眾）
- **一般會員**：註冊會員，可進行線上申辦
- **憑證使用者**：使用憑證登入的使用者
- **代理人**：代理他人申辦的使用者

### 後台使用者（審核人員）
- **承辦人員**：負責案件初審與補件通知
- **主管人員**：負責案件複審與核准
- **系統管理員**：負責系統設定與維護

## 主要業務流程

### 申辦流程
1. 會員登入/註冊
2. 選擇申辦服務
3. 填寫申請資料
4. 上傳附件檔案
5. 確認送出申請
6. 線上繳費（如需要）
7. 等待審核結果

### 審核流程
1. 承辦人員接收案件
2. 審查申請資料
3. 通知補件（如需要）
4. 初審核准/退件
5. 主管複審（如需要）
6. 核發證書/公文
7. 通知申請人

### 補件流程
1. 系統發送補件通知
2. 申請人收到通知
3. 上傳補件資料
4. 重新送審
5. 繼續審核流程

## 技術亮點

### 資料存取層設計
- Entity Framework 用於簡單 CRUD 操作
- Dapper 用於複雜查詢與效能優化
- 統一的 DAO 模式封裝資料存取邏輯
- 支援交易處理與錯誤處理

### 報表產製系統
- Word 模板套表（DocX）
- PDF 文件產生（iTextSharp）
- Excel 報表匯出（NPOI）
- 文件格式轉換（Spire.Doc）

### 安全性機制
- Forms Authentication 身份驗證
- 角色基礎的權限控制
- SQL Injection 防護
- XSS 攻擊防護
- CSRF 防護
- 檔案上傳安全檢查

### 錯誤處理與日誌
- 全域錯誤處理機制
- log4net 日誌記錄
- 錯誤訊息統一管理
- 操作歷程記錄

這個系統展示了完整的政府線上申辦系統架構，整合了多種技術與服務，提供民眾便利的線上申辦體驗，同時確保系統的安全性、穩定性與可維護性。

