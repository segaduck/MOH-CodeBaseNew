# 衛福部線上申辦系統 - 報表與文件產出機制

## 文件產出流程
- FormRptController 依服務代碼呼叫對應 FormXXXXAction，取得資料後輸出 PDF 或 Word 檔案提供承辦下載（Controllers/FormRptController.cs:30）。
- 各 FormAction 皆繼承 FormBaseAction，透過 SQL 讀取案件資料並套用樣版，例如 Form001005Action 產製醫事人員補換證申請書（Action/Form/Form001005Action.cs:28）。
- 後台檔案輸出可透過 DocumentExportController 或 ReportController 取得批次報表，供主管單位審閱（Areas/BACKMIN/Controllers/DocumentExportController.cs:1）。

## PDF 與 Word 樣版
- iTextSharp 用於填寫政府既定 PDF 表格，範例見 Form001005Action 依欄位將資料寫入對應座標（Action/Form/Form001005Action.cs:56）。
- Xceed.Words.NET（DocX）支援 Word 樣版填寫，如 FormRptController.Apply001009 會載入 docx 模板並置換欄位（Controllers/FormRptController.cs:143）。
- 樣版檔案集中於 Sample 資料夾，可依需求更新版面或調整字型。

## Excel 與統計報表
- ReportUtils 提供多種 Excel 匯出方法，RenderDataTableToExcelPayEC 會將請款資料轉成具格式的試算表（Utils/ReportUtils.cs:769）。
- 後台統計功能（MainController、CaseController）常搭配 ReportUtils 產出趨勢報表與案件列表供下載（Areas/BACKMIN/Controllers/MainController.cs:65；Areas/BACKMIN/Controllers/CaseController.cs:360）。
- 若需要 CSV 或其他格式，可在 ReportUtils 中新增自訂輸出方法並於對應控制器呼叫。

## 附件與批次壓縮
- DocumentUtils.DownLoadApplyData 可將申請書資料匯出為 Word，並支援「下載後即刪除」的臨時檔運作（Utils/DocumentUtils.cs:45）。
- GetDI_ZIP 會將申請書、附件與系統產生的 DI 檔案打包成壓縮檔，常用於中醫藥司案件（Utils/DocumentUtils.cs:180）。
- FileDI 與 FileDIZIP 會確保資料夾存在並建立必要目錄結構，便於批次上傳或備份（Utils/DocumentUtils.cs:125）。

## 檔案儲存與安全
- 下載路徑由 SETUP 的 DOWNLOAD_DOCUMENT_PATH 控制，DocumentUtils 會依此路徑輸出檔案（Utils/DocumentUtils.cs:18）。
- PayFileULController 上傳的繳費附件會驗證檔案大小與格式，並寫入資料庫更新補件狀態（Controllers/PayFileULController.cs:25）。
- 建議定期清理下載目錄與臨時檔案，並檢查磁碟權限避免未授權存取。

## 維護建議
- 修改表單樣版時，請同步更新 Sample 目錄與 FormAction 填寫座標，確保欄位對齊。
- 新增報表可優先使用 ReportUtils 現有方法，若需特殊格式可擴充共用工具並集中管理。
- 建議建立自動化測試或人工檢查流程，定期抽查產出文件與系統資料是否一致。
