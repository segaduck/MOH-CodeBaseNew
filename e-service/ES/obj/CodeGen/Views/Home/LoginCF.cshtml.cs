#pragma warning disable 1591
//------------------------------------------------------------------------------
// <auto-generated>
//     這段程式碼是由工具產生的。
//     執行階段版本:4.0.30319.42000
//
//     對這個檔案所做的變更可能會造成錯誤的行為，而且如果重新產生程式碼，
//     變更將會遺失。
// </auto-generated>
//------------------------------------------------------------------------------

namespace ES.Views.Home
{
    using System;
    using System.Collections.Generic;
    using System.IO;
    using System.Linq;
    using System.Net;
    using System.Text;
    using System.Web;
    using System.Web.Helpers;
    using System.Web.Mvc;
    using System.Web.Mvc.Ajax;
    using System.Web.Mvc.Html;
    using System.Web.Optimization;
    using System.Web.Routing;
    using System.Web.Security;
    using System.Web.UI;
    using System.Web.WebPages;
    using ES.Helpers;
    using JQueryUIHelpers;
    
    [System.CodeDom.Compiler.GeneratedCodeAttribute("RazorGenerator", "2.0.0.0")]
    [System.Web.WebPages.PageVirtualPathAttribute("~/Views/Home/LoginCF.cshtml")]
    public partial class LoginCF : System.Web.Mvc.WebViewPage<dynamic>
    {
        public LoginCF()
        {
        }
        public override void Execute()
        {
            
            #line 1 "..\..\Views\Home\LoginCF.cshtml"
  
    Layout = null;

            
            #line default
            #line hidden
WriteLiteral("\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n    <meta");

WriteLiteral(" http-equiv=\"Content-Type\"");

WriteLiteral(" content=\"text/html; charset=UTF-8\"");

WriteLiteral(" />\r\n    <meta");

WriteLiteral(" name=\"viewport\"");

WriteLiteral(" content=\"width=device-width\"");

WriteLiteral(" />\r\n    <title>憑證登入 - 衛生福利部線上申辦維護系統</title>\r\n    <script");

WriteLiteral(" language=\"javascript\"");

WriteLiteral(" type=\"text/javascript\"");

WriteLiteral(">\r\n        var uPKIVersion = \"\";\r\n        var cardType = \"\";\r\n        var pinCode" +
" = \"\";\r\n        var GCAType = \"\";\r\n        function doInit() {\r\n            uPKI" +
"Version = \"\";\r\n            cardType = \"\";\r\n            pinCode = \"\";\r\n\r\n        " +
"    try {\r\n                uPKIVersion = AtxClient.GetVersion();\r\n              " +
"  cardType = AtxClient.GetCardType();                \r\n                pinCode =" +
" parent.document.getElementById(\"CertLoginPinCode\").value;\r\n            } catch " +
"(ex) {\r\n\r\n            }\r\n\r\n            if (uPKIVersion != \"\") {\r\n               " +
" signICCard();\r\n            } else {\r\n                parent.jAlert(\"您尚未安裝uPKI元件" +
"，請先安裝。\");\r\n            }\r\n\r\n            parent.document.getElementById(\"CertLogi" +
"nSubmit\").value = \"登入\";\r\n            parent.document.getElementById(\"CertLoginSu" +
"bmit\").disabled = false;\r\n        }\r\n\r\n        function signICCard() {\r\n        " +
"    \r\n            // 設定License資訊\r\n            setLicense();\r\n\r\n            // 初始" +
"化PKI元件\r\n            var nRet = AtxClient.Init();\r\n\r\n            if (nRet != 0) {" +
"\r\n                var errmsg = getErrorMessage();\r\n\r\n                parent.jAle" +
"rt(errmsg);\r\n                AtxClient.Finalize();\r\n                return;\r\n   " +
"         }\r\n\r\n            if (!isMOICAorMOEACA && !isHCA()) {\r\n                p" +
"arent.jAlert(\"未知的憑證卡類型：\" + cardType);\r\n                return;\r\n            }\r\n\r" +
"\n            if (isHCA()) {\r\n                cardType += AtxClient.GetHCACardTyp" +
"e();\r\n            }\r\n\r\n            var ticket = \"TEST\";\r\n            var pSigned" +
"Data = \"\";\r\n\r\n            // 以IC卡對ticket進行簽章，並包成p7格式簽章封包\r\n            nRet = Atx" +
"Client.EncodeP7SignedData(ticket, \"\", pSignedData, pinCode);\r\n\r\n            if (" +
"nRet != 0) {\r\n                var errmsg = getErrorMessage();\r\n                i" +
"f (errmsg == \"登入失敗\") {\r\n                    parent.jAlert(\"您的卡片可能被鎖卡\");\r\n       " +
"         } else if (errmsg == \"密碼輸入錯誤\") {\r\n                    parent.jAlert(\"PI" +
"N Code 輸入錯誤\");\r\n                } else {\r\n                    parent.jAlert(errm" +
"sg);\r\n                }\r\n                AtxClient.Finalize();\r\n                " +
"return;\r\n            }\r\n\r\n            var cardData = getCardData();\r\n           " +
" parent.document.getElementById(\"CertLoginpSignedData\").value = AtxClient.HexStr" +
"ingToB64(AtxClient.p7SignedData);\r\n            AtxClient.Finalize();\r\n          " +
"  \r\n            if (cardData != null) {\r\n                parent.document.getElem" +
"entById(\"CertLoginCardType\").value = cardData[3];\r\n                parent.docume" +
"nt.getElementById(\"CertLoginCardInfo\").value = cardData[0];\r\n                par" +
"ent.document.getElementById(\"CertLoginUserId\").value = cardData[1];\r\n           " +
"     parent.document.getElementById(\"CertLoginUserName\").value = cardData[2];\r\n " +
"               \r\n                //alert(cardData[1]);\r\n                //alert(" +
"cardData[2]);\r\n               \r\n                parent.document.getElementById(\"" +
"CertLoginForm\").submit();\r\n            }\r\n\r\n            parent.document.getEleme" +
"ntById(\"CertLoginSubmit\").disabled = false;\r\n            parent.document.getElem" +
"entById(\"CertLoginSubmit\").value = \"登入\";\r\n            parent.document.getElement" +
"ById(\"uPkiFrame\").src = \"\";\r\n        }\r\n\r\n        function getCardData() {\r\n    " +
"        /* 卡片資訊 \r\n                0: 憑證\r\n                1: 身分證號、統一編號\r\n         " +
"       2: 姓名、公司名稱 \r\n                3: 類型\r\n            */\r\n            var cardD" +
"ata = new Array(\"\", \"\", \"\",\"\");\r\n            var cert64;\r\n            var cn = \"" +
"\";\r\n\r\n            if (isMOICAorMOEACA()) { // 自然人憑證或工商\r\n                var cert" +
"Array;\r\n\r\n                // 取得簽章憑證，回傳 base64 格式\r\n                if (AtxClient." +
"GetUserCertFromToken(pinCode, 1, 0, 1)) {\r\n                    certArray = AtxCl" +
"ient.certificates;\r\n                } else {\r\n                    parent.jAlert(" +
"getErrorMessage());\r\n                    return null;\r\n                }\r\n\r\n    " +
"            if (typeof(certArray) == \"string\") {\r\n                    cert64 = c" +
"ertArray;\r\n                } else {\r\n                    cert64 = certArray[cert" +
"Array.length - 1];\r\n                }\r\n                AtxCert.B64Cert = cert64;" +
"\r\n\r\n                //判斷憑證類型\r\n              \r\n                if (AtxClient.GetG" +
"CAOID().length !=4) {//工商     \r\n                    // 簽章憑證\r\n                   " +
" cardData[0] = cert64;\r\n\r\n\r\n                    cardData[1] = AtxClient.GetGCAOr" +
"ganizationID();\r\n\r\n\r\n                    cardData[2] = AtxClient.GetCertSubjectN" +
"ame();\r\n                    cardData[3] = \"MOEACA\";\r\n                }\r\n        " +
"        else {//自然人\r\n                    cn = AtxCert.CommonName;\r\n\r\n           " +
"         // 簽章憑證\r\n                    cardData[0] = cert64;\r\n\r\n                 " +
"   // 身分證號後四碼\r\n                    if (AtxClient.DecodeCertificate(cert64, 1) ==" +
" 0) {\r\n                        cardData[1] = AtxClient.GetGCAOID();\r\n           " +
"         }\r\n\r\n                    cardData[2] = cn;\r\n                    cardDat" +
"a[3] = \"MOICA\";\r\n                } \r\n                \r\n            } else if (is" +
"HCA0()) { // 醫事機構卡\r\n                if (AtxClient.GetCertFromToken(1, 0, 1)) {\r\n" +
"                    cert64 = AtxClient.certificates;\r\n                }\r\n\r\n     " +
"           // 簽章憑證\r\n                cardData[0] = cert64;\r\n\r\n                if " +
"(AtxClient.DecodeHCAHospitalRecordData() != 0) {\r\n                    cardData[1" +
"] = AtxClient.GetHCAHospitalID();\r\n                    cardData[2] = AtxClient.G" +
"etHCAHospitalName();\r\n                }\r\n\r\n                cardData[3] = \"HCA0\";" +
"\r\n\r\n            } else if (isHCA1()) { // 醫事人員卡\r\n                /*\r\n           " +
"     var nRet = AtxClient.HCAGetCertificate1(cert64, pinCode, 0, 1);\r\n\r\n        " +
"        if (nRet != 0) {\r\n                    parent.jAlert(\"取得HCA卡憑證錯誤：\" + getE" +
"rrorMessage());\r\n                    return null;\r\n                }\r\n          " +
"      */\r\n\r\n                // 簽章憑證\r\n                cardData[0] = cert64;\r\n\r\n  " +
"              // 身分證號\r\n                if (AtxClient.DecodeHCAPersonRecordData()" +
") {\r\n                    cardData[1] = AtxClient.GetHCAPersonID();\r\n            " +
"        cardData[2] = AtxClient.GetHCAPersonCHTName();\r\n                }\r\n     " +
"           cardData[3] = \"HCA1\";\r\n            } else {\r\n                parent.j" +
"Alert(\"未知的憑證卡類型：\" + cardType);\r\n                return null;\r\n            }\r\n\r\n " +
"           return cardData;\r\n        }\r\n\r\n        function setLicense() {\r\n     " +
"       AtxClient.setLicense(\"0fca842f933eb6292e6fd5d9fb9188e486ac69a35bb7e970d5c" +
"69175fefeaa0575b8fb6a3c56c1c12e53b60a35ef7168664af511e5024e0e6cf7739f7a04043d91e" +
"69123ffd70e986201858e3f967f476bfce675e12e2aa1b516f2eaa3568924c0c5affd2a165cf377c" +
"e28cb4ae149ed6b9e12018a9c9613d583aad599bf2363\", \"行政院衛生署\");\r\n        }\r\n\r\n       " +
" function getErrorMessage() {\r\n            return trim(AtxClient.GetErrorMessage" +
"()).replace(/\\r/ig, \"\").replace(/\\n/ig, \"<br />\");\r\n        }\r\n\r\n        functio" +
"n trim(str){\r\n            var start = -1,\r\n            end = str.length;\r\n      " +
"      while( str.charCodeAt(--end) < 33 );\r\n            while( str.charCodeAt(++" +
"start) < 33 );\r\n            return str.slice( start, end + 1 );\r\n        };\r\n\r\n " +
"       // 是否為自然人憑證或工商憑證\r\n        function isMOICAorMOEACA() {\r\n            retur" +
"n (cardType == \"HiCOS\" || cardType == \"HiCard\" || cardType == \"HiKey\" || cardTyp" +
"e == \"自然人憑證(GP)\" || cardType == \"自然人憑證(TP)\");\r\n        }\r\n        \r\n        // 是" +
"否為HCA卡\r\n        function isHCA() {\r\n            return (cardType == \"HCA\");\r\n   " +
"     }\r\n\r\n        // 是否為醫事機構憑證\r\n        function isHCA0() {\r\n            return " +
"(cardType == \"HCA0\");\r\n        }\r\n\r\n        // 是否為醫事人員憑證\r\n        function isHCA" +
"1() {\r\n            return (cardType == \"HCA1\");\r\n        }\r\n    </script>\r\n</hea" +
"d>\r\n<body");

WriteLiteral(" onload=\"doInit();\"");

WriteLiteral(">\r\n<object");

WriteLiteral(" id=\"AtxClient\"");

WriteLiteral("\r\n    classid=\"CLSID:EA9EBB6D-6CBB-4BF8-9A12-E0664FFFF93E\"");

WriteAttribute("codebase", Tuple.Create("\r\n    codebase=\"", 8003), Tuple.Create("\"", 8092)
            
            #line 242 "..\..\Views\Home\LoginCF.cshtml"
, Tuple.Create(Tuple.Create("", 8019), Tuple.Create<System.Object, System.Int32>(Url.Action("Index", "Home")
            
            #line default
            #line hidden
, 8019), false)
, Tuple.Create(Tuple.Create("", 8047), Tuple.Create("ActiveX/AresPKIAtxClient.CAB#version=7,5,0,20", 8047), true)
);

WriteLiteral(">\r\n</object>\r\n<object");

WriteLiteral(" id=\"AtxCert\"");

WriteLiteral("\r\n    classid=\"clsid:BB795567-9898-40A4-870E-348D07E929FA\"");

WriteAttribute("codebase", Tuple.Create("\r\n    codebase=\"", 8185), Tuple.Create("\"", 8274)
            
            #line 246 "..\..\Views\Home\LoginCF.cshtml"
, Tuple.Create(Tuple.Create("", 8201), Tuple.Create<System.Object, System.Int32>(Url.Action("Index", "Home")
            
            #line default
            #line hidden
, 8201), false)
, Tuple.Create(Tuple.Create("", 8229), Tuple.Create("ActiveX/AresPKIAtxClient.CAB#Version=7,5,0,20", 8229), true)
);

WriteLiteral(">\r\n</object>\r\n<object");

WriteLiteral(" id=\"AtxUtil\"");

WriteLiteral("\r\n    classid=\"clsid:E2FB61A3-77EC-4B72-A6AD-10C0641F39CA\"");

WriteAttribute("codebase", Tuple.Create("\r\n    codebase=\"", 8367), Tuple.Create("\"", 8456)
            
            #line 250 "..\..\Views\Home\LoginCF.cshtml"
, Tuple.Create(Tuple.Create("", 8383), Tuple.Create<System.Object, System.Int32>(Url.Action("Index", "Home")
            
            #line default
            #line hidden
, 8383), false)
, Tuple.Create(Tuple.Create("", 8411), Tuple.Create("ActiveX/AresPKIAtxClient.CAB#Version=7,5,0,20", 8411), true)
);

WriteLiteral(">\r\n</object>\r\n</body>\r\n</html>\r\n");

        }
    }
}
#pragma warning restore 1591
