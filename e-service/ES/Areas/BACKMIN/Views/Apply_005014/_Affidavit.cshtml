@model ES.Areas.BACKMIN.Models.Apply_005014ViewModel
@using ES.Areas.BACKMIN.Models
@using ES.Models
@*@using ES.Models.ViewModels
*@
@using System.Linq.Expressions

@{
    ViewBag.Title = "_AFFIDAVIT";
    ShareCodeListModel options = new ShareCodeListModel();
}

@*<h2>_AFFIDAVIT</h2>*@
<div id="_affidavit">
    <h2 class="second-title"> 一般切結書 </h2>
    <div class="form-group">
        @*@CreateField(
            "出口國",
            Html.TextBoxFor(x => x.Detail.AFF1_EXPORT_COUNTRY, new { @class = "form-control" }),
            Html.TextBoxFor(x => x.Detail.AFF1_EXPORT_COUNTRY_E, new { @class="errata-msg form-control", placeholder = "補件備註" }, false),
            true
        )*@
    </div>
    @*<div class="form-group">
        @CreateField(
            "貨品名稱",
            Html.TextBoxFor(x => x.Detail.AFF1_COMMODITIES, new { @class = "form-control" }),
            Html.TextBoxFor(x => x.Detail.AFF1_COMMODITIES_E, new { @class="errata-msg form-control", placeholder = "補件備註" }, false),
            true
        )
    </div>*@
    @*<div class="form-group">
        @CreateField(
            "貨品數量",
            Html.TextBoxFor(x => x.Detail.AFF1_QTY, new { @class = "form-control" }),
            Html.TextBoxFor(x => x.Detail.AFF1_QTY_E, new { @class="errata-msg form-control", placeholder = "補件備註" }, false),
            true
        )
    </div>*@
    <div class="form-group">
        @*@CreateField(
            "報單號碼",
            Html.TextBoxFor(x => x.Detail.AFF1_SHEET_NO, new { @class = "form-control" }),
            Html.TextBoxFor(x => x.Detail.AFF1_SHEET_NO_E, new { @class="errata-msg form-control", placeholder = "補件備註" }, false))*@
    </div>
    @*<div class="form-group">
        @CreateField(
            "報單號碼項次",
            Html.TextBoxFor(x => x.Detail.AFF1_NO, new { @class = "form-control" }),
            Html.TextBoxFor(x => x.Detail.AFF1_NO_E, new { @class = "errata-msg form-control", placeholder = "補件備註" }, false),
            false
        )
    </div>*@
    <div class="form-group">
        @*@CreateField(
            "進口關",
            Html.DropDownListFor(x => x.Detail.AFF1_IMPORT_COUNTRY, options.LocalPortList, "請選擇", new { @class = "form-control" }),
            Html.TextBoxFor(x => x.Detail.AFF1_IMPORT_COUNTRY_E, new { @class= "errata-msg form-control", placeholder = "補件備註" }), false)*@
    </div>

    <h2 class="second-title">
        @*<input type="checkbox">萃取物(提取物)切結書*@
        @{
            Dictionary<string, object> dict = new Dictionary<string, object>();
            dict["v-model"] = "aff2";
        }
        <label class="checkbox-inline">
            @*@Html.CheckBoxFor(x => x.Detail.AFFIDAVIT2_CHECKED, dict)*@ 萃取物(提取物)切結書
        </label>
    </h2>
    @*<fieldset v-bind:disabled="!aff2">*@
        <div class="form-group">
            @*@CreateField(
                "出口國",
                Html.TextBoxFor(x => x.Detail.AFF2_EXPORT_COUNTRY, new { @class = "form-control" }),
                Html.TextBoxFor(x => x.Detail.AFF2_EXPORT_COUNTRY_E, new { @class="errata-msg form-control", placeholder = "補件備註" }, false),
                true
            )*@
        </div>
        @*<div class="form-group">
            @CreateField(
                "貨品名稱",
                Html.TextBoxFor(x => x.Detail.AFF2_COMMODITIES, new { @class = "form-control" }),
                Html.TextBoxFor(x => x.Detail.AFF2_COMMODITIES_E, new { @class="errata-msg form-control", placeholder = "補件備註" }, false),
                true
            )
        </div>*@
        @*<div class="form-group">
            @CreateField(
                "貨品數量",
                Html.TextBoxFor(x => x.Detail.AFF2_QTY, new { @class = "form-control" }),
                Html.TextBoxFor(x => x.Detail.AFF2_QTY_E, new { @class="errata-msg form-control", placeholder = "補件備註" }, false),
                true
            )
        </div>*@
        <div class="form-group">
            @*@CreateField(
                "原中藥材名稱",
                Html.TextBoxFor(x => x.Detail.AFF2_AMOUNT_NAME, new { @class = "form-control" }),
                Html.TextBoxFor(x => x.Detail.AFF2_AMOUNT_NAME_E, new { @class = "errata-msg form-control", placeholder = "補件備註" }, false),
                true
            )*@
        </div>
        <div class="form-group">
            @*@CreateField(
                    "原中藥材含量",
                    Html.TextBoxFor(x => x.Detail.AFF2_AMOUNT, new { @class = "form-control" }),
                    Html.TextBoxFor(x => x.Detail.AFF2_AMOUNT_E, new { @class = "errata-msg form-control", placeholder = "補件備註" }, false),
                    true
                )*@
            公克
            <div class="col-sm-10 col-sm-offset-2">產品每公克含原中藥材 OO共 OO 公克，範例:產品每公克含原中藥材當歸共0.5公克</div>
        </div>
        <div class="form-group">
            @*@CreateField(
                "報單號碼",
                Html.TextBoxFor(x => x.Detail.AFF2_SHEET_NO, new { @class = "form-control" }),
                Html.TextBoxFor(x => x.Detail.AFF2_SHEET_NO_E, new { @class="errata-msg form-control", placeholder = "補件備註" }, false))*@
        </div>
        @*<div class="form-group">
            @CreateField(
                "報單號碼項次",
                Html.TextBoxFor(x => x.Detail.AFF2_NO, new { @class = "form-control" }),
                Html.TextBoxFor(x => x.Detail.AFF2_NO_E, new { @class="errata-msg form-control", placeholder = "補件備註" }, false))
        </div>*@
        <div class="form-group">
            @*@CreateField(
                "進口關",
                Html.DropDownListFor(x => x.Detail.AFF2_IMPORT_COUNTRY, options.LocalPortList, "請選擇", new { @class = "form-control" }),
                Html.TextBoxFor(x => x.Detail.AFF2_IMPORT_COUNTRY_E, new { @class= "errata-msg form-control", placeholder = "補件備註" }), false)*@
        </div>
    @*</fieldset>*@
</div>


@helper CreateField(string name, MvcHtmlString mainField, MvcHtmlString errataField, bool isRequired = false)
{
    string guid = Guid.NewGuid().ToString();
    <label class="main-label col-sm-2">
        <input type="checkbox" onchange="toggle(this, '@guid')" />
        @if (isRequired)
        {
            <span style="color:red;">*</span>
        }
        else
        {
            <span></span>
        } @name
    </label>
    <div class="col-sm-10" id="@guid">
        @mainField
        @errataField
    </div>
}

@helper CreateField(string name, MvcHtmlString mainField, MvcHtmlString subField, MvcHtmlString errataField, bool isRequired = false)
{
    string guid = Guid.NewGuid().ToString();
    <label class="main-label col-sm-2">
        <input type="checkbox" onchange="toggle(this, '@guid')" />
        @if (isRequired)
        {
            <span style="color:red;">*</span>
        }
        else
        {
            <span></span>
        } @name
    </label>
    <div class="col-sm-10" id="@guid">
        @mainField
        @subField
        @errataField
    </div>
}


<script>
    function toggle(e, guid) {
        var sel = $(e).prop('checked');
        if (sel) {
            $('#' + guid).find('.errata-msg').show();
        } else {
            $('#' + guid).find('.errata-msg').hide();
        }
    }
    $(function () {
        $('#_affidavit .errata-msg').hide();
    })
</script>

<script>
    @*var vm = new Vue({
        name: 'Affidavit',
        data: function () {
            return {
                aff2: ('@Model.Detail.AFFIDAVIT2' == 'Y')
            }
        }
    });
    vm.$mount('#_affidavit');*@
</script>

<script>
    $('.aff1l1').on('change', function (e) {
        GetHarborList('Detail_Aff1ImportCountryL1', 'Detail_AFF1_IMPORT_COUNTRY');
        $('#Detail_AFF1_IMPORT_COUNTRY').val($('#Detail_Aff1ImportCountryL1 option:selected').text());
    });
    $('.aff2l1').on('change', function (e) {
        GetHarborList('Detail_Aff2ImportCountryL1', 'Detail_AFF2_IMPORT_COUNTRY');
        $('#Detail_AFF2_IMPORT_COUNTRY').val($('#Detail_Aff2ImportCountryL1 option:selected').text());
    });

    function GetHarborList(TRN_PORT_ID, TRN_PORT_ID2) {
        var port = $('#' + TRN_PORT_ID);

        var data = {
            'url': '/Ajax/GetHarborList', 'msg': '查無該港口!!', 'arg': { 'port': port.val() }, 'result': $('#' + TRN_PORT_ID)
        };

        if ($.trim(data.arg.port) == '')
            data.result.val('');
        else {
            port.val(data.arg.port);
            loadHarborList(data, TRN_PORT_ID2);
        }
    };

    function loadHarborList(data, objectId) {
        ajaxLoadMore(data.url, data.arg, function (resp) {
            if (resp === undefined) {
                data.result.val('');
            }
            else {
                if (resp.data != '') {
                    $('#' + objectId).empty();
                    $.each(resp.data, function (i, item) {
                        $('#' + objectId).append('<option value=' + item.CODE + '>' + item.TEXT + '</option>');
                    });
                }
                else {
                    data.result.val('');
                    blockAlert(data.msg);
                }
            }
        });
    };

    $(function () {
        $('select.aff1l1').trigger('change');
        $('select.aff2l1').trigger('change');
    })

</script>

