@using ES.Utils;
@model ES.Areas.Admin.Models.PayECModel
<script src="../../Scripts/View/Maintain.js" type="text/javascript"></script>

<script type="text/javascript">
    $(document).ready(function () {
        $('#sel_SRV_ID').val('@this.Model.queryModel.SRV_ID');
        $('#sel_SC_PID').val('@this.Model.queryModel.SC_PID');
        $('#sel_SC_PID').change();
        $('#queryModel_APP_TIME_BEGIN').datepicker();
        var a = $('#queryModel_APP_TIME_BEGIN').val();
        if (a.length > 10) {
            $('#queryModel_APP_TIME_BEGIN').val(a.substring(0, 10));
        }
        $('#queryModel_APP_TIME_END').datepicker();
        var b = $('#queryModel_APP_TIME_END').val();
        if (b.length > 10) {
            $('#queryModel_APP_TIME_END').val(b.substring(0, 10));
        }
    });

    function doQuery(page) {
        $('#queryModel_NowPage').val(page);
        $('#ActionType').val('Query');
    }

     function doExport() {
        $('#ActionForm').prop("action", "@Url.Action("ExportRspList", "PayEC")");
        $('#ActionForm').submit();
    }

    function doSearchEC(type) {
        $('#submit_type').val(type);
    }
</script>
@{
    Layout = "~/Areas/BACKMIN/Views/Shared/_Layout.cshtml";

    ViewBag.Title = "信用卡請款";
    ViewBag.FunctionTitle = "信用卡請款";
}


<div class="bread">
    <i class="fas fa-home"></i>首頁 / 帳務管理 / @ViewBag.Title
</div>
@using (Html.BeginForm("PayFileUpload", "PayEC", FormMethod.Post, new { ID = "FileForm", enctype = "multipart/form-data" }))
{
    <div class="col-sm-12 content">
        <h1 class="main-title"><i class="fas fa-edit"></i>@ViewBag.FunctionTitle</h1>

        <div class="form-group">
            <label class="main-label col-sm-2" for="">選擇檔案</label>
            <div class="col-sm-10">
                <input type="file" id="Text_UploadFile" name="Text_UploadFile" value="" class="form-control" />
            </div>
        </div>
        <div class="btnbar">
            <input type="submit" value="上傳" class="btn btn-blue" />
        </div>
    </div>
}
@using (Html.BeginForm("Index", "PayEC", FormMethod.Post, new { ID = "ActionForm" }))
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true)
    <div class="col-sm-12 content">
        <h1 class="main-title"><i class="fas fa-edit"></i>@ViewBag.FunctionTitle</h1>
        <div class="form-blue form-horizontal">
            <div class="form-group">
                <label class="main-label col-sm-2" for="">@Html.DisplayNameFor(m => m.queryModel.APP_ID_BEGIN)</label>
                <div class="col-sm-10">
                    @Html.TextBoxFor(m => m.queryModel.APP_ID_BEGIN, new { @class = "form-normal" })
                    ～
                    @Html.TextBoxFor(m => m.queryModel.APP_ID_END, new { @class = "form-normal" })
                </div>
            </div>
            <div class="form-group">
                <label class="main-label col-sm-2" for="">@Html.DisplayNameFor(m => m.queryModel.APP_TIME_BEGIN)</label>
                <div class="col-sm-10">
                    @Html.TextBoxFor(m => m.queryModel.APP_TIME_BEGIN, String.Format("{0:yyyy/MM/dd}", Model.queryModel.APP_TIME_BEGIN), new { @class = "form-normal" })
                    ～
                    @Html.TextBoxFor(m => m.queryModel.APP_TIME_END, String.Format("{0:yyyy/MM/dd}", Model.queryModel.APP_TIME_END), new { @class = "form-normal" })
                </div>
            </div>
            <div class="form-group">
                <label class="main-label col-sm-2" for="">@Html.DisplayNameFor(m => m.queryModel.SC_PID)</label>
                <div class="col-sm-4">
                    @Html.HiddenFor(m => m.queryModel.SC_PID)
                    @Html.HiddenFor(m => m.queryModel.SRV_ID)
                    <select class="form-normal" id="sel_SC_PID" onchange="SetNextAgain(this.value,'@Url.Action("Index", "Home", new {Area="" })');$('#SC_PID').val(this.value);">
                        <option value="">請選擇</option>
                    </select>
                    <select class="form-normal" id="sel_SRV_ID" onchange="$('#queryModel_SRV_ID').val(this.value);">
                        <option value="">請選擇</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label class="main-label col-sm-2" for="">@Html.DisplayNameFor(m => m.queryModel.RSP_STATUS)</label>
                <div class="col-sm-10">
                    @Html.HiddenFor(m => m.queryModel.RSP_STATUS)
                    <select id="sel_RSP_STATUS" name="sel_RSP_STATUS" class="form-normal">
                        <option value="">請選擇</option>
                        <option value="Y">成功</option>
                        <option value="N">失敗</option>
                    </select>
                </div>
            </div>
            <div class="btnbar">
                @Html.HiddenFor(m => m.queryModel.NowPage)
                @Html.HiddenFor(m => m.submit_type)
                <input type="submit" onclick="doSearchEC('1')" value="查詢" class="btn btn-blue" />
                <input type="submit" onclick="doSearchEC('2')" value="匯出請款檔" class="btn btn-blue" />
                <input type="submit" onclick="doExport()" value="匯出請款回覆清單" class="btn btn-blue" />
            </div>
        </div>

        @{
            <div class="table-pager">
                @Html.HiddenFor(m => m.queryModel.NowPage)
                @Html.ShowGridPage((int)ViewBag.NowPage, (int)ViewBag.TotalPage, (int)ViewBag.TotalCount)
            </div>
            <div class="clearfix"></div>
            if (ViewBag.List != null)
            {
                <h2 class="second-title">查詢結果</h2>
                <div class="table-responsive">
                    <table width="100%" border="0" cellspacing="0" cellpadding="0" class="table-typeA table">
                        <thead>
                            <tr>
                                <th>編號</th>
                                <th>申辦項目</th>
                                <th>訂單編號</th>
                                <th>申辦日期</th>
                                <th>申請人姓名</th>
                                <th>繳費方式</th>
                                <th>繳費狀態</th>
                                <th>請款狀態</th>
                            </tr>
                        </thead>
                        <tbody>
                            @{
                                foreach (ES.Areas.Admin.Models.Map map in ViewBag.List)
                                {
                                    String payword = WebUtils.GetPayWord(map);
                                    String paymethod = map.GetString("PAY_METHOD");
                                    <tr>
                                        <td>
                                            @map.Get("APP_ID")
                                        </td>
                                        <td>
                                            @Html.Raw(map.Get("SRV_NAME"))
                                        </td>
                                        <td>
                                            @map.Get("ECORDERID")
                                        </td>
                                        <td>
                                            @Html.Raw(map.Get("APP_TIME"))
                                        </td>
                                        <td>
                                            @Html.Raw(map.Get("NAME"))
                                        </td>
                                        <td>
                                            @Html.Raw(WebUtils.GetPay_Method(map.GetString("PAY_METHOD")))
                                            (@map.Get("PAY_BANK"))
                                        </td>
                                        <td>
                                            @payword
                                        </td>
                                        <td>@(Html.Raw(map.Get("RSP_NAME")))</td>
                                    </tr>
                                }
                            }
                        </tbody>
                    </table>
                </div>
            }

        }
    </div>
}
