@using ES.Models
@using ES.Services
@model ES.Models.ViewModels.Apply_005005ViewModel

@{
    Layout = "~/Views/Shared/_MainLayout.cshtml";
    ShareCodeListModel dropdown = new ShareCodeListModel();
}
@using (Html.BeginForm("DocSave", "Apply_005005", FormMethod.Post, htmlAttributes: new { @class = "form-horizontal", id = "main_form", @enctype = "multipart/form-data" }))
{
    <div class="container">
        <div class="col-sm-12">
            <!-- bread  -->
            <div class="breadlink"><i class="fas fa-home"></i><a href="@(Url.Action("Index", "Login"))">首頁</a> ／ <a href="@(Url.Action("Index", "Service"))">申辦服務</a> ／ <a href="#">中藥GMP廠證明文件(英文)</a></div>
            <div class="clearfix"></div>
            <h3 class="note-title" style="color:red;">粉紅色欄位為通知補件欄位，請確認</h3>
            <div class="tab-content" id="myTabContent">
                <div id="form" class="tab-pane fade active in">
                    <h1 class="form-title  title-bg-y">申辦表件填寫</h1>
                    <div class="form-set">
                        <!--申辦表件填寫-->
                        <div class="form-group">
                            <label class="step-label col-sm-2" for="">申辦項目</label>
                            <div class="col-sm-4">
                                <p class="form-control-static">中藥GMP廠證明文件(英文)</p>
                                @Html.HiddenFor(m => m.FormBack.APP_ID)
                                @Html.HiddenFor(m => m.FormBack.CODE_CD)
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="step-label col-sm-2" for="">申請日期</label>
                            <div class="col-sm-10">
                                @Html.BLATYPForTurbo(m => m.FormBack.APP_TIME_TW, Model.FormBack.APP_TIME_TW)
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="step-label col-sm-2" for=""><span style="color:red;">*</span>申辦份數</label>
                            <div class="col-sm-4">
                                @Html.BLATYPForTurbo(m => m.FormBack.PAYCOUNT, Model.FormBack.PAYCOUNT)
                            </div>
                            <label class="step-label col-sm-2" for="">繳費金額</label>
                            <div class="col-sm-4">
                                <label class='form-control-static' style='font-weight:normal'>@Model.FormBack.PAY_A_FEE</label>
                                @Html.HiddenFor(m => m.FormBack.PAY_A_FEE)
                            </div>
                        </div>
                        <!--申請基本資料-->
                        <h2 class="second-title">申請基本資料</h2>
                        <div class="form-group">
                            <label class="step-label col-sm-2" for=""><span style="color:red;"> *</span> 公司名稱 </label>
                            <div class="col-sm-10">
                                @Html.BLATYPForTurbo(m => m.FormBack.COMP_NAME, Model.FormBack.COMP_NAME)
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="step-label col-sm-2" for=""><span style="color:red;">*</span> 聯絡人 </label>
                            <div class="col-sm-4">
                                @Html.BLATYPForTurbo(m => m.FormBack.CNT_NAME, Model.FormBack.CNT_NAME)
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="step-label col-sm-2" for=""><span style="color:red;">*</span> 電話 </label>
                            <div class="col-sm-10">
                                @Html.BLATYPForTurbo(m => m.FormBack.TEL, Model.FormBack.TEL)
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="step-label col-sm-2" for="">傳真</label>
                            <div class="col-sm-10">
                                @Html.BLATYPForTurbo(m => m.FormBack.FAX, Model.FormBack.FAX)
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="step-label col-sm-2" for=""><span style="color:red;">*</span>E-MAIL </label>
                            <div class="col-sm-10">
                                @Html.BLATYPForTurbo(m => m.FormBack.EMAIL, Model.FormBack.EMAIL)
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="step-label col-sm-2" for=""><span style="color:red;">*</span>外銷國家</label>
                            <div class="col-sm-10">
                                @Html.TextBoxFor(m => m.FormBack.IMP_COUNTRY, new { @class = "form-control", @placeholder = "可輸入多個外銷國，各國名之間以「,」隔開，最後請以「.」結尾" })
                                @Html.TextBoxFor(m => m.Detail.IMP_COUNTRY, new { @class = "form-control", @readonly = "readonly" })
                            </div>
                            <div class="col-sm-2"></div>
                            <div class="col-sm-10">可輸入多個外銷國，各國名之間以「,」隔開，最後請以「.」結尾。</div>
                        </div>
                        <div class="form-group">
                            <label class="step-label col-sm-2" for=""><span style="color:red;">*</span>製造廠許可編號</label>
                            <div class="col-sm-10">
                                @Html.TextBoxFor(m => m.FormBack.LIC_NUM, new { @class = "form-control", placeholder = "請輸入「(C)」+7位數字" })
                                @Html.TextBoxFor(m => m.Detail.LIC_NUM, new { @class = "form-control", @readonly = "readonly" })
                            </div>
                            <div class="col-sm-2"></div>
                            <div class="col-sm-10">1.請依本部核發之藥物製造或展延許可函所載許可編號輸入。<br />2.同時搜尋帶入：最近一次GMP查廠日期、GMP有效日期。</div>
                        </div>
                        <div class="form-group">
                            <label class="step-label col-sm-2" for=""><span style="color:red;">*</span>製造廠名稱</label>
                            <div class="col-sm-10">
                                @Html.TextBoxFor(m => m.FormBack.MF_CNT_NAME, new { @class = "form-control" })
                                @Html.TextBoxFor(m => m.Detail.MF_CNT_NAME, new { @class = "form-control", @readonly = "readonly" })
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="step-label col-sm-2" for=""><span style="color:red;">*</span>製造廠地址</label>
                            <div class="col-sm-10">
                                @Html.TextBoxFor(m => m.FormBack.MF_ADDR, new { @class = "form-control" })
                                @Html.TextBoxFor(m => m.Detail.MF_ADDR, new { @class = "form-control", @readonly = "readonly" })
                            </div>
                            <div class="col-sm-2"></div>
                            <div class="col-sm-10">1.請依製造業藥商許可執照所載製造廠地址，以及郵遞區號、國名，英譯後輸入。<br />2.建議可至中華郵政官網使用中文地址英譯功能，翻譯製造廠地址。</div>
                        </div>
                        <div class="form-group">
                            <label class="step-label col-sm-2" for=""><span style="color:red;">*</span> 最近一次GMP查廠日期 </label>
                            <div class="col-sm-4">
                                @Html.DatePickerTWFor(m => m.FormBack.ISSUE_DATE, new { size = "10" })
                                @Html.TextBoxFor(m => m.Detail.ISSUE_DATE, new { @class = "form-control", @readonly = "readonly" })
                            </div>
                            <label class="step-label col-sm-2" for=""><span style="color:red;">*</span> GMP有效日期 </label>
                            <div class="col-sm-4">
                                @Html.DatePickerTWFor(m => m.FormBack.EXPIR_DATE, new { size = "10" })
                                @Html.TextBoxFor(m => m.Detail.EXPIR_DATE, new { @class = "form-control", @readonly = "readonly" })
                            </div>
                            <label class="col-sm-2"></label>
                            <div class="col-sm-10">1.請依本部核發之藥物製造或展延許可函所載許可編號輸入。<br />2.可使用下拉式選單修改自動帶入之資料，欲重新帶入請重複輸入「製造廠許可編號」之步驟。</div>
                        </div>


                        <!--佐證文件檔案上傳-->
                        <h2 class="second-title">佐證文件檔案上傳</h2>
                        <div class="form-group">
                            <label class="step-label col-sm-2" for="">佐證文件採合併檔案</label>
                            <div class="col-sm-10">
                                <label class="radio-inline "><input type="radio" name="optradio" value="Y" onchange="RadioChange()">是</label>
                                <label class="radio-inline "><input type="radio" name="optradio" value="N" checked onchange="RadioChange()">否</label>
                                @Html.HiddenFor(m => m.FormBack.RADIOYN)
                            </div>
                            <div class="col-sm-2"></div>
                            <div class="col-sm-10">若您是將檔案掃描後，於同一份文件內上傳，請選擇佐證文件採合併檔案"是"，檔案分開上傳請選擇"否"</div>
                        </div>
                        <div class="form-group">
                            <label class="step-label col-sm-2" for="">本部核發藥物製造或展延許可函影本</label>
                            <div class="col-sm-10">
                                @Html.FileDLForTurbo(m => m.FormBack.Name_File_1, Model.FormBack.Name_File_1_TEXT,"N")
                                <input type="file" class="form-control" name="FormBack.File_1" id="newFile_1" onchange="doGetFileNam(this)" />
                                @Html.TextBoxFor(m => m.Detail.Name_File_1, new { @class = "form-control", @readonly = "readonly" })
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="step-label col-sm-2" for="">製造業藥商許可執照影本</label>
                            <div class="col-sm-10">
                                @Html.FileDLForTurbo(m => m.FormBack.Name_File_2, Model.FormBack.Name_File_2_TEXT,"N")
                                <input type="file" class="form-control" name="FormBack.File_2" id="newFile_2" onchange="doGetFileNam(this)" />
                                @Html.TextBoxFor(m => m.Detail.Name_File_2, new { @class = "form-control", @readonly = "readonly" })
                            </div>
                        </div>
                        <div class="btn-bar text-center">
                            <button type="button" class="btn btn-save" onclick="send()">送出</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
<script>

    $(document).ready(function() {
        $('input[name^="Detail"]').each(function(item) {
            var itemID = $(this).attr("id").replace("Detail_", "");

            if ($(this).val() != "") {
                $('#FormBack_' + itemID).css("background-color", "#FF9797");
                if (itemID == "ISSUE_DATE") {
                    $('#FormBack_' + itemID + '_TW').css("background-color", "#FF9797");
                }
            } else {
                $('#FormBack_' + itemID).attr("readonly", "readonly");
                if (itemID == "ISSUE_DATE") {
                    $('#FormBack_' + itemID + '_TW').attr("readonly", "readonly");
                }
            }

            if ($(this).val() != "") {
                $('#FormBack_' + itemID).css("background-color", "#FF9797");
                if (itemID == "EXPIR_DATE") {
                    $('#FormBack_' + itemID + '_TW').css("background-color", "#FF9797");
                }
            } else {
                $('#FormBack_' + itemID).attr("readonly", "readonly");
                if (itemID == "EXPIR_DATE") {
                    $('#FormBack_' + itemID + '_TW').attr("readonly", "readonly");
                }

                $(this).hide();
            }
        });

        $("input[type='radio']").attr("disabled", "disabled");

        if ($('#FormBack_RADIOYN').val() == "N") {
            $($('input[type="radio"]')[1]).attr("checked", "checked");
        } else {
            $($('input[type="radio"]')[0]).attr("checked", "checked");
        }

        $('input[name^="Detail.Name"]').each(function () {
            var itemID = $(this).attr("id").replace("Detail_Name_", "");
            if ($(this).val() == "") {
                $("#new" + itemID).attr("disabled", "disabled");
            } else {
                $("#new" + itemID).css("background-color", "#FF9797");
            }
        });
    });

    // 取檔名
    function doGetFileNam(file) {
        var validExts = new Array(".DOC",
            ".DOCX",
            ".ODT",
            ".ODF",
            ".ODS",
            ".XLS",
            ".XLSX",
            ".PDF",
            ".PPT",
            ".PPTX",
            ".JPG",
            ".JPEG",
            ".BMP",
            ".PNG",
            ".GIF",
            ".TIF",
            ".ZIP");
        var filename = file.files.item(0).name;
        var fileExt = filename.substring(filename.lastIndexOf('.'));

        if (validExts.indexOf(fileExt.toUpperCase()) < 0) {
            blockAlert("檔案類型錯誤，可接受的副檔名有：" + validExts.toString());
            $('input[name="' + file.name + '"]').val(null);
            return false;
        } else {
            $("#" + file.name + "_TEXT").val(file.files.item(0).name);
            return true;
        }
    }

    // 送出
    function send() {
        var dataApply = getFormSubmitableFieldsWithCheckbox($("form[id=main_form]"));
        ajaxLoadMore('@Url.Action("DocSave")',
            dataApply,
            function(response) {
                if (response.status) {
                    var form = $("form[id=main_form]");
                    form.attr('action', '@Url.Action("DocFinish")').submit();
            } else {
                blockAlert(response.message, "提示訊息");
            }
        });
    }
</script>
