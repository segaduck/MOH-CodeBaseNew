@using ES.Commons
@using ES.Services
@using ES.Models
@using ES.Models.Entities
@model ES.Models.GoodsDynamicGrid<Apply_001035_GoodsModel>
@{
    ShareCodeListModel dao = new ShareCodeListModel();
    var IsDisabled = Model.IsReadOnly ? "pointer-events:none;background:#DDDDDD" : "";
}
<div id="GoodsDynamicGird001035">
    <h2 class="second-title">
        @Html.HiddenFor(m => m.IsNewOpen)
        @Html.HiddenFor(m => m.IsReadOnly)
        @Html.HiddenFor(m => m.IsDeleteOpen)
        @Html.HiddenFor(m => m.SourceModelName)
        貨品資料
        @if (Model.IsNewOpen && !Model.IsReadOnly)
        {
            <button type="button" style="margin-bottom:5px;" class="btn btn-save" id="btnAdd" onclick="addGoodRow()">新增</button>
        }

        <br />
        <font style="color: red;">
            --同一貨品類別，如屬不同狀態，請分筆輸入。例如：同一貨品類別A，每單位容量不同，或分常溫、冷凍等，即應分筆輸入。<br />
        </font>
    </h2>

    <div id="goodsTable" class="table-responsive">
        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="table-typeA table">
            <thead>
                @if (Model.IsDeleteOpen && !Model.IsReadOnly)
                {
                <th>序</th>
                }

                <th width="25%"><span style="color:red" sr-only="必填">＊</span>貨品類別(規格)</th>
                <th width="25%"><span style="color:red" sr-only="必填">＊</span>貨品名稱</th>
                <th width="25%"><span style="color:red" sr-only="必填">＊</span>申請數量</th>
                <th width="25%">貨品輔助描述</th>
                </thead>
                <tbody>


                    @if (Model.GoodsList.ToCount() != 0)
                    {
                        for (int i = 0; i < Model.GoodsList.Count; i++)
                        {
                            var item = Model.GoodsList[i];
                            <tr style="border: none;">
                                @if (Model.IsDeleteOpen && !Model.IsReadOnly)
                                {
                                    <td style="border: none;">
                                        <button type="button" id="btnDelte_1" class="btn btn-clear" onclick="deleteGoodRow(@(i))">
                                            刪除
                                        </button>
                                    </td>
                                }
                                <td style="border: none;">
                                    @Html.HiddenFor(m => Model.GoodsList[i].SRL_NO)
                                    @Html.DropDownListFor(m => Model.GoodsList[i].GOODS_TYPE_ID, new SelectList(dao.GetGOODS_TYPEList2, "Value", "Text", Model.GoodsList[i].GOODS_TYPE_ID), new { @class = "form-control formbar-bg", style = "width:150px;" + IsDisabled, onchange = "doGOODS_NAME_Change(this)" })
                                    @Html.HiddenFor(m => Model.GoodsList[i].GOODS_TYPE)
                                    @Html.HiddenFor(m => Model.GoodsList[i].GOODS_SPEC_1)
                                </td>
                                <td style="border: none;">
                                    @Html.TextAreaFor(m => Model.GoodsList[i].GOODS_NAME, new { @class = "form-control", style = IsDisabled })
                                </td>
                                <td style="border: none;">
                                    <label class="step-label"><span style="color:red" sr-only="必填">＊</span>申請數量</label>
                                    @Html.TextBoxFor(m => Model.GoodsList[i].APPLY_CNT, new { @class = "form-control", style = IsDisabled })
                                    <br />
                                    <label class="step-label"><span style="color:red" sr-only="必填">＊</span> 單位</label>
                                    @Html.DropDownListFor(m => Model.GoodsList[i].GOODS_UNIT_ID, new SelectList(dao.GetGOODS_UNIT_IDList, "Value", "Text", Model.GoodsList[i].GOODS_UNIT_ID), new { @class = "form-control formbar-bg", style = "width:150px;" + IsDisabled })
                                    <br />
                                    <label class="step-label"><span style="color:red" sr-only="必填">＊</span> 每單位容量</label>
                                    @Html.TextBoxFor(m => Model.GoodsList[i].GOODS_SPEC_2, new { @class = "form-control", style = IsDisabled })
                                </td>
                                <td style="border: none;">
                                    <label class="step-label"><span style="color:red" sr-only="必填">＊</span> 貨品輔助描述</label>
                                    @Html.TextAreaFor(m => Model.GoodsList[i].GOODS_DESC, new { @class = "form-control", style = IsDisabled })
                                    <br />
                                    <label class="step-label"><span style="color:red" sr-only="必填">＊</span> 型號</label>
                                    @Html.TextBoxFor(m => Model.GoodsList[i].GOODS_MODEL, new { @class = "form-control", style = IsDisabled })
                                    <br />
                                    <label class="step-label"><span style="color:red" sr-only="必填">＊</span> 牌名</label>
                                    @Html.TextBoxFor(m => Model.GoodsList[i].GOODS_BRAND, new { @class = "form-control", style = IsDisabled })
                                </td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>

    </div>

    <script>
        $(document).ready(function () {
        });

        function doGOODS_NAME_Change(obj) {
            var objId = $(obj).attr("id");
            var typeObj = $(obj);
            var specObj = $('#' + objId.replaceAll("TYPE_ID", "NAME"));
            var typeText = typeObj.find("option:selected").text();
            var GOODS_TYPEObj = $('#' + objId.replaceAll("TYPE_ID", "TYPE"));
            var GOODS_SPEC_1Obj = $('#' + objId.replaceAll("TYPE_ID", "SPEC_1"));
            GOODS_TYPEObj.val(typeObj.val());
            GOODS_SPEC_1Obj.val(typeObj.val());
            specObj.val(typeText);
        }

        // 新增一列
        function addGoodRow() {
            var url = "@Url.Action("addGoodRow001035", "AJAX",new { area = "" })";
            var parms = getDivDataJson("#GoodsDynamicGird001035");

            ajaxLoadMore(url, parms
            , function (data) {
                $("#GoodsDynamicGird001035").html(data);
                $("#GoodsDynamicGird001035 :input").each(function (i, obj) {
                    $("#" + obj.id).attr("name", '@(Model.SourceModelNameFull)' + obj.name);
                    $("#" + obj.id).attr("id", '@(Model.SourceModelIdFull)' + obj.id);
                })
                $("#GoodsDynamicGird001035 :select").each(function (i, obj) {
                    $("#" + obj.id).attr("name", '@(Model.SourceModelNameFull)' + obj.name);
                    $("#" + obj.id).attr("id", '@(Model.SourceModelIdFull)' + obj.id);
                })
                $("#GoodsDynamicGird001035 :textarea").each(function (i, obj) {
                    $("#" + obj.id).attr("name", '@(Model.SourceModelNameFull)' + obj.name);
                    $("#" + obj.id).attr("id", '@(Model.SourceModelIdFull)' + obj.id);
                })
            });
        }

        // 刪除此列
        function deleteGoodRow(idx) {
            var url = "@Url.Action("deleteGoodRow001035", "AJAX",new { area = "" })";
            var parms = getDivDataJson("#GoodsDynamicGird001035");
            parms["idx"] = idx;

            ajaxLoadMore(url, parms
             , function (data) {
                 $("#GoodsDynamicGird001035").html(data);
                 $("#GoodsDynamicGird001035").html(data);
                 $("#GoodsDynamicGird001035 :input").each(function (i, obj) {
                     $("#" + obj.id).attr("name", '@(Model.SourceModelNameFull)' + obj.name);
                     $("#" + obj.id).attr("id", '@(Model.SourceModelIdFull)' + obj.id);
                 })
                 $("#GoodsDynamicGird001035 :select").each(function (i, obj) {
                     $("#" + obj.id).attr("name", '@(Model.SourceModelNameFull)' + obj.name);
                     $("#" + obj.id).attr("id", '@(Model.SourceModelIdFull)' + obj.id);
                 })
                 $("#GoodsDynamicGird001035 :textarea").each(function (i, obj) {
                     $("#" + obj.id).attr("name", '@(Model.SourceModelNameFull)' + obj.name);
                     $("#" + obj.id).attr("id", '@(Model.SourceModelIdFull)' + obj.id);
                 })
             });
        }
    </script>