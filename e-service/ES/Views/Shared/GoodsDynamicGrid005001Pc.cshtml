@using ES.Commons
@using ES.Services
@using ES.Models
@using ES.Models.ViewModels
@using ES.Models.Entities
@model ES.Models.GoodsDynamicGrid<Apply_005001_PcViewModel>
@{
    ShareCodeListModel dao = new ShareCodeListModel();
    var IsDisabled = Model.IsReadOnly ? "pointer-events:none;background:#DDDDDD" : "";
}
<div id="GoodsDynamicGird005001Pc">
    <h2 class="second-title">
        @Html.HiddenFor(m => m.IsNewOpen)
        @Html.HiddenFor(m => m.IsReadOnly)
        @Html.HiddenFor(m => m.IsDeleteOpen)
        @Html.HiddenFor(m => m.SourceModelName)
        賦形劑
        @if (Model.IsNewOpen && !Model.IsReadOnly)
        {
            <button type="button" class="btn btn-save" id="btnAdd" onclick="addGoodRow@(Model.SourceModelIdFull)()">新增</button>
        }

        <br />
    </h2>

    <div id="goodsTable" class="table-responsive">
        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="table-typeA table">
            <thead>
            <th width="5%">上下</th>

            <th width="25%"><span style="color:red" sr-only="必填">＊</span>成分內容(中文)</th>
            <th width="25%"><span style="color:red" sr-only="必填">＊</span>生藥名</th>
            <th width="20%">份量</th>
            <th width="20%">單位</th>

            <th width="5%">刪除</th>
            </thead>
            <tbody>
                @if (Model.GoodsList.ToCount() != 0)
                {
                    for (int i = 0; i < Model.GoodsList.Count; i++)
                    {
                        var item = Model.GoodsList[i];
                        <tr style="border: none;">
                            @if (!Model.IsReadOnly)
                            {
                                <td style="border: none;">
                                    <button type="button" id="btnUp_1" class="btn btn-clear" onclick="UpGoodRow@(Model.SourceModelIdFull)(@(Model.GoodsList[i].SRL_NO))">
                                        上
                                    </button>
                                    <button type="button" id="btnDown_1" class="btn btn-clear" onclick="DownGoodRow@(Model.SourceModelIdFull)(@(Model.GoodsList[i].SRL_NO))">
                                        下
                                    </button>
                                </td>
                            }
                            else
                            {
                                <td style="border: none;">&nbsp;</td>
                            }
                            <td style="border: none;">
                                @Html.HiddenFor(m => Model.GoodsList[i].SRL_NO)
                                @Html.TextBoxFor(m => Model.GoodsList[i].PC_NAME, new { @class = "form-control", style = IsDisabled })
                            </td>
                            <td style="border: none;">
                                @Html.TextBoxFor(m => Model.GoodsList[i].PC_ENAME, new { @class = "form-control", style = IsDisabled })
                            </td>
                            <td style="border: none;">
                                @Html.TextBoxFor(m => Model.GoodsList[i].PC_CONT, new { @class = "form-control", style = IsDisabled })
                            </td>
                            <td style="border: none;">
                                @Html.TextBoxFor(m => Model.GoodsList[i].PC_UNIT, new { @class = "form-control", style = IsDisabled })
                            </td>
                            @if (Model.IsDeleteOpen && !Model.IsReadOnly)
                            {
                                <td style="border: none;">
                                    <button type="button" id="btnDelte_1" class="btn btn-clear" onclick="deleteGoodRow@(Model.SourceModelIdFull)(@(i))">
                                        刪除
                                    </button>
                                </td>
                            }
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>

</div>

<script>
        $(document).ready(function () {
        });

        // 新增一列
        function addGoodRow@(Model.SourceModelIdFull)() {
            var url = "@Url.Action("addGoodRow005001Pc", "AJAX",new { area = "" })";
            var parms = getDivDataJson("#GoodsDynamicGird005001Pc");

            ajaxLoadMore(url, parms
            , function (data) {
                $("#GoodsDynamicGird005001Pc").html(data);
                $("#GoodsDynamicGird005001Pc :input").each(function (i, obj) {
                    $("#" + obj.id).attr("name", '@(Model.SourceModelNameFull)' + obj.name);
                    $("#" + obj.id).attr("id", '@(Model.SourceModelIdFull)' + obj.id);
                })
            });
        }

        // 上移此列
        function UpGoodRow@(Model.SourceModelIdFull)(idx) {
            var url = "@Url.Action("UpGoodRow005001Pc", "AJAX",new { area = "" })";
            var parms = getDivDataJson("#GoodsDynamicGird005001Pc");
            parms["idx"] = idx;

            ajaxLoadMore(url, parms
             , function (data) {
                 $("#GoodsDynamicGird005001Pc").html(data);
                 $("#GoodsDynamicGird005001Pc").html(data);
                 $("#GoodsDynamicGird005001Pc :input").each(function (i, obj) {
                     $("#" + obj.id).attr("name", '@(Model.SourceModelNameFull)' + obj.name);
                     $("#" + obj.id).attr("id", '@(Model.SourceModelIdFull)' + obj.id);
                 })
             });
        }

        // 下移此列
        function DownGoodRow@(Model.SourceModelIdFull)(idx) {
            var url = "@Url.Action("DownGoodRow005001Pc", "AJAX",new { area = "" })";
            var parms = getDivDataJson("#GoodsDynamicGird005001Pc");
            parms["idx"] = idx;

            ajaxLoadMore(url, parms
             , function (data) {
                 $("#GoodsDynamicGird005001Pc").html(data);
                 $("#GoodsDynamicGird005001Pc").html(data);
                 $("#GoodsDynamicGird005001Pc :input").each(function (i, obj) {
                     $("#" + obj.id).attr("name", '@(Model.SourceModelNameFull)' + obj.name);
                     $("#" + obj.id).attr("id", '@(Model.SourceModelIdFull)' + obj.id);
                 })
             });
        }

        // 刪除此列
        function deleteGoodRow@(Model.SourceModelIdFull)(idx) {
            var url = "@Url.Action("deleteGoodRow005001Pc", "AJAX",new { area = "" })";
            var parms = getDivDataJson("#GoodsDynamicGird005001Pc");
            parms["idx"] = idx;

            ajaxLoadMore(url, parms
             , function (data) {
                 $("#GoodsDynamicGird005001Pc").html(data);
                 $("#GoodsDynamicGird005001Pc").html(data);
                 $("#GoodsDynamicGird005001Pc :input").each(function (i, obj) {
                     $("#" + obj.id).attr("name", '@(Model.SourceModelNameFull)' + obj.name);
                     $("#" + obj.id).attr("id", '@(Model.SourceModelIdFull)' + obj.id);
                 })
             });
        }
</script>