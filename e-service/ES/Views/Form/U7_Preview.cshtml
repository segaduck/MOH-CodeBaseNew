@{
    string action = "PayMethod";
    
    if(ViewBag.Type.Equals("F") && ViewBag.Dict["PAY_POINT"].Equals("A"))
    {
        action = "Success";
    }
    
    Layout = "~/Views/Shared/_Layout2.cshtml";
    ViewBag.Title = "線上申辦";
    ViewBag.Script = @"
        function changeDDL(value, subId, action) {
            if(value == '') {
                $('#'+subId).empty();
                $('#'+subId).append($('<option></option>').val('').text('--請選擇--'));
            } else {
                $.ajax({
                    type: 'POST',
                    url: '" + @Url.Action("Index", "AJAX") + @"/' + action + '/' + value,
                    dataType: 'json',
                    cache: false,
                    async: false,
                    success: function (res) {
                        if (res.length > 0) {
                            $('#'+subId).empty();
                            $.each(res, function (i, item) {
                                $('#'+subId).append($('<option></option>').val(item.Value).text(item.Text));
                            });
                        }
                    }
                });
            }
        }
    ";
}
@section scripts {
    <script src="@Url.Action("Index", "Home")Scripts/Form/base.js")" type="text/javascript"></script>
    @if (ViewBag.Dict["SRV_SCRIPT"].Length > 10) {
        <script src="@Url.Action("PreviewJS", "Form")/@Html.Raw(ViewBag.Dict["SRV_ID"] + "?time=" + DateTime.Now.ToString("HHmmss"))" type="text/javascript"></script>
    } else if (ViewBag.Dict["SRV_ID"].Equals("001034"))
    {
        <script src="@Url.Action("Index", "Home")Scripts/Form/@Html.Raw(ViewBag.Dict["SRV_ID"] + "P.js")")" type="text/javascript"></script>
    }
}
@ViewBag.ApplyTime
@using (Html.BeginForm(action, "Form", FormMethod.Post, new { id = "ActionForm" }))
{
    @Html.AntiForgeryToken()
    <br />
    <div>．<span id="SRV_NAME">@ViewBag.Dict["NAME"]</span></div>
    @ViewBag.Dict["SRV_DESC"]
    <hr />
    if (ViewBag.Type.Equals("F"))
    {
        <div style="float: right; color: #AAAAAA;">
        <span>填表 → </span><span style="color: #B22222;">預覽填表資料</span><span> → </span>
        @if (!@ViewBag.Dict["PAY_POINT"].Equals("A"))
        {
            <span>選擇捐款方式 → </span>
        }
        <span>完成捐款手續</span>
        </div>
    }
    @Html.Action("PreviewMember1", "Form")
    @Html.Action("PreviewForm1", "Form", new { id = @ViewBag.ServiceId })
    
    if (ViewBag.FileList != null && ViewBag.FileList.Count > 0)
    {
        <table class="formTable1">
            <caption style="padding: 0px 10px 0px 10px;">
                <div style="float: left; padding: 9px 0px 7px 0px;">補件上傳</div>
                <div style="float: right;">
                    <input type="button" value="隱藏" onclick="showTableBody(this, '99')" />
                </div>
            </caption>
            <tbody id="tbody_99">
                <tr>
                    <th style="width: 20px;"></th>
                    <th><span class="formRequired">*</span>檔案</th>
                </tr>
            @foreach (Dictionary<string, object> item in ViewBag.FileList)
            {
                <tr>
                    <td>@item["FILE_NO"]</td>
                    <td>@Html.ActionLink(Convert.ToString(item["SRC_FILENAME"]), "Apply", "File", new { path = ES.Utils.DataUtils.ToBase64String(Convert.ToString(item["FILENAME"])) }, null)</td>
                </tr>
            }
            </tbody>
        </table>
    }
    <br />http://localhost:4142/File/Apply?path=VGVtcFwwMDEwMDhcMjAxNDA5MDExNjI1MzlfQVRIX1VQXzEuanBn
    
    <div class="formButtomBar">
        @Html.Hidden("SRV_ID", (string)@ViewBag.Dict["SRV_ID"])
        @if (ViewBag.Type.Equals("F"))
        {
            <input type="button" value="下一步" onclick="jConfirm('確定要送出嗎？', function () { $('#ActionForm').submit(); });" />
        }
        else
        {
            <input type="button" value="關閉" onclick="window.close();" />
        }
    </div>
}